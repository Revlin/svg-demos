svgedit={NS:{HTML:"http://www.w3.org/1999/xhtml",MATH:"http://www.w3.org/1998/Math/MathML",SE:"http://svg-edit.googlecode.com",SVG:"http://www.w3.org/2000/svg",XLINK:"http://www.w3.org/1999/xlink",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"}};svgedit.getReverseNS=function(){var a={};$.each(this.NS,function(G,e){a[e]=G.toLowerCase()});return a};(function(){var a=jQuery.fn.attr;jQuery.fn.attr=function(G,e){var m=this.length;if(!m)return a.apply(this,arguments);for(var l=0;l<m;++l){var v=this[l];if(v.namespaceURI==="http://www.w3.org/2000/svg")if(e!==undefined)v.setAttribute(G,e);else if($.isArray(G)){m=G.length;for(l={};m--;){var f=G[m],h=v.getAttribute(f);if(h||h==="0")h=isNaN(h)?h:h-0;l[f]=h}return l}else if(typeof G==="object")for(f in G)v.setAttribute(f,G[f]);else{if((h=v.getAttribute(G))||h==="0")h=isNaN(h)?h:h-0;return h}else return a.apply(this,
arguments)}return this}})();jQuery&&function(){var a=$(window),G=$(document);$.extend($.fn,{contextMenu:function(e,m){if(e.menu==undefined)return false;if(e.inSpeed==undefined)e.inSpeed=150;if(e.outSpeed==undefined)e.outSpeed=75;if(e.inSpeed==0)e.inSpeed=-1;if(e.outSpeed==0)e.outSpeed=-1;$(this).each(function(){var l=$(this),v=$(l).offset(),f=$("#"+e.menu);f.addClass("contextMenu");$(this).bind("mousedown",function(h){$(this).mouseup(function(c){var i=$(this);i.unbind("mouseup");if(h.button===2||e.allowLeft||h.ctrlKey&&svgedit.browser.isMac()){c.stopPropagation();
$(".contextMenu").hide();if(l.hasClass("disabled"))return false;var t=c.pageX,n=c.pageY;c=a.width()-f.width();var p=a.height()-f.height();if(t>c-15)t=c-15;if(n>p-30)n=p-30;G.unbind("click");f.css({top:n,left:t}).fadeIn(e.inSpeed);f.find("A").mouseover(function(){f.find("LI.hover").removeClass("hover");$(this).parent().addClass("hover")}).mouseout(function(){f.find("LI.hover").removeClass("hover")});G.keypress(function(D){switch(D.keyCode){case 38:if(f.find("LI.hover").length){f.find("LI.hover").removeClass("hover").prevAll("LI:not(.disabled)").eq(0).addClass("hover");
f.find("LI.hover").length||f.find("LI:last").addClass("hover")}else f.find("LI:last").addClass("hover");break;case 40:if(f.find("LI.hover").length==0)f.find("LI:first").addClass("hover");else{f.find("LI.hover").removeClass("hover").nextAll("LI:not(.disabled)").eq(0).addClass("hover");f.find("LI.hover").length||f.find("LI:first").addClass("hover")}break;case 13:f.find("LI.hover A").trigger("click");break;case 27:G.trigger("click")}});f.find("A").unbind("mouseup");f.find("LI:not(.disabled) A").mouseup(function(){G.unbind("click").unbind("keypress");
$(".contextMenu").hide();m&&m($(this).attr("href").substr(1),$(i),{x:t-v.left,y:n-v.top,docX:t,docY:n});return false});setTimeout(function(){G.click(function(){G.unbind("click").unbind("keypress");f.fadeOut(e.outSpeed);return false})},0)}})});if($.browser.mozilla)$("#"+e.menu).each(function(){$(this).css({MozUserSelect:"none"})});else $.browser.msie?$("#"+e.menu).each(function(){$(this).bind("selectstart.disableTextSelect",function(){return false})}):$("#"+e.menu).each(function(){$(this).bind("mousedown.disableTextSelect",
function(){return false})});$(l).add($("UL.contextMenu")).bind("contextmenu",function(){return false})});return $(this)},disableContextMenuItems:function(e){if(e==undefined){$(this).find("LI").addClass("disabled");return $(this)}$(this).each(function(){if(e!=undefined)for(var m=e.split(","),l=0;l<m.length;l++)$(this).find('A[href="'+m[l]+'"]').parent().addClass("disabled")});return $(this)},enableContextMenuItems:function(e){if(e==undefined){$(this).find("LI.disabled").removeClass("disabled");return $(this)}$(this).each(function(){if(e!=
undefined)for(var m=e.split(","),l=0;l<m.length;l++)$(this).find('A[href="'+m[l]+'"]').parent().removeClass("disabled")});return $(this)},disableContextMenu:function(){$(this).each(function(){$(this).addClass("disabled")});return $(this)},enableContextMenu:function(){$(this).each(function(){$(this).removeClass("disabled")});return $(this)},destroyContextMenu:function(){$(this).each(function(){$(this).unbind("mousedown").unbind("mouseup")});return $(this)}})}(jQuery);(function(){if(!svgedit.browser)svgedit.browser={};var a=svgedit.NS,G=!!document.createElementNS&&!!document.createElementNS(a.SVG,"svg").createSVGRect;svgedit.browser.supportsSvg=function(){return G};if(svgedit.browser.supportsSvg()){var e=navigator.userAgent,m=document.createElementNS(a.SVG,"svg"),l=!!window.opera,v=e.indexOf("AppleWebKit")>=0,f=e.indexOf("Gecko/")>=0,h=e.indexOf("MSIE")>=0,c=e.indexOf("Chrome/")>=0,i=e.indexOf("Windows")>=0,t=e.indexOf("Macintosh")>=0,n="ontouchstart"in window,
p=!!m.querySelector,D=!!document.evaluate,P=function(){var ia=document.createElementNS(a.SVG,"path");ia.setAttribute("d","M0,0 10,10");var ka=ia.pathSegList;ia=ia.createSVGPathSegLinetoAbs(5,5);try{ka.replaceItem(ia,0);return true}catch(da){}return false}(),L=function(){var ia=document.createElementNS(a.SVG,"path");ia.setAttribute("d","M0,0 10,10");var ka=ia.pathSegList;ia=ia.createSVGPathSegLinetoAbs(5,5);try{ka.insertItemBefore(ia,0);return true}catch(da){}return false}(),A=function(){var ia=document.createElementNS(a.SVG,
"svg"),ka=document.createElementNS(a.SVG,"svg");document.documentElement.appendChild(ia);ka.setAttribute("x",5);ia.appendChild(ka);var da=document.createElementNS(a.SVG,"text");da.textContent="a";ka.appendChild(da);ka=da.getStartPositionOfChar(0).x;document.documentElement.removeChild(ia);return ka===0}(),ga=function(){var ia=document.createElementNS(a.SVG,"svg");document.documentElement.appendChild(ia);var ka=document.createElementNS(a.SVG,"path");ka.setAttribute("d","M0,0 C0,0 10,10 10,0");ia.appendChild(ka);
ka=ka.getBBox();document.documentElement.removeChild(ia);return ka.height>4&&ka.height<5}(),la=function(){var ia=document.createElementNS(a.SVG,"svg");document.documentElement.appendChild(ia);var ka=document.createElementNS(a.SVG,"path");ka.setAttribute("d","M0,0 10,0");var da=document.createElementNS(a.SVG,"path");da.setAttribute("d","M5,0 15,0");var za=document.createElementNS(a.SVG,"g");za.appendChild(ka);za.appendChild(da);ia.appendChild(za);ka=za.getBBox();document.documentElement.removeChild(ia);
return ka.width==15}(),Ba=function(){var ia=document.createElementNS(a.SVG,"rect");ia.setAttribute("x",0.1);(ia=ia.cloneNode(false).getAttribute("x").indexOf(",")==-1)||$.alert('NOTE: This version of Opera is known to contain bugs in SVG-edit.\n\t\tPlease upgrade to the <a href="http://opera.com">latest version</a> in which the problems have been fixed.');return ia}(),Ga=function(){var ia=document.createElementNS(a.SVG,"rect");ia.setAttribute("style","vector-effect:non-scaling-stroke");return ia.style.vectorEffect===
"non-scaling-stroke"}(),oa=function(){var ia=document.createElementNS(a.SVG,"rect").transform.baseVal,ka=m.createSVGTransform();ia.appendItem(ka);return ia.getItem(0)==ka}();svgedit.browser.isOpera=function(){return l};svgedit.browser.isWebkit=function(){return v};svgedit.browser.isGecko=function(){return f};svgedit.browser.isIE=function(){return h};svgedit.browser.isChrome=function(){return c};svgedit.browser.isWindows=function(){return i};svgedit.browser.isMac=function(){return t};svgedit.browser.isTouch=
function(){return n};svgedit.browser.supportsSelectors=function(){return p};svgedit.browser.supportsXpath=function(){return D};svgedit.browser.supportsPathReplaceItem=function(){return P};svgedit.browser.supportsPathInsertItemBefore=function(){return L};svgedit.browser.supportsPathBBox=function(){return ga};svgedit.browser.supportsHVLineContainerBBox=function(){return la};svgedit.browser.supportsGoodTextCharPos=function(){return A};svgedit.browser.supportsEditableText=function(){return l};svgedit.browser.supportsGoodDecimals=
function(){return Ba};svgedit.browser.supportsNonScalingStroke=function(){return Ga};svgedit.browser.supportsNativeTransformLists=function(){return oa}}else window.location="browser-not-supported.html"})();(function(){if(!svgedit.transformlist)svgedit.transformlist={};var a=document.createElementNS(svgedit.NS.SVG,"svg"),G={};svgedit.transformlist.SVGTransformList=function(e){this._elem=e||null;this._xforms=[];this._update=function(){var m="";a.createSVGMatrix();for(var l=0;l<this.numberOfItems;++l){var v=this._list.getItem(l);m=m;v=v;var f=v.matrix,h="";switch(v.type){case 1:h="matrix("+[f.a,f.b,f.c,f.d,f.e,f.f].join(",")+")";break;case 2:h="translate("+f.e+","+f.f+")";break;case 3:h=f.a==f.d?"scale("+
f.a+")":"scale("+f.a+","+f.d+")";break;case 4:var c=0;h=0;if(v.angle!=0){c=1-f.a;h=(c*f.f+f.b*f.e)/(c*c+f.b*f.b);c=(f.e-f.b*h)/c}h="rotate("+v.angle+" "+c+","+h+")"}m=m+(h+" ")}this._elem.setAttribute("transform",m)};this._list=this;this._init=function(){var m=this._elem.getAttribute("transform");if(m)for(var l=/\s*((scale|matrix|rotate|translate)\s*\(.*?\))\s*,?\s*/,v=true;v;){v=m.match(l);m=m.replace(l,"");if(v&&v[1]){var f=v[1].split(/\s*\(/),h=f[0];f=f[1].match(/\s*(.*?)\s*\)/);f[1]=f[1].replace(/(\d)-/g,
"$1 -");var c=f[1].split(/[, ]+/),i="abcdef".split(""),t=a.createSVGMatrix();$.each(c,function(D,P){c[D]=parseFloat(P);if(h=="matrix")t[i[D]]=c[D]});f=a.createSVGTransform();var n="set"+h.charAt(0).toUpperCase()+h.slice(1),p=h=="matrix"?[t]:c;if(h=="scale"&&p.length==1)p.push(p[0]);else if(h=="translate"&&p.length==1)p.push(0);else h=="rotate"&&p.length==1&&p.push(0,0);f[n].apply(f,p);this._list.appendItem(f)}}};this._removeFromOtherLists=function(m){if(m){var l=false,v;for(v in G){for(var f=G[v],
h=0,c=f._xforms.length;h<c;++h)if(f._xforms[h]==m){l=true;f.removeItem(h);break}if(l)break}}};this.numberOfItems=0;this.clear=function(){this.numberOfItems=0;this._xforms=[]};this.initialize=function(m){this.numberOfItems=1;this._removeFromOtherLists(m);this._xforms=[m]};this.getItem=function(m){if(m<this.numberOfItems&&m>=0)return this._xforms[m];throw{code:1};};this.insertItemBefore=function(m,l){var v=null;if(l>=0)if(l<this.numberOfItems){this._removeFromOtherLists(m);v=Array(this.numberOfItems+
1);for(var f=0;f<l;++f)v[f]=this._xforms[f];v[f]=m;for(var h=f+1;f<this.numberOfItems;++h,++f)v[h]=this._xforms[f];this.numberOfItems++;this._xforms=v;v=m;this._list._update()}else v=this._list.appendItem(m);return v};this.replaceItem=function(m,l){var v=null;if(l<this.numberOfItems&&l>=0){this._removeFromOtherLists(m);v=this._xforms[l]=m;this._list._update()}return v};this.removeItem=function(m){if(m<this.numberOfItems&&m>=0){for(var l=this._xforms[m],v=Array(this.numberOfItems-1),f=0;f<m;++f)v[f]=
this._xforms[f];for(m=f;m<this.numberOfItems-1;++m,++f)v[m]=this._xforms[f+1];this.numberOfItems--;this._xforms=v;this._list._update();return l}throw{code:1};};this.appendItem=function(m){this._removeFromOtherLists(m);this._xforms.push(m);this.numberOfItems++;this._list._update();return m}};svgedit.transformlist.resetListMap=function(){G={}};svgedit.transformlist.removeElementFromListMap=function(e){e.id&&G[e.id]&&delete G[e.id]};svgedit.transformlist.getTransformList=function(e){if(!svgedit.browser.supportsNativeTransformLists()){var m=
e.id||"temp",l=G[m];if(!l||m==="temp"){G[m]=new svgedit.transformlist.SVGTransformList(e);G[m]._init();l=G[m]}return l}if(e.transform)return e.transform.baseVal;if(e.gradientTransform)return e.gradientTransform.baseVal;if(e.patternTransform)return e.patternTransform.baseVal;return null}})();(function(){if(!svgedit.math)svgedit.math={};var a=document.createElementNS(svgedit.NS.SVG,"svg");svgedit.math.transformPoint=function(G,e,m){return{x:m.a*G+m.c*e+m.e,y:m.b*G+m.d*e+m.f}};svgedit.math.isIdentity=function(G){return G.a===1&&G.b===0&&G.c===0&&G.d===1&&G.e===0&&G.f===0};svgedit.math.matrixMultiply=function(){for(var G=arguments,e=G.length,m=G[e-1];e-- >1;)m=G[e-1].multiply(m);if(Math.abs(m.a)<1.0E-14)m.a=0;if(Math.abs(m.b)<1.0E-14)m.b=0;if(Math.abs(m.c)<1.0E-14)m.c=0;if(Math.abs(m.d)<
1.0E-14)m.d=0;if(Math.abs(m.e)<1.0E-14)m.e=0;if(Math.abs(m.f)<1.0E-14)m.f=0;return m};svgedit.math.hasMatrixTransform=function(G){if(!G)return false;for(var e=G.numberOfItems;e--;){var m=G.getItem(e);if(m.type==1&&!svgedit.math.isIdentity(m.matrix))return true}return false};svgedit.math.transformBox=function(G,e,m,l,v){var f=svgedit.math.transformPoint,h=f(G,e,v),c=f(G+m,e,v),i=f(G,e+l,v);G=f(G+m,e+l,v);e=Math.min(h.x,c.x,i.x,G.x);m=Math.min(h.y,c.y,i.y,G.y);return{tl:h,tr:c,bl:i,br:G,aabox:{x:e,
y:m,width:Math.max(h.x,c.x,i.x,G.x)-e,height:Math.max(h.y,c.y,i.y,G.y)-m}}};svgedit.math.transformListToTransform=function(G,e,m){if(G==null)return a.createSVGTransformFromMatrix(a.createSVGMatrix());e=e||0;m=m||G.numberOfItems-1;e=parseInt(e,10);m=parseInt(m,10);if(e>m){var l=m;m=e;e=l}l=a.createSVGMatrix();for(e=e;e<=m;++e){var v=e>=0&&e<G.numberOfItems?G.getItem(e).matrix:a.createSVGMatrix();l=svgedit.math.matrixMultiply(l,v)}return a.createSVGTransformFromMatrix(l)};svgedit.math.getMatrix=function(G){G=
svgedit.transformlist.getTransformList(G);return svgedit.math.transformListToTransform(G).matrix};svgedit.math.snapToAngle=function(G,e,m,l){var v=Math.PI/4;m=m-G;var f=l-e;l=Math.sqrt(m*m+f*f);v=Math.round(Math.atan2(f,m)/v)*v;return{x:G+l*Math.cos(v),y:e+l*Math.sin(v),a:v}};svgedit.math.rectsIntersect=function(G,e){return e.x<G.x+G.width&&e.x+e.width>G.x&&e.y<G.y+G.height&&e.y+e.height>G.y}})();(function(){if(!svgedit.units)svgedit.units={};var a=svgedit.NS,G=["x","x1","cx","rx","width"],e=["y","y1","cy","ry","height"],m=["r","radius"].concat(G,e),l,v={};svgedit.units.init=function(h){l=h;h=document.createElementNS(a.SVG,"svg");document.body.appendChild(h);var c=document.createElementNS(a.SVG,"rect");c.setAttribute("width","1em");c.setAttribute("height","1ex");c.setAttribute("x","1in");h.appendChild(c);c=c.getBBox();document.body.removeChild(h);h=c.x;v={em:c.width,ex:c.height,"in":h,cm:h/
2.54,mm:h/25.4,pt:h/72,pc:h/6,px:1,"%":0}};svgedit.units.getTypeMap=function(){return v};svgedit.units.shortFloat=function(h){var c=l.getRoundDigits();if(!isNaN(h))return+(+h).toFixed(c);if($.isArray(h))return svgedit.units.shortFloat(h[0])+","+svgedit.units.shortFloat(h[1]);return parseFloat(h).toFixed(c)-0};svgedit.units.convertUnit=function(h,c){c=c||l.getBaseUnit();return svgedit.units.shortFloat(h/v[c])};svgedit.units.setUnitAttr=function(h,c,i){isNaN(i);h.setAttribute(c,i)};var f={line:["x1",
"x2","y1","y2"],circle:["cx","cy","r"],ellipse:["cx","cy","rx","ry"],foreignObject:["x","y","width","height"],rect:["x","y","width","height"],image:["x","y","width","height"],use:["x","y","width","height"],text:["x","y"]};svgedit.units.convertAttrs=function(h){var c=h.tagName,i=l.getBaseUnit();if(c=f[c])for(var t=c.length,n=0;n<t;n++){var p=c[n],D=h.getAttribute(p);if(D)isNaN(D)||h.setAttribute(p,D/v[i]+i)}};svgedit.units.convertToNum=function(h,c){if(!isNaN(c))return c-0;if(c.substr(-1)==="%"){var i=
c.substr(0,c.length-1)/100,t=l.getWidth(),n=l.getHeight();if(G.indexOf(h)>=0)return i*t;if(e.indexOf(h)>=0)return i*n;return i*Math.sqrt(t*t+n*n)/Math.sqrt(2)}t=c.substr(-2);i=c.substr(0,c.length-2);return i*v[t]};svgedit.units.isValidUnit=function(h,c,i){var t=false;if(m.indexOf(h)>=0)if(isNaN(c)){c=c.toLowerCase();$.each(v,function(D){if(!t)if(RegExp("^-?[\\d\\.]+"+D+"$").test(c))t=true})}else t=true;else if(h=="id"){h=false;try{var n=l.getElement(c);h=n==null||n===i}catch(p){}return h}else t=true;
return t}})();(function(){function a(h){if(svgedit.browser.supportsHVLineContainerBBox())try{return h.getBBox()}catch(c){}var i=$.data(h,"ref"),t=null;if(i){var n=$(i).children().clone().attr("visibility","hidden");$(f).append(n);t=n.filter("line, path")}else t=$(h).find("line, path");var p=false;if(t.length){t.each(function(){var D=this.getBBox();if(!D.width||!D.height)p=true});if(p){h=i?n:$(h).children();h=getStrokedBBox(h)}else h=h.getBBox()}else h=h.getBBox();i&&n.remove();return h}if(!svgedit.utilities)svgedit.utilities=
{};var G=svgedit.NS,e="a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use".split(","),m=null,l=null,v=null,f=null;svgedit.utilities.init=function(h){m=h;l=h.getDOMDocument();v=h.getDOMContainer();f=h.getSVGRoot()};svgedit.utilities.toXml=function(h){return $("<p/>").text(h).html()};svgedit.utilities.fromXml=function(h){return $("<p/>").html(h).text()};svgedit.utilities.encode64=function(h){h=svgedit.utilities.convertToXMLReferences(h);if(window.btoa)return window.btoa(h);
var c=Array(Math.floor((h.length+2)/3)*4),i,t,n,p,D,P,L=0,A=0;do{i=h.charCodeAt(L++);t=h.charCodeAt(L++);n=h.charCodeAt(L++);p=i>>2;i=(i&3)<<4|t>>4;D=(t&15)<<2|n>>6;P=n&63;if(isNaN(t))D=P=64;else if(isNaN(n))P=64;c[A++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(p);c[A++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(i);c[A++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(D);c[A++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(P)}while(L<
h.length);return c.join("")};svgedit.utilities.decode64=function(h){if(window.atob)return window.atob(h);var c="",i,t,n="",p,D="",P=0;h=h.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(h.charAt(P++));t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(h.charAt(P++));p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(h.charAt(P++));D="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(h.charAt(P++));
i=i<<2|t>>4;t=(t&15)<<4|p>>2;n=(p&3)<<6|D;c+=String.fromCharCode(i);if(p!=64)c+=String.fromCharCode(t);if(D!=64)c+=String.fromCharCode(n)}while(P<h.length);return unescape(c)};svgedit.utilities.convertToXMLReferences=function(h){for(var c="",i=0;i<h.length;i++){var t=h.charCodeAt(i);if(t<128)c+=h[i];else if(t>127)c+="&#"+t+";"}return c};svgedit.utilities.text2xml=function(h){if(h.indexOf("<svg:svg")>=0)h=h.replace(/<(\/?)svg:/g,"<$1").replace("xmlns:svg","xmlns");var c;try{var i=window.DOMParser?
new DOMParser:new ActiveXObject("Microsoft.XMLDOM");i.async=false}catch(t){throw Error("XML Parser could not be instantiated");}try{c=i.loadXML?i.loadXML(h)?i:false:i.parseFromString(h,"text/xml")}catch(n){throw Error("Error parsing XML string");}return c};svgedit.utilities.bboxToObj=function(h){return{x:h.x,y:h.y,width:h.width,height:h.height}};svgedit.utilities.walkTree=function(h,c){if(h&&h.nodeType==1){c(h);for(var i=h.childNodes.length;i--;)svgedit.utilities.walkTree(h.childNodes.item(i),c)}};
svgedit.utilities.walkTreePost=function(h,c){if(h&&h.nodeType==1){for(var i=h.childNodes.length;i--;)svgedit.utilities.walkTree(h.childNodes.item(i),c);c(h)}};svgedit.utilities.getUrlFromAttr=function(h){if(h)if(h.indexOf('url("')===0)return h.substring(5,h.indexOf('"',6));else if(h.indexOf("url('")===0)return h.substring(5,h.indexOf("'",6));else if(h.indexOf("url(")===0)return h.substring(4,h.indexOf(")"));return null};svgedit.utilities.getHref=function(h){return h.getAttributeNS(G.XLINK,"href")};
svgedit.utilities.setHref=function(h,c){h.setAttributeNS(G.XLINK,"xlink:href",c)};svgedit.utilities.findDefs=function(){var h=m.getSVGContent(),c=h.getElementsByTagNameNS(G.SVG,"defs");if(c.length>0)c=c[0];else{c=h.ownerDocument.createElementNS(G.SVG,"defs");h.firstChild?h.insertBefore(c,h.firstChild.nextSibling):h.appendChild(c)}return c};svgedit.utilities.getPathBBox=function(h){var c=h.pathSegList,i=c.numberOfItems;h=[[],[]];var t=c.getItem(0),n=[t.x,t.y];for(t=0;t<i;t++){var p=c.getItem(t);if(typeof p.x!=
"undefined"){h[0].push(n[0]);h[1].push(n[1]);if(p.x1){for(var D=[p.x1,p.y1],P=[p.x2,p.y2],L=[p.x,p.y],A=0;A<2;A++){p=function(oa){return Math.pow(1-oa,3)*n[A]+3*Math.pow(1-oa,2)*oa*D[A]+3*(1-oa)*Math.pow(oa,2)*P[A]+Math.pow(oa,3)*L[A]};var ga=6*n[A]-12*D[A]+6*P[A],la=-3*n[A]+9*D[A]-9*P[A]+3*L[A],Ba=3*D[A]-3*n[A];if(la==0){if(ga!=0){ga=-Ba/ga;0<ga&&ga<1&&h[A].push(p(ga))}}else{Ba=Math.pow(ga,2)-4*Ba*la;if(!(Ba<0)){var Ga=(-ga+Math.sqrt(Ba))/(2*la);0<Ga&&Ga<1&&h[A].push(p(Ga));ga=(-ga-Math.sqrt(Ba))/
(2*la);0<ga&&ga<1&&h[A].push(p(ga))}}}n=L}else{h[0].push(p.x);h[1].push(p.y)}}}c=Math.min.apply(null,h[0]);i=Math.max.apply(null,h[0])-c;t=Math.min.apply(null,h[1]);h=Math.max.apply(null,h[1])-t;return{x:c,y:t,width:i,height:h}};svgedit.utilities.getBBox=function(h){var c=h||m.geSelectedElements()[0];if(h.nodeType!=1)return null;h=null;var i=c.nodeName;switch(i){case "text":if(c.textContent===""){c.textContent="a";h=c.getBBox();c.textContent=""}else try{h=c.getBBox()}catch(t){}break;case "path":if(svgedit.browser.supportsPathBBox())try{h=
c.getBBox()}catch(n){}else h=svgedit.utilities.getPathBBox(c);break;case "g":case "a":h=a(c);break;default:if(i==="use")h=a(c,true);if(i==="use"||i==="foreignObject"&&svgedit.browser.isWebkit()){h||(h=c.getBBox());i={};i.width=h.width;i.height=h.height;i.x=h.x+parseFloat(c.getAttribute("x")||0);i.y=h.y+parseFloat(c.getAttribute("y")||0);h=i}else if(~e.indexOf(i))try{h=c.getBBox()}catch(p){c=$(c).closest("foreignObject");if(c.length)try{h=c[0].getBBox()}catch(D){h=null}else h=null}}if(h)h=svgedit.utilities.bboxToObj(h);
return h};svgedit.utilities.getRotationAngle=function(h,c){var i=h||m.getSelectedElements()[0];i=svgedit.transformlist.getTransformList(i);if(!i)return 0;for(var t=i.numberOfItems,n=0;n<t;++n){var p=i.getItem(n);if(p.type==4)return c?p.angle*Math.PI/180:p.angle}return 0};svgedit.utilities.getRefElem=function(h){return svgedit.utilities.getElem(svgedit.utilities.getUrlFromAttr(h).substr(1))};svgedit.utilities.getElem=svgedit.browser.supportsSelectors()?function(h){return f.querySelector("#"+h)}:svgedit.browser.supportsXpath()?
function(h){return l.evaluate('svg:svg[@id="svgroot"]//svg:*[@id="'+h+'"]',v,function(){return svgedit.NS.SVG},9,null).singleNodeValue}:function(h){return $(f).find("[id="+h+"]")[0]};svgedit.utilities.assignAttributes=function(h,c,i,t){i||(i=0);svgedit.browser.isOpera()||f.suspendRedraw(i);for(var n in c)if(i=n.substr(0,4)==="xml:"?G.XML:n.substr(0,6)==="xlink:"?G.XLINK:null)h.setAttributeNS(i,n,c[n]);else t?svgedit.units.setUnitAttr(h,n,c[n]):h.setAttribute(n,c[n]);svgedit.browser.isOpera()||f.unsuspendRedraw(null)};
svgedit.utilities.cleanupElement=function(h){var c=f.suspendRedraw(60),i={"fill-opacity":1,"stop-opacity":1,opacity:1,stroke:"none","stroke-dasharray":"none","stroke-linejoin":"miter","stroke-linecap":"butt","stroke-opacity":1,"stroke-width":1,rx:0,ry:0},t;for(t in i){var n=i[t];h.getAttribute(t)==n&&h.removeAttribute(t)}f.unsuspendRedraw(c)};svgedit.utilities.snapToGrid=function(h){var c=m.getSnappingStep(),i=m.getBaseUnit();if(i!=="px")c*=svgedit.units.getTypeMap()[i];return h=Math.round(h/c)*c}})();(function(){if(!svgedit.sanitize)svgedit.sanitize={};var a=svgedit.NS,G=svgedit.getReverseNS(),e={a:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","id","mask","opacity","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","xlink:href","xlink:title"],circle:["class","clip-path","clip-rule","cx","cy","fill","fill-opacity","fill-rule","filter","id","mask",
"opacity","r","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],clipPath:["class","clipPathUnits","id"],defs:[],style:["type"],desc:[],ellipse:["class","clip-path","clip-rule","cx","cy","fill","fill-opacity","fill-rule","filter","id","mask","opacity","requiredFeatures","rx","ry","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin",
"stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],feGaussianBlur:["class","color-interpolation-filters","id","requiredFeatures","stdDeviation"],filter:["class","color-interpolation-filters","filterRes","filterUnits","height","id","primitiveUnits","requiredFeatures","width","x","xlink:href","y"],foreignObject:["class","font-size","height","id","opacity","requiredFeatures","style","transform","width","x","y"],g:["class","clip-path","clip-rule","id","display",
"fill","fill-opacity","fill-rule","filter","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","font-family","font-size","font-style","font-weight","text-anchor"],image:["class","clip-path","clip-rule","filter","height","id","mask","opacity","requiredFeatures","style","systemLanguage","transform","width","x","xlink:href","xlink:title","y"],line:["class",
"clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","id","marker-end","marker-mid","marker-start","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","x1","x2","y1","y2"],linearGradient:["class","id","gradientTransform","gradientUnits","requiredFeatures","spreadMethod","systemLanguage","x1","x2","xlink:href","y1","y2"],marker:["id",
"class","markerHeight","markerUnits","markerWidth","orient","preserveAspectRatio","refX","refY","systemLanguage","viewBox"],mask:["class","height","id","maskContentUnits","maskUnits","width","x","y"],metadata:["class","id"],path:["class","clip-path","clip-rule","d","fill","fill-opacity","fill-rule","filter","id","marker-end","marker-mid","marker-start","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity",
"stroke-width","style","systemLanguage","transform"],pattern:["class","height","id","patternContentUnits","patternTransform","patternUnits","requiredFeatures","style","systemLanguage","viewBox","width","x","xlink:href","y"],polygon:["class","clip-path","clip-rule","id","fill","fill-opacity","fill-rule","filter","id","class","marker-end","marker-mid","marker-start","mask","opacity","points","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit",
"stroke-opacity","stroke-width","style","systemLanguage","transform"],polyline:["class","clip-path","clip-rule","id","fill","fill-opacity","fill-rule","filter","marker-end","marker-mid","marker-start","mask","opacity","points","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],radialGradient:["class","cx","cy","fx","fy","gradientTransform","gradientUnits","id",
"r","requiredFeatures","spreadMethod","systemLanguage","xlink:href"],rect:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","height","id","mask","opacity","requiredFeatures","rx","ry","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","width","x","y"],stop:["class","id","offset","requiredFeatures","stop-color","stop-opacity","style","systemLanguage"],svg:["class",
"clip-path","clip-rule","filter","id","height","mask","preserveAspectRatio","requiredFeatures","style","systemLanguage","viewBox","width","x","xmlns","xmlns:se","xmlns:xlink","y"],"switch":["class","id","requiredFeatures","systemLanguage"],symbol:["class","fill","fill-opacity","fill-rule","filter","font-family","font-size","font-style","font-weight","id","opacity","preserveAspectRatio","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit",
"stroke-opacity","stroke-width","style","systemLanguage","transform","viewBox"],text:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","font-family","font-size","font-style","font-weight","id","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","text-anchor","transform","x","xml:space","y"],textPath:["class","id","method","requiredFeatures",
"spacing","startOffset","style","systemLanguage","transform","xlink:href"],title:[],tspan:["class","clip-path","clip-rule","dx","dy","fill","fill-opacity","fill-rule","filter","font-family","font-size","font-style","font-weight","id","mask","opacity","requiredFeatures","rotate","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","text-anchor","textLength","transform","x","xml:space","y"],use:["class",
"clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","height","id","mask","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","transform","width","x","xlink:href","y"],annotation:["encoding"],"annotation-xml":["encoding"],maction:["actiontype","other","selection"],math:["class","id","display","xmlns"],menclose:["notation"],merror:[],mfrac:["linethickness"],mi:["mathvariant"],mmultiscripts:[],mn:[],
mo:["fence","lspace","maxsize","minsize","rspace","stretchy"],mover:[],mpadded:["lspace","width","height","depth","voffset"],mphantom:[],mprescripts:[],mroot:[],mrow:["xlink:href","xlink:type","xmlns:xlink"],mspace:["depth","height","width"],msqrt:[],mstyle:["displaystyle","mathbackground","mathcolor","mathvariant","scriptlevel"],msub:[],msubsup:[],msup:[],mtable:["align","columnalign","columnlines","columnspacing","displaystyle","equalcolumns","equalrows","frame","rowalign","rowlines","rowspacing",
"width"],mtd:["columnalign","columnspan","rowalign","rowspan"],mtext:[],mtr:["columnalign","rowalign"],munder:[],munderover:[],none:[],semantics:[]},m={};$.each(e,function(l,v){var f={};$.each(v,function(h,c){if(c.indexOf(":")>=0){var i=c.split(":");f[i[1]]=a[i[0].toUpperCase()]}else f[c]=c=="xmlns"?a.XMLNS:null});m[l]=f});svgedit.sanitize.sanitizeSvg=function(l){if(l.nodeType==3){l.nodeValue=l.nodeValue.replace(/^\s+|\s+$/g,"");l.nodeValue.length===0&&l.parentNode.removeChild(l)}if(l.nodeType==1){var v=
l.parentNode;if(l.ownerDocument&&v){var f=e[l.nodeName],h=m[l.nodeName];if(typeof f!=="undefined"){for(var c=[],i=l.attributes.length;i--;){var t=l.attributes.item(i),n=t.nodeName,p=t.localName,D=t.namespaceURI;if(!(h.hasOwnProperty(p)&&D==h[p]&&D!=a.XMLNS)&&!(D==a.XMLNS&&G[t.nodeValue])){n.indexOf("se:")===0&&c.push([n,t.nodeValue]);l.removeAttributeNS(D,p)}if(svgedit.browser.isGecko())switch(n){case "transform":case "gradientTransform":case "patternTransform":p=t.nodeValue.replace(/(\d)-/g,"$1 -");
l.setAttribute(n,p)}if(n=="style"){t=t.nodeValue.split(";");for(n=t.length;n--;){D=t[n].split(":");p=$.trim(D[0]);D=$.trim(D[1]);f.indexOf(p)>=0&&l.setAttribute(p,D)}l.removeAttribute("style")}}$.each(c,function(P,L){l.setAttributeNS(a.SE,L[0],L[1])});if((i=svgedit.utilities.getHref(l))&&["filter","linearGradient","pattern","radialGradient","textPath","use"].indexOf(l.nodeName)>=0)if(i[0]!="#"){svgedit.utilities.setHref(l,"");l.removeAttributeNS(a.XLINK,"href")}if(l.nodeName=="use"&&!svgedit.utilities.getHref(l))v.removeChild(l);
else{$.each(["clip-path","fill","filter","marker-end","marker-mid","marker-start","mask","stroke"],function(P,L){var A=l.getAttribute(L);if(A)if((A=svgedit.utilities.getUrlFromAttr(A))&&A[0]!=="#"){l.setAttribute(L,"");l.removeAttribute(L)}});for(i=l.childNodes.length;i--;)svgedit.sanitize.sanitizeSvg(l.childNodes.item(i))}}else{for(f=[];l.hasChildNodes();)f.push(v.insertBefore(l.firstChild,l));v.removeChild(l);for(i=f.length;i--;)svgedit.sanitize.sanitizeSvg(f[i])}}}}})();(function(){if(!svgedit.history)svgedit.history={};svgedit.history.HistoryEventTypes={BEFORE_APPLY:"before_apply",AFTER_APPLY:"after_apply",BEFORE_UNAPPLY:"before_unapply",AFTER_UNAPPLY:"after_unapply"};svgedit.history.MoveElementCommand=function(a,G,e,m){this.elem=a;this.text=m?"Move "+a.tagName+" to "+m:"Move "+a.tagName;this.oldNextSibling=G;this.oldParent=e;this.newNextSibling=a.nextSibling;this.newParent=a.parentNode};svgedit.history.MoveElementCommand.type=function(){return"svgedit.history.MoveElementCommand"};
svgedit.history.MoveElementCommand.prototype.type=svgedit.history.MoveElementCommand.type;svgedit.history.MoveElementCommand.prototype.getText=function(){return this.text};svgedit.history.MoveElementCommand.prototype.apply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);this.elem=this.newParent.insertBefore(this.elem,this.newNextSibling);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,this)};svgedit.history.MoveElementCommand.prototype.unapply=
function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this);this.elem=this.oldParent.insertBefore(this.elem,this.oldNextSibling);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this)};svgedit.history.MoveElementCommand.prototype.elements=function(){return[this.elem]};svgedit.history.InsertElementCommand=function(a,G){this.elem=a;this.text=G||"Create "+a.tagName;this.parent=a.parentNode;this.nextSibling=this.elem.nextSibling};svgedit.history.InsertElementCommand.type=
function(){return"svgedit.history.InsertElementCommand"};svgedit.history.InsertElementCommand.prototype.type=svgedit.history.InsertElementCommand.type;svgedit.history.InsertElementCommand.prototype.getText=function(){return this.text};svgedit.history.InsertElementCommand.prototype.apply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);this.elem=this.parent.insertBefore(this.elem,this.nextSibling);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,
this)};svgedit.history.InsertElementCommand.prototype.unapply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this);this.parent=this.elem.parentNode;this.elem=this.elem.parentNode.removeChild(this.elem);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this)};svgedit.history.InsertElementCommand.prototype.elements=function(){return[this.elem]};svgedit.history.RemoveElementCommand=function(a,G,e,m){this.elem=a;this.text=m||"Delete "+a.tagName;
this.nextSibling=G;this.parent=e;svgedit.transformlist.removeElementFromListMap(a)};svgedit.history.RemoveElementCommand.type=function(){return"svgedit.history.RemoveElementCommand"};svgedit.history.RemoveElementCommand.prototype.type=svgedit.history.RemoveElementCommand.type;svgedit.history.RemoveElementCommand.prototype.getText=function(){return this.text};svgedit.history.RemoveElementCommand.prototype.apply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);
svgedit.transformlist.removeElementFromListMap(this.elem);this.parent=this.elem.parentNode;this.elem=this.parent.removeChild(this.elem);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,this)};svgedit.history.RemoveElementCommand.prototype.unapply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this);svgedit.transformlist.removeElementFromListMap(this.elem);this.nextSibling==null&&window.console&&console.log("Error: reference element was lost");
this.parent.insertBefore(this.elem,this.nextSibling);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this)};svgedit.history.RemoveElementCommand.prototype.elements=function(){return[this.elem]};svgedit.history.ChangeElementCommand=function(a,G,e){this.elem=a;this.text=e?"Change "+a.tagName+" "+e:"Change "+a.tagName;this.newValues={};this.oldValues=G;for(var m in G)this.newValues[m]=m=="#text"?a.textContent:m=="#href"?svgedit.utilities.getHref(a):a.getAttribute(m)};svgedit.history.ChangeElementCommand.type=
function(){return"svgedit.history.ChangeElementCommand"};svgedit.history.ChangeElementCommand.prototype.type=svgedit.history.ChangeElementCommand.type;svgedit.history.ChangeElementCommand.prototype.getText=function(){return this.text};svgedit.history.ChangeElementCommand.prototype.apply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);var G=false,e;for(e in this.newValues){if(this.newValues[e])if(e=="#text")this.elem.textContent=this.newValues[e];else e=="#href"?
svgedit.utilities.setHref(this.elem,this.newValues[e]):this.elem.setAttribute(e,this.newValues[e]);else if(e=="#text")this.elem.textContent="";else{this.elem.setAttribute(e,"");this.elem.removeAttribute(e)}if(e=="transform")G=true}if(!G)if(G=svgedit.utilities.getRotationAngle(this.elem)){e=elem.getBBox();G=["rotate(",G," ",e.x+e.width/2,",",e.y+e.height/2,")"].join("");G!=elem.getAttribute("transform")&&elem.setAttribute("transform",G)}a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,
this);return true};svgedit.history.ChangeElementCommand.prototype.unapply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this);var G=false,e;for(e in this.oldValues){if(this.oldValues[e])if(e=="#text")this.elem.textContent=this.oldValues[e];else e=="#href"?svgedit.utilities.setHref(this.elem,this.oldValues[e]):this.elem.setAttribute(e,this.oldValues[e]);else if(e=="#text")this.elem.textContent="";else this.elem.removeAttribute(e);if(e=="transform")G=true}if(!G)if(G=
svgedit.utilities.getRotationAngle(this.elem)){e=elem.getBBox();G=["rotate(",G," ",e.x+e.width/2,",",e.y+e.height/2,")"].join("");G!=elem.getAttribute("transform")&&elem.setAttribute("transform",G)}svgedit.transformlist.removeElementFromListMap(this.elem);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this);return true};svgedit.history.ChangeElementCommand.prototype.elements=function(){return[this.elem]};svgedit.history.BatchCommand=function(a){this.text=a||"Batch Command";
this.stack=[]};svgedit.history.BatchCommand.type=function(){return"svgedit.history.BatchCommand"};svgedit.history.BatchCommand.prototype.type=svgedit.history.BatchCommand.type;svgedit.history.BatchCommand.prototype.getText=function(){return this.text};svgedit.history.BatchCommand.prototype.apply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);for(var G=this.stack.length,e=0;e<G;++e)this.stack[e].apply(a);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,
this)};svgedit.history.BatchCommand.prototype.unapply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this);for(var G=this.stack.length-1;G>=0;G--)this.stack[G].unapply(a);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this)};svgedit.history.BatchCommand.prototype.elements=function(){for(var a=[],G=this.stack.length;G--;)for(var e=this.stack[G].elements(),m=e.length;m--;)a.indexOf(e[m])==-1&&a.push(e[m]);return a};svgedit.history.BatchCommand.prototype.addSubCommand=
function(a){this.stack.push(a)};svgedit.history.BatchCommand.prototype.isEmpty=function(){return this.stack.length===0};svgedit.history.UndoManager=function(a){this.handler_=a||null;this.undoStackPointer=0;this.undoStack=[];this.undoChangeStackPointer=-1;this.undoableChangeStack=[]};svgedit.history.UndoManager.prototype.resetUndoStack=function(){this.undoStack=[];this.undoStackPointer=0};svgedit.history.UndoManager.prototype.getUndoStackSize=function(){return this.undoStackPointer};svgedit.history.UndoManager.prototype.getRedoStackSize=
function(){return this.undoStack.length-this.undoStackPointer};svgedit.history.UndoManager.prototype.getNextUndoCommandText=function(){return this.undoStackPointer>0?this.undoStack[this.undoStackPointer-1].getText():""};svgedit.history.UndoManager.prototype.getNextRedoCommandText=function(){return this.undoStackPointer<this.undoStack.length?this.undoStack[this.undoStackPointer].getText():""};svgedit.history.UndoManager.prototype.undo=function(){this.undoStackPointer>0&&this.undoStack[--this.undoStackPointer].unapply(this.handler_)};
svgedit.history.UndoManager.prototype.redo=function(){this.undoStackPointer<this.undoStack.length&&this.undoStack.length>0&&this.undoStack[this.undoStackPointer++].apply(this.handler_)};svgedit.history.UndoManager.prototype.addCommandToHistory=function(a){if(this.undoStackPointer<this.undoStack.length&&this.undoStack.length>0)this.undoStack=this.undoStack.splice(0,this.undoStackPointer);this.undoStack.push(a);this.undoStackPointer=this.undoStack.length};svgedit.history.UndoManager.prototype.beginUndoableChange=
function(a,G){for(var e=++this.undoChangeStackPointer,m=G.length,l=Array(m),v=Array(m);m--;){var f=G[m];if(f!=null){v[m]=f;l[m]=f.getAttribute(a)}}this.undoableChangeStack[e]={attrName:a,oldValues:l,elements:v}};svgedit.history.UndoManager.prototype.finishUndoableChange=function(){for(var a=this.undoChangeStackPointer--,G=this.undoableChangeStack[a],e=G.elements.length,m=G.attrName,l=new svgedit.history.BatchCommand("Change "+m);e--;){var v=G.elements[e];if(v!=null){var f={};f[m]=G.oldValues[e];f[m]!=
v.getAttribute(m)&&l.addSubCommand(new svgedit.history.ChangeElementCommand(v,f,m))}}this.undoableChangeStack[a]=null;return l}})();var svgedit=svgedit||{};
(function(){if(!svgedit.coords)svgedit.coords={};var a=[0,"z","M","m","L","l","C","c","Q","q","A","a","H","h","V","v","S","s","T","t"],G=null;svgedit.coords.init=function(e){G=e};svgedit.coords.remapElement=function(e,m,l){for(var v=function(P,L){return svgedit.math.transformPoint(P,L,l)},f=G.getGridSnapping()&&e.parentNode.parentNode.localName==="svg",h=function(){if(f)for(var P in m)m[P]=svgedit.utilities.snapToGrid(m[P]);svgedit.utilities.assignAttributes(e,m,1E3,true)},c=svgedit.utilities.getBBox(e),
i=0;i<2;i++){var t=i===0?"fill":"stroke",n=e.getAttribute(t);if(n&&n.indexOf("url(")===0)if(l.a<0||l.d<0){n=svgedit.utilities.getRefElem(n).cloneNode(true);if(l.a<0){var p=n.getAttribute("x1"),D=n.getAttribute("x2");n.setAttribute("x1",-(p-1));n.setAttribute("x2",-(D-1))}if(l.d<0){p=n.getAttribute("y1");D=n.getAttribute("y2");n.setAttribute("y1",-(p-1));n.setAttribute("y2",-(D-1))}n.id=G.getDrawing().getNextId();svgedit.utilities.findDefs().appendChild(n);e.setAttribute(t,"url(#"+n.id+")")}}i=e.tagName;
if(i==="g"||i==="text"||i=="tspan"||i==="use")if(l.a==1&&l.b==0&&l.c==0&&l.d==1&&(l.e!=0||l.f!=0)){t=svgedit.math.transformListToTransform(e).matrix;t=svgedit.math.matrixMultiply(t.inverse(),l,t);m.x=parseFloat(m.x)+t.e;m.y=parseFloat(m.y)+t.f}else{t=svgedit.transformlist.getTransformList(e);n=svgroot.createSVGTransform();n.setMatrix(svgedit.math.matrixMultiply(svgedit.math.transformListToTransform(t).matrix,l));t.clear();t.appendItem(n)}switch(i){case "foreignObject":case "rect":case "image":if(i===
"image"&&(l.a<0||l.d<0)){t=svgedit.transformlist.getTransformList(e);n=svgroot.createSVGTransform();n.setMatrix(svgedit.math.matrixMultiply(svgedit.math.transformListToTransform(t).matrix,l));t.clear();t.appendItem(n)}else{t=v(m.x,m.y);m.width=l.a*m.width;m.height=l.d*m.height;m.x=t.x+Math.min(0,m.width);m.y=t.y+Math.min(0,m.height);m.width=Math.abs(m.width);m.height=Math.abs(m.height)}h();break;case "ellipse":v=v(m.cx,m.cy);m.cx=v.x;m.cy=v.y;m.rx=l.a*m.rx;m.ry=l.d*m.ry;m.rx=Math.abs(m.rx);m.ry=Math.abs(m.ry);
h();break;case "circle":v=v(m.cx,m.cy);m.cx=v.x;m.cy=v.y;v=svgedit.math.transformBox(c.x,c.y,c.width,c.height,l);m.r=Math.min((v.tr.x-v.tl.x)/2,(v.bl.y-v.tl.y)/2);if(m.r)m.r=Math.abs(m.r);h();break;case "line":t=v(m.x1,m.y1);n=v(m.x2,m.y2);m.x1=t.x;m.y1=t.y;m.x2=n.x;m.y2=n.y;case "text":case "tspan":case "use":h();break;case "g":(v=$(e).data("gsvg"))&&svgedit.utilities.assignAttributes(v,m,1E3,true);break;case "polyline":case "polygon":h=m.points.length;for(i=0;i<h;++i){p=m.points[i];p=v(p.x,p.y);
m.points[i].x=p.x;m.points[i].y=p.y}h=m.points.length;v="";for(i=0;i<h;++i){p=m.points[i];v+=p.x+","+p.y+" "}e.setAttribute("points",v);break;case "path":t=e.pathSegList;h=t.numberOfItems;m.d=Array(h);for(i=0;i<h;++i){c=t.getItem(i);m.d[i]={type:c.pathSegType,x:c.x,y:c.y,x1:c.x1,y1:c.y1,x2:c.x2,y2:c.y2,r1:c.r1,r2:c.r2,angle:c.angle,largeArcFlag:c.largeArcFlag,sweepFlag:c.sweepFlag}}h=m.d.length;i=m.d[0];D=v(i.x,i.y);m.d[0].x=D.x;m.d[0].y=D.y;for(i=1;i<h;++i){c=m.d[i];t=c.type;if(t%2==0){p=v(c.x!=
undefined?c.x:D.x,c.y!=undefined?c.y:D.y);t=v(c.x1,c.y1);n=v(c.x2,c.y2);c.x=p.x;c.y=p.y;c.x1=t.x;c.y1=t.y;c.x2=n.x;c.y2=n.y}else{c.x=l.a*c.x;c.y=l.d*c.y;c.x1=l.a*c.x1;c.y1=l.d*c.y1;c.x2=l.a*c.x2;c.y2=l.d*c.y2}c.r1=l.a*c.r1;c.r2=l.d*c.r2}v="";h=m.d.length;for(i=0;i<h;++i){c=m.d[i];t=c.type;v+=a[t];switch(t){case 13:case 12:v+=c.x+" ";break;case 15:case 14:v+=c.y+" ";break;case 3:case 5:case 19:case 2:case 4:case 18:v+=c.x+","+c.y+" ";break;case 7:case 6:v+=c.x1+","+c.y1+" "+c.x2+","+c.y2+" "+c.x+","+
c.y+" ";break;case 9:case 8:v+=c.x1+","+c.y1+" "+c.x+","+c.y+" ";break;case 11:case 10:v+=c.r1+","+c.r2+" "+c.angle+" "+ +c.largeArcFlag+" "+ +c.sweepFlag+" "+c.x+","+c.y+" ";break;case 17:case 16:v+=c.x2+","+c.y2+" "+c.x+","+c.y+" "}}e.setAttribute("d",v)}}})();svgedit=svgedit||{};
(function(){if(!svgedit.recalculate)svgedit.recalculate={};var a=svgedit.NS,G;svgedit.recalculate.init=function(e){G=e};svgedit.recalculate.updateClipPath=function(e,m,l){e=getRefElem(e).firstChild;var v=svgedit.transformlist.getTransformList(e),f=G.getSVGRoot().createSVGTransform();f.setTranslate(m,l);v.appendItem(f);svgedit.recalculate.recalculateDimensions(e)};svgedit.recalculate.recalculateDimensions=function(e){if(e==null)return null;if(e.nodeName=="svg"&&navigator.userAgent.indexOf("Firefox/20")>=0)return null;
var m=G.getSVGRoot(),l=svgedit.transformlist.getTransformList(e);if(l&&l.numberOfItems>0){for(var v=l.numberOfItems;v--;){var f=l.getItem(v);if(f.type===0)l.removeItem(v);else if(f.type===1)svgedit.math.isIdentity(f.matrix)&&l.removeItem(v);else f.type===4&&f.angle===0&&l.removeItem(v)}if(l.numberOfItems===1&&svgedit.utilities.getRotationAngle(e))return null}if(!l||l.numberOfItems==0){e.setAttribute("transform","");e.removeAttribute("transform");return null}if(l){v=l.numberOfItems;for(var h=[];v--;){f=
l.getItem(v);if(f.type===1)h.push([f.matrix,v]);else if(h.length)h=[]}if(h.length===2){v=m.createSVGTransformFromMatrix(svgedit.math.matrixMultiply(h[1][0],h[0][0]));l.removeItem(h[0][1]);l.removeItem(h[1][1]);l.insertItemBefore(v,h[1][1])}v=l.numberOfItems;if(v>=2&&l.getItem(v-2).type===1&&l.getItem(v-1).type===2){h=m.createSVGTransform();f=svgedit.math.matrixMultiply(l.getItem(v-2).matrix,l.getItem(v-1).matrix);h.setMatrix(f);l.removeItem(v-2);l.removeItem(v-2);l.appendItem(h)}}switch(e.tagName){case "line":case "polyline":case "polygon":case "path":break;
default:if(l.numberOfItems===1&&l.getItem(0).type===1||l.numberOfItems===2&&l.getItem(0).type===1&&l.getItem(0).type===4)return null}var c=$(e).data("gsvg");v=new svgedit.history.BatchCommand("Transform");var i={},t=null;f=[];switch(e.tagName){case "line":f=["x1","y1","x2","y2"];break;case "circle":f=["cx","cy","r"];break;case "ellipse":f=["cx","cy","rx","ry"];break;case "foreignObject":case "rect":case "image":f=["width","height","x","y"];break;case "use":case "text":case "tspan":f=["x","y"];break;
case "polygon":case "polyline":t={};t.points=e.getAttribute("points");h=e.points;var n=h.numberOfItems;i.points=Array(n);for(var p=0;p<n;++p){var D=h.getItem(p);i.points[p]={x:D.x,y:D.y}}break;case "path":t={};t.d=e.getAttribute("d");i.d=e.getAttribute("d")}if(f.length){i=$(e).attr(f);$.each(i,function(db,gb){i[db]=svgedit.units.convertToNum(db,gb)})}else if(c)i={x:$(c).attr("x")||0,y:$(c).attr("y")||0};if(t==null){t=$.extend(true,{},i);$.each(t,function(db,gb){t[db]=svgedit.units.convertToNum(db,
gb)})}t.transform=G.getStartTransform()||"";if(e.tagName=="g"&&!c||e.tagName=="a"){h=svgedit.utilities.getBBox(e);var P={x:h.x+h.width/2,y:h.y+h.height/2},L=svgedit.math.transformPoint(h.x+h.width/2,h.y+h.height/2,svgedit.math.transformListToTransform(l).matrix);f=m.createSVGMatrix();if(h=svgedit.utilities.getRotationAngle(e)){p=h*Math.PI/180;n=Math.abs(p)>1.0E-10?Math.sin(p)/(1-Math.cos(p)):2/p;for(p=0;p<l.numberOfItems;++p){f=l.getItem(p);if(f.type==4){f=f.matrix;P.y=(n*f.e+f.f)/2;P.x=(f.e-n*f.f)/
2;l.removeItem(p);break}}}p=f=c=0;var A=l.numberOfItems;if(A)var ga=l.getItem(0).matrix;if(A>=3&&l.getItem(A-2).type==3&&l.getItem(A-3).type==2&&l.getItem(A-1).type==2){p=3;var la=l.getItem(A-3).matrix,Ba=l.getItem(A-2).matrix,Ga=l.getItem(A-1).matrix;n=e.childNodes;for(D=n.length;D--;){var oa=n.item(D);f=c=0;if(oa.nodeType==1){var ia=svgedit.transformlist.getTransformList(oa);if(ia){f=svgedit.math.transformListToTransform(ia).matrix;c=svgedit.utilities.getRotationAngle(oa);var ka=G.getStartTransform(),
da=[];G.setStartTransform(oa.getAttribute("transform"));if(c||svgedit.math.hasMatrixTransform(ia)){var za=m.createSVGTransform();za.setMatrix(svgedit.math.matrixMultiply(la,Ba,Ga,f));ia.clear();ia.appendItem(za);da.push(za)}else{c=svgedit.math.matrixMultiply(f.inverse(),Ga,f);za=m.createSVGMatrix();za.e=-c.e;za.f=-c.f;f=svgedit.math.matrixMultiply(za.inverse(),f.inverse(),la,Ba,Ga,f,c.inverse());var ib=m.createSVGTransform(),jb=m.createSVGTransform(),kb=m.createSVGTransform();ib.setTranslate(c.e,
c.f);jb.setScale(f.a,f.d);kb.setTranslate(za.e,za.f);ia.appendItem(kb);ia.appendItem(jb);ia.appendItem(ib);da.push(kb);da.push(jb);da.push(ib)}v.addSubCommand(svgedit.recalculate.recalculateDimensions(oa));G.setStartTransform(ka)}}}l.removeItem(A-1);l.removeItem(A-2);l.removeItem(A-3)}else if(A>=3&&l.getItem(A-1).type==1){p=3;f=svgedit.math.transformListToTransform(l).matrix;za=m.createSVGTransform();za.setMatrix(f);l.clear();l.appendItem(za)}else if((A==1||A>1&&l.getItem(1).type!=3)&&l.getItem(0).type==
2){p=2;c=svgedit.math.transformListToTransform(l).matrix;l.removeItem(0);f=svgedit.math.transformListToTransform(l).matrix.inverse();f=svgedit.math.matrixMultiply(f,c);c=f.e;f=f.f;if(c!=0||f!=0){n=e.childNodes;D=n.length;for(A=[];D--;){oa=n.item(D);if(oa.nodeType==1){if(oa.getAttribute("clip-path")){ka=oa.getAttribute("clip-path");if(A.indexOf(ka)===-1){svgedit.recalculate.updateClipPath(ka,c,f);A.push(ka)}}ka=G.getStartTransform();G.setStartTransform(oa.getAttribute("transform"));if(ia=svgedit.transformlist.getTransformList(oa)){la=
m.createSVGTransform();la.setTranslate(c,f);ia.numberOfItems?ia.insertItemBefore(la,0):ia.appendItem(la);v.addSubCommand(svgedit.recalculate.recalculateDimensions(oa));ia=e.getElementsByTagNameNS(a.SVG,"use");oa="#"+oa.id;for(la=ia.length;la--;){Ba=ia.item(la);if(oa==svgedit.utilities.getHref(Ba)){Ga=m.createSVGTransform();Ga.setTranslate(-c,-f);svgedit.transformlist.getTransformList(Ba).insertItemBefore(Ga,0);v.addSubCommand(svgedit.recalculate.recalculateDimensions(Ba))}}G.setStartTransform(ka)}}}A=
[];G.setStartTransform(ka)}}else if(A==1&&l.getItem(0).type==1&&!h){p=1;f=l.getItem(0).matrix;n=e.childNodes;for(D=n.length;D--;){oa=n.item(D);if(oa.nodeType==1){ka=G.getStartTransform();G.setStartTransform(oa.getAttribute("transform"));if(ia=svgedit.transformlist.getTransformList(oa)){c=svgedit.math.matrixMultiply(f,svgedit.math.transformListToTransform(ia).matrix);A=m.createSVGTransform();A.setMatrix(c);ia.clear();ia.appendItem(A,0);v.addSubCommand(svgedit.recalculate.recalculateDimensions(oa));
G.setStartTransform(ka);ka=oa.getAttribute("stroke-width");oa.getAttribute("stroke")!=="none"&&!isNaN(ka)&&oa.setAttribute("stroke-width",ka*((Math.abs(c.a)+Math.abs(c.d))/2))}}}l.clear()}else{if(h){m=m.createSVGTransform();m.setRotate(h,L.x,L.y);l.numberOfItems?l.insertItemBefore(m,0):l.appendItem(m)}l.numberOfItems==0&&e.removeAttribute("transform");return null}if(p==2){if(h){L={x:P.x+ga.e,y:P.y+ga.f};m=m.createSVGTransform();m.setRotate(h,L.x,L.y);l.numberOfItems?l.insertItemBefore(m,0):l.appendItem(m)}}else if(p==
3){f=svgedit.math.transformListToTransform(l).matrix;ga=m.createSVGTransform();ga.setRotate(h,P.x,P.y);ga=ga.matrix;P=m.createSVGTransform();P.setRotate(h,L.x,L.y);L=P.matrix.inverse();ka=f.inverse();L=svgedit.math.matrixMultiply(ka,L,ga,f);c=L.e;f=L.f;if(c!=0||f!=0){n=e.childNodes;for(D=n.length;D--;){oa=n.item(D);if(oa.nodeType==1){ka=G.getStartTransform();G.setStartTransform(oa.getAttribute("transform"));ia=svgedit.transformlist.getTransformList(oa);la=m.createSVGTransform();la.setTranslate(c,
f);ia.numberOfItems?ia.insertItemBefore(la,0):ia.appendItem(la);v.addSubCommand(svgedit.recalculate.recalculateDimensions(oa));G.setStartTransform(ka)}}}if(h)l.numberOfItems?l.insertItemBefore(P,0):l.appendItem(P)}}else{h=svgedit.utilities.getBBox(e);if(!h&&e.tagName!="path")return null;f=m.createSVGMatrix();if(c=svgedit.utilities.getRotationAngle(e)){P={x:h.x+h.width/2,y:h.y+h.height/2};L=svgedit.math.transformPoint(h.x+h.width/2,h.y+h.height/2,svgedit.math.transformListToTransform(l).matrix);p=
c*Math.PI/180;n=Math.abs(p)>1.0E-10?Math.sin(p)/(1-Math.cos(p)):2/p;for(p=0;p<l.numberOfItems;++p){f=l.getItem(p);if(f.type==4){f=f.matrix;P.y=(n*f.e+f.f)/2;P.x=(f.e-n*f.f)/2;l.removeItem(p);break}}}p=0;A=l.numberOfItems;if(!svgedit.browser.isWebkit())if((ga=e.getAttribute("fill"))&&ga.indexOf("url(")===0){ga=getRefElem(ga);ka="pattern";if(ga.tagName!==ka)ka="gradient";if(ga.getAttribute(ka+"Units")==="userSpaceOnUse"){f=svgedit.math.transformListToTransform(l).matrix;h=svgedit.transformlist.getTransformList(ga);
h=svgedit.math.transformListToTransform(h).matrix;f=svgedit.math.matrixMultiply(f,h);h="matrix("+[f.a,f.b,f.c,f.d,f.e,f.f].join(",")+")";ga.setAttribute(ka+"Transform",h)}}if(A>=3&&l.getItem(A-2).type==3&&l.getItem(A-3).type==2&&l.getItem(A-1).type==2){p=3;f=svgedit.math.transformListToTransform(l,A-3,A-1).matrix;l.removeItem(A-1);l.removeItem(A-2);l.removeItem(A-3)}else if(A==4&&l.getItem(A-1).type==1){p=3;f=svgedit.math.transformListToTransform(l).matrix;za=m.createSVGTransform();za.setMatrix(f);
l.clear();l.appendItem(za);f=m.createSVGMatrix()}else if((A==1||A>1&&l.getItem(1).type!=3)&&l.getItem(0).type==2){p=2;ga=l.getItem(0).matrix;ka=svgedit.math.transformListToTransform(l,1).matrix;h=ka.inverse();f=svgedit.math.matrixMultiply(h,ga,ka);l.removeItem(0)}else if(A==1&&l.getItem(0).type==1&&!c){f=svgedit.math.transformListToTransform(l).matrix;switch(e.tagName){case "line":i=$(e).attr(["x1","y1","x2","y2"]);case "polyline":case "polygon":i.points=e.getAttribute("points");if(i.points){h=e.points;
n=h.numberOfItems;i.points=Array(n);for(p=0;p<n;++p){D=h.getItem(p);i.points[p]={x:D.x,y:D.y}}}case "path":i.d=e.getAttribute("d");p=1;l.clear()}}else{p=4;if(c){m=m.createSVGTransform();m.setRotate(c,L.x,L.y);l.numberOfItems?l.insertItemBefore(m,0):l.appendItem(m)}l.numberOfItems==0&&e.removeAttribute("transform");return null}if(p==1||p==2||p==3)svgedit.coords.remapElement(e,i,f);if(p==2){if(c){svgedit.math.hasMatrixTransform(l)||(L={x:P.x+f.e,y:P.y+f.f});m=m.createSVGTransform();m.setRotate(c,L.x,
L.y);l.numberOfItems?l.insertItemBefore(m,0):l.appendItem(m)}if(e.tagName=="text"){n=e.childNodes;for(D=n.length;D--;){oa=n.item(D);if(oa.tagName=="tspan"){m={x:$(oa).attr("x")||0,y:$(oa).attr("y")||0};svgedit.coords.remapElement(oa,m,f)}}}}else if(p==3&&c){f=svgedit.math.transformListToTransform(l).matrix;ga=m.createSVGTransform();ga.setRotate(c,P.x,P.y);ga=ga.matrix;P=m.createSVGTransform();P.setRotate(c,L.x,L.y);L=P.matrix.inverse();ka=f.inverse();L=svgedit.math.matrixMultiply(ka,L,ga,f);svgedit.coords.remapElement(e,
i,L);if(c)l.numberOfItems?l.insertItemBefore(P,0):l.appendItem(P)}}l.numberOfItems==0&&e.removeAttribute("transform");v.addSubCommand(new svgedit.history.ChangeElementCommand(e,t));return v}})();(function(){if(!svgedit.select)svgedit.select={};var a,G,e,m=svgedit.browser.isTouch()?10:4;svgedit.select.Selector=function(l,v){this.id=l;this.selectedElement=v;this.locked=true;this.selectorGroup=a.createSVGElement({element:"g",attr:{id:"selectorGroup"+this.id}});this.selectorRect=this.selectorGroup.appendChild(a.createSVGElement({element:"path",attr:{id:"selectedBox"+this.id,fill:"none",stroke:"#22C","stroke-width":"1","stroke-dasharray":"5,5",style:"pointer-events:none"}}));this.gripCoords={nw:null,
n:null,ne:null,e:null,se:null,s:null,sw:null,w:null};this.reset(this.selectedElement)};svgedit.select.Selector.prototype.reset=function(l){this.locked=true;this.selectedElement=l;this.resize();this.selectorGroup.setAttribute("display","inline")};svgedit.select.Selector.prototype.updateGripCursors=function(l){var v=[];l=Math.round(l/45);if(l<0)l+=8;for(var f in e.selectorGrips)v.push(f);for(;l>0;){v.push(v.shift());l--}l=0;for(f in e.selectorGrips){e.selectorGrips[f].setAttribute("style","cursor:"+
v[l]+"-resize");l++}};svgedit.select.Selector.prototype.showGrips=function(l){e.selectorGripsGroup.setAttribute("display",l?"inline":"none");var v=this.selectedElement;this.hasGrips=l;if(v&&l){this.selectorGroup.appendChild(e.selectorGripsGroup);this.updateGripCursors(svgedit.utilities.getRotationAngle(v))}};svgedit.select.Selector.prototype.resize=function(){var l=this.selectorRect,v=e,f=v.selectorGrips,h=this.selectedElement,c=h.getAttribute("stroke-width"),i=a.currentZoom(),t=1/i;if(h.getAttribute("stroke")!==
"none"&&!isNaN(c))t+=c/2;var n=h.tagName;if(n==="text")t+=2/i;c=svgedit.transformlist.getTransformList(h);c=svgedit.math.transformListToTransform(c).matrix;c.e*=i;c.f*=i;var p=svgedit.utilities.getBBox(h);if(n==="g"&&!$.data(h,"gsvg"))if(n=a.getStrokedBBox(h.childNodes))p=n;n=p.x;var D=p.y,P=p.width;p=p.height;t*=i;i=svgedit.math.transformBox(n*i,D*i,P*i,p*i,c);c=i.aabox;n=c.x-t;D=c.y-t;P=c.width+t*2;var L=c.height+t*2;c=n+P/2;p=D+L/2;if(h=svgedit.utilities.getRotationAngle(h)){n=a.svgRoot().createSVGTransform();
n.setRotate(-h,c,p);n=n.matrix;i.tl=svgedit.math.transformPoint(i.tl.x,i.tl.y,n);i.tr=svgedit.math.transformPoint(i.tr.x,i.tr.y,n);i.bl=svgedit.math.transformPoint(i.bl.x,i.bl.y,n);i.br=svgedit.math.transformPoint(i.br.x,i.br.y,n);n=i.tl;P=n.x;L=n.y;var A=n.x,ga=n.y;n=Math.min;D=Math.max;P=n(P,n(i.tr.x,n(i.bl.x,i.br.x)))-t;L=n(L,n(i.tr.y,n(i.bl.y,i.br.y)))-t;A=D(A,D(i.tr.x,D(i.bl.x,i.br.x)))+t;ga=D(ga,D(i.tr.y,D(i.bl.y,i.br.y)))+t;n=P;D=L;P=A-P;L=ga-L}t=a.svgRoot().suspendRedraw(100);l.setAttribute("d",
"M"+n+","+D+" L"+(n+P)+","+D+" "+(n+P)+","+(D+L)+" "+n+","+(D+L)+"z");this.selectorGroup.setAttribute("transform",h?"rotate("+[h,c,p].join(",")+")":"");this.gripCoords={nw:[n,D],ne:[n+P,D],sw:[n,D+L],se:[n+P,D+L],n:[n+P/2,D],w:[n,D+L/2],e:[n+P,D+L/2],s:[n+P/2,D+L]};for(var la in this.gripCoords){l=this.gripCoords[la];f[la].setAttribute("cx",l[0]);f[la].setAttribute("cy",l[1])}v.rotateGripConnector.setAttribute("x1",n+P/2);v.rotateGripConnector.setAttribute("y1",D);v.rotateGripConnector.setAttribute("x2",
n+P/2);v.rotateGripConnector.setAttribute("y2",D-m*5);v.rotateGrip.setAttribute("cx",n+P/2);v.rotateGrip.setAttribute("cy",D-m*5);a.svgRoot().unsuspendRedraw(t)};svgedit.select.SelectorManager=function(){this.rubberBandBox=this.selectorParentGroup=null;this.selectors=[];this.selectorMap={};this.selectorGrips={nw:null,n:null,ne:null,e:null,se:null,s:null,sw:null,w:null};this.rotateGrip=this.rotateGripConnector=this.selectorGripsGroup=null;this.initGroup()};svgedit.select.SelectorManager.prototype.initGroup=
function(){this.selectorParentGroup&&this.selectorParentGroup.parentNode&&this.selectorParentGroup.parentNode.removeChild(this.selectorParentGroup);this.selectorParentGroup=a.createSVGElement({element:"g",attr:{id:"selectorParentGroup"}});this.selectorGripsGroup=a.createSVGElement({element:"g",attr:{display:"none"}});this.selectorParentGroup.appendChild(this.selectorGripsGroup);a.svgRoot().appendChild(this.selectorParentGroup);this.selectorMap={};this.selectors=[];this.rubberBandBox=null;for(var l in this.selectorGrips){var v=
a.createSVGElement({element:"circle",attr:{id:"selectorGrip_resize_"+l,fill:"#22C",r:m,style:"cursor:"+l+"-resize","stroke-width":2,"pointer-events":"all"}});$.data(v,"dir",l);$.data(v,"type","resize");this.selectorGrips[l]=this.selectorGripsGroup.appendChild(v)}this.rotateGripConnector=this.selectorGripsGroup.appendChild(a.createSVGElement({element:"line",attr:{id:"selectorGrip_rotateconnector",stroke:"#22C","stroke-width":"1"}}));this.rotateGrip=this.selectorGripsGroup.appendChild(a.createSVGElement({element:"circle",
attr:{id:"selectorGrip_rotate",fill:"lime",r:m,stroke:"#22C","stroke-width":2,style:"cursor:url("+G.imgPath+"rotate.png) 12 12, auto;"}}));$.data(this.rotateGrip,"type","rotate");if(!$("#canvasBackground").length){l=G.dimensions;l=a.createSVGElement({element:"svg",attr:{id:"canvasBackground",width:l[0],height:l[1],x:0,y:0,overflow:svgedit.browser.isWebkit()?"none":"visible",style:"pointer-events:none"}});v=a.createSVGElement({element:"rect",attr:{width:"100%",height:"100%",x:0,y:0,"stroke-width":1,
stroke:"#000",fill:"#FFF",style:"pointer-events:none"}});l.appendChild(v);a.svgRoot().insertBefore(l,a.svgContent())}};svgedit.select.SelectorManager.prototype.requestSelector=function(l){if(l==null)return null;var v=this.selectors.length;if(typeof this.selectorMap[l.id]=="object"){this.selectorMap[l.id].locked=true;return this.selectorMap[l.id]}for(var f=0;f<v;++f)if(this.selectors[f]&&!this.selectors[f].locked){this.selectors[f].locked=true;this.selectors[f].reset(l);this.selectorMap[l.id]=this.selectors[f];
return this.selectors[f]}this.selectors[v]=new svgedit.select.Selector(v,l);this.selectorParentGroup.appendChild(this.selectors[v].selectorGroup);this.selectorMap[l.id]=this.selectors[v];return this.selectors[v]};svgedit.select.SelectorManager.prototype.releaseSelector=function(l){if(l!=null)for(var v=this.selectors.length,f=this.selectorMap[l.id],h=0;h<v;++h)if(this.selectors[h]&&this.selectors[h]==f){f.locked==false&&console.log("WARNING! selector was released but was already unlocked");delete this.selectorMap[l.id];
f.locked=false;f.selectedElement=null;f.showGrips(false);try{f.selectorGroup.setAttribute("display","none")}catch(c){}break}};svgedit.select.SelectorManager.prototype.getRubberBandBox=function(){if(!this.rubberBandBox)this.rubberBandBox=this.selectorParentGroup.appendChild(a.createSVGElement({element:"rect",attr:{id:"selectorRubberBand",fill:"#22C","fill-opacity":0.15,stroke:"#22C","stroke-width":0.5,display:"none",style:"pointer-events:none"}}));return this.rubberBandBox};svgedit.select.init=function(l,
v){G=l;a=v;e=new svgedit.select.SelectorManager};svgedit.select.getSelectorManager=function(){return e}})();(function(){if(!svgedit.draw)svgedit.draw={};var a=svgedit.NS,G="a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use".split(","),e={LET_DOCUMENT_DECIDE:0,ALWAYS_RANDOMIZE:1,NEVER_RANDOMIZE:2},m=e.LET_DOCUMENT_DECIDE;svgedit.draw.Layer=function(l,v){this.name_=l;this.group_=v};svgedit.draw.Layer.prototype.getName=function(){return this.name_};svgedit.draw.Layer.prototype.getGroup=function(){return this.group_};svgedit.draw.randomizeIds=function(l,v){m=l===false?
e.NEVER_RANDOMIZE:e.ALWAYS_RANDOMIZE;if(m==e.ALWAYS_RANDOMIZE&&!v.getNonce())v.setNonce(Math.floor(Math.random()*100001));else m==e.NEVER_RANDOMIZE&&v.getNonce()&&v.clearNonce()};svgedit.draw.Drawing=function(l,v){if(!l||!l.tagName||!l.namespaceURI||l.tagName!="svg"||l.namespaceURI!=a.SVG)throw"Error: svgedit.draw.Drawing instance initialized without a <svg> element";this.svgElem_=l;this.obj_num=0;this.idPrefix=v||"svg_";this.releasedNums=[];this.all_layers=[];this.current_layer=null;this.nonce_=
"";var f=this.svgElem_.getAttributeNS(a.SE,"nonce");if(f&&m!=e.NEVER_RANDOMIZE)this.nonce_=f;else m==e.ALWAYS_RANDOMIZE&&this.setNonce(Math.floor(Math.random()*100001))};svgedit.draw.Drawing.prototype.getElem_=function(l){if(this.svgElem_.querySelector)return this.svgElem_.querySelector("#"+l);return $(this.svgElem_).find("[id="+l+"]")[0]};svgedit.draw.Drawing.prototype.getSvgElem=function(){return this.svgElem_};svgedit.draw.Drawing.prototype.getNonce=function(){return this.nonce_};svgedit.draw.Drawing.prototype.setNonce=
function(l){this.svgElem_.setAttributeNS(a.XMLNS,"xmlns:se",a.SE);this.svgElem_.setAttributeNS(a.SE,"se:nonce",l);this.nonce_=l};svgedit.draw.Drawing.prototype.clearNonce=function(){this.nonce_=""};svgedit.draw.Drawing.prototype.getId=function(){return this.nonce_?this.idPrefix+this.nonce_+"_"+this.obj_num:this.idPrefix+this.obj_num};svgedit.draw.Drawing.prototype.getNextId=function(){var l=this.obj_num,v=false;if(this.releasedNums.length>0){this.obj_num=this.releasedNums.pop();v=true}else this.obj_num++;
for(var f=this.getId();this.getElem_(f);){if(v){this.obj_num=l;v=false}this.obj_num++;f=this.getId()}if(v)this.obj_num=l;return f};svgedit.draw.Drawing.prototype.releaseId=function(l){var v=this.idPrefix+(this.nonce_?this.nonce_+"_":"");if(typeof l!="string"||l.indexOf(v)!=0)return false;l=parseInt(l.substr(v.length));if(typeof l!="number"||l<=0||this.releasedNums.indexOf(l)!=-1)return false;this.releasedNums.push(l);return true};svgedit.draw.Drawing.prototype.getNumLayers=function(){return this.all_layers.length};
svgedit.draw.Drawing.prototype.hasLayer=function(l){for(var v=0;v<this.getNumLayers();v++)if(this.all_layers[v][0]==l)return true;return false};svgedit.draw.Drawing.prototype.getLayerName=function(l){if(l>=0&&l<this.getNumLayers())return this.all_layers[l][0];return""};svgedit.draw.Drawing.prototype.getCurrentLayer=function(){return this.current_layer};svgedit.draw.Drawing.prototype.getCurrentLayerName=function(){for(var l=0;l<this.getNumLayers();++l)if(this.all_layers[l][1]==this.current_layer)return this.getLayerName(l);
return""};svgedit.draw.Drawing.prototype.setCurrentLayer=function(l){for(var v=0;v<this.getNumLayers();++v)if(l==this.getLayerName(v)){if(this.current_layer!=this.all_layers[v][1]){this.current_layer.setAttribute("style","pointer-events:none");this.current_layer=this.all_layers[v][1];this.current_layer.setAttribute("style","pointer-events:all")}return true}return false};svgedit.draw.Drawing.prototype.deleteCurrentLayer=function(){if(this.current_layer&&this.getNumLayers()>1){var l=this.current_layer.parentNode.removeChild(this.current_layer);
this.identifyLayers();return l}return null};svgedit.draw.Drawing.prototype.identifyLayers=function(){this.all_layers=[];for(var l=this.svgElem_.childNodes.length,v=[],f=[],h=null,c=false,i=0;i<l;++i){var t=this.svgElem_.childNodes.item(i);if(t&&t.nodeType==1)if(t.tagName=="g"){c=true;var n=$("title",t).text();if(!n&&svgedit.browser.isOpera()&&t.querySelectorAll)n=$(t.querySelectorAll("title")).text();if(n){f.push(n);this.all_layers.push([n,t]);h=t;svgedit.utilities.walkTree(t,function(p){p.setAttribute("style",
"pointer-events:inherit")});h.setAttribute("style","pointer-events:none")}else v.push(t)}else if(~G.indexOf(t.nodeName)){svgedit.utilities.getBBox(t);v.push(t)}}l=this.svgElem_.ownerDocument;if(v.length>0||!c){for(i=1;f.indexOf("Layer "+i)>=0;)i++;f="Layer "+i;h=l.createElementNS(a.SVG,"g");c=l.createElementNS(a.SVG,"title");c.textContent=f;h.appendChild(c);for(c=0;c<v.length;++c)h.appendChild(v[c]);this.svgElem_.appendChild(h);this.all_layers.push([f,h])}svgedit.utilities.walkTree(h,function(p){p.setAttribute("style",
"pointer-events:inherit")});this.current_layer=h;this.current_layer.setAttribute("style","pointer-events:all")};svgedit.draw.Drawing.prototype.createLayer=function(l){var v=this.svgElem_.ownerDocument,f=v.createElementNS(a.SVG,"g");v=v.createElementNS(a.SVG,"title");v.textContent=l;f.appendChild(v);this.svgElem_.appendChild(f);this.identifyLayers();return f};svgedit.draw.Drawing.prototype.getLayerVisibility=function(l){for(var v=null,f=0;f<this.getNumLayers();++f)if(this.getLayerName(f)==l){v=this.all_layers[f][1];
break}if(!v)return false;return v.getAttribute("display")!="none"};svgedit.draw.Drawing.prototype.setLayerVisibility=function(l,v){if(typeof v!="boolean")return null;for(var f=null,h=0;h<this.getNumLayers();++h)if(this.getLayerName(h)==l){f=this.all_layers[h][1];break}if(!f)return null;f.getAttribute("display");f.setAttribute("display",v?"inline":"none");return f};svgedit.draw.Drawing.prototype.getLayerOpacity=function(l){for(var v=0;v<this.getNumLayers();++v)if(this.getLayerName(v)==l){(l=this.all_layers[v][1].getAttribute("opacity"))||
(l="1.0");return parseFloat(l)}return null};svgedit.draw.Drawing.prototype.setLayerOpacity=function(l,v){if(!(typeof v!="number"||v<0||v>1))for(var f=0;f<this.getNumLayers();++f)if(this.getLayerName(f)==l){this.all_layers[f][1].setAttribute("opacity",v);break}}})();(function(){if(!svgedit.path)svgedit.path={};var a=svgedit.NS,G={pathNodeTooltip:"Drag node to move it. Double-click node to change segment type",pathCtrlPtTooltip:"Drag control point to adjust curve properties"},e={2:["x","y"],4:["x","y"],6:["x","y","x1","y1","x2","y2"],8:["x","y","x1","y1"],10:["x","y","r1","r2","angle","largeArcFlag","sweepFlag"],12:["x"],14:["y"],16:["x","y","x2","y2"],18:["x","y"]},m=[],l=true,v={};svgedit.path.setLinkControlPoints=function(c){l=c};var f=svgedit.path.path=null;
svgedit.path.init=function(c){f=c;m=[0,"ClosePath"];$.each(["Moveto","Lineto","CurvetoCubic","CurvetoQuadratic","Arc","LinetoHorizontal","LinetoVertical","CurvetoCubicSmooth","CurvetoQuadraticSmooth"],function(i,t){m.push(t+"Abs");m.push(t+"Rel")})};svgedit.path.insertItemBefore=function(c,i,t){c=c.pathSegList;if(svgedit.browser.supportsPathInsertItemBefore())c.insertItemBefore(i,t);else{for(var n=c.numberOfItems,p=[],D=0;D<n;D++){var P=c.getItem(D);p.push(P)}c.clear();for(D=0;D<n;D++){D==t&&c.appendItem(i);
c.appendItem(p[D])}}};svgedit.path.ptObjToArr=function(c,i){for(var t=e[c],n=t.length,p=Array(n),D=0;D<n;D++)p[D]=i[t[D]];return p};svgedit.path.getGripPt=function(c,i){var t={x:i?i.x:c.item.x,y:i?i.y:c.item.y},n=c.path;if(n.matrix)t=svgedit.math.transformPoint(t.x,t.y,n.matrix);t.x*=f.getCurrentZoom();t.y*=f.getCurrentZoom();return t};svgedit.path.getPointFromGrip=function(c,i){var t={x:c.x,y:c.y};if(i.matrix){c=svgedit.math.transformPoint(t.x,t.y,i.imatrix);t.x=c.x;t.y=c.y}t.x/=f.getCurrentZoom();
t.y/=f.getCurrentZoom();return t};svgedit.path.addPointGrip=function(c,i,t){var n=svgedit.path.getGripContainer(),p=svgedit.utilities.getElem("pathpointgrip_"+c);if(!p){p=document.createElementNS(a.SVG,"circle");svgedit.utilities.assignAttributes(p,{id:"pathpointgrip_"+c,display:"none",r:4,fill:"#0FF",stroke:"#00F","stroke-width":2,cursor:"move",style:"pointer-events:all","xlink:title":G.pathNodeTooltip});p=n.appendChild(p);$("#pathpointgrip_"+c).dblclick(function(){svgedit.path.path&&svgedit.path.path.setSegType()})}i&&
t&&svgedit.utilities.assignAttributes(p,{cx:i,cy:t,display:"inline"});return p};svgedit.path.getGripContainer=function(){var c=svgedit.utilities.getElem("pathpointgrip_container");if(!c){c=svgedit.utilities.getElem("selectorParentGroup").appendChild(document.createElementNS(a.SVG,"g"));c.id="pathpointgrip_container"}return c};svgedit.path.addCtrlGrip=function(c){var i=svgedit.utilities.getElem("ctrlpointgrip_"+c);if(i)return i;i=document.createElementNS(a.SVG,"circle");svgedit.utilities.assignAttributes(i,
{id:"ctrlpointgrip_"+c,display:"none",r:4,fill:"#0FF",stroke:"#55F","stroke-width":1,cursor:"move",style:"pointer-events:all","xlink:title":G.pathCtrlPtTooltip});svgedit.path.getGripContainer().appendChild(i);return i};svgedit.path.getCtrlLine=function(c){var i=svgedit.utilities.getElem("ctrlLine_"+c);if(i)return i;i=document.createElementNS(a.SVG,"line");svgedit.utilities.assignAttributes(i,{id:"ctrlLine_"+c,stroke:"#555","stroke-width":1,style:"pointer-events:none"});svgedit.path.getGripContainer().appendChild(i);
return i};svgedit.path.getPointGrip=function(c,i){var t=svgedit.path.addPointGrip(c.index);if(i){var n=svgedit.path.getGripPt(c);svgedit.utilities.assignAttributes(t,{cx:n.x,cy:n.y,display:"inline"})}return t};svgedit.path.getControlPoints=function(c){var i=c.item,t=c.index;if(!("x1"in i)||!("x2"in i))return null;var n={};svgedit.path.getGripContainer();for(var p=[svgedit.path.path.segs[t-1].item,i],D=1;D<3;D++){var P=t+"c"+D,L=n["c"+D+"_line"]=svgedit.path.getCtrlLine(P),A=svgedit.path.getGripPt(c,
{x:i["x"+D],y:i["y"+D]}),ga=svgedit.path.getGripPt(c,{x:p[D-1].x,y:p[D-1].y});svgedit.utilities.assignAttributes(L,{x1:A.x,y1:A.y,x2:ga.x,y2:ga.y,display:"inline"});n["c"+D+"_line"]=L;pointGrip=n["c"+D]=svgedit.path.addCtrlGrip(P);svgedit.utilities.assignAttributes(pointGrip,{cx:A.x,cy:A.y,display:"inline"});n["c"+D]=pointGrip}return n};svgedit.path.replacePathSeg=function(c,i,t,n){n=n||svgedit.path.path.elem;c=n["createSVGPathSeg"+m[c]].apply(n,t);if(svgedit.browser.supportsPathReplaceItem())n.pathSegList.replaceItem(c,
i);else{t=n.pathSegList;n=t.numberOfItems;for(var p=[],D=0;D<n;D++){var P=t.getItem(D);p.push(P)}t.clear();for(D=0;D<n;D++)D==i?t.appendItem(c):t.appendItem(p[D])}};svgedit.path.getSegSelector=function(c,i){var t=c.index,n=svgedit.utilities.getElem("segline_"+t);if(!n){var p=svgedit.path.getGripContainer();n=document.createElementNS(a.SVG,"path");svgedit.utilities.assignAttributes(n,{id:"segline_"+t,display:"none",fill:"none",stroke:"#0FF","stroke-width":2,style:"pointer-events:none",d:"M0,0 0,0"});
p.appendChild(n)}if(i){t=c.prev;if(!t){n.setAttribute("display","none");return n}t=svgedit.path.getGripPt(t);svgedit.path.replacePathSeg(2,0,[t.x,t.y],n);p=svgedit.path.ptObjToArr(c.type,c.item,true);for(var D=0;D<p.length;D+=2){t=svgedit.path.getGripPt(c,{x:p[D],y:p[D+1]});p[D]=t.x;p[D+1]=t.y}svgedit.path.replacePathSeg(c.type,1,p,n)}return n};svgedit.path.smoothControlPoints=function(c,i,t){var n=c.x-t.x,p=c.y-t.y,D=i.x-t.x,P=i.y-t.y;if((n!=0||p!=0)&&(D!=0||P!=0)){c=Math.atan2(p,n);i=Math.atan2(P,
D);n=Math.sqrt(n*n+p*p);D=Math.sqrt(D*D+P*P);p=f.getSVGRoot().createSVGPoint();P=f.getSVGRoot().createSVGPoint();if(c<0)c+=2*Math.PI;if(i<0)i+=2*Math.PI;var L=Math.abs(c-i),A=Math.abs(Math.PI-L)/2;if(c-i>0){c=L<Math.PI?c+A:c-A;i=L<Math.PI?i-A:i+A}else{c=L<Math.PI?c-A:c+A;i=L<Math.PI?i+A:i-A}p.x=n*Math.cos(c)+t.x;p.y=n*Math.sin(c)+t.y;P.x=D*Math.cos(i)+t.x;P.y=D*Math.sin(i)+t.y;return[p,P]}};svgedit.path.Segment=function(c,i){this.selected=false;this.index=c;this.item=i;this.type=i.pathSegType;this.ctrlpts=
[];this.segsel=this.ptgrip=null};svgedit.path.Segment.prototype.showCtrlPts=function(c){for(var i in this.ctrlpts)this.ctrlpts[i].setAttribute("display",c?"inline":"none")};svgedit.path.Segment.prototype.selectCtrls=function(c){$("#ctrlpointgrip_"+this.index+"c1, #ctrlpointgrip_"+this.index+"c2").attr("fill",c?"#0FF":"#EEE")};svgedit.path.Segment.prototype.show=function(c){if(this.ptgrip){this.ptgrip.setAttribute("display",c?"inline":"none");this.segsel.setAttribute("display",c?"inline":"none");this.showCtrlPts(c)}};
svgedit.path.Segment.prototype.select=function(c){if(this.ptgrip){this.ptgrip.setAttribute("stroke",c?"#0FF":"#00F");this.segsel.setAttribute("display",c?"inline":"none");this.ctrlpts&&this.selectCtrls(c);this.selected=c}};svgedit.path.Segment.prototype.addGrip=function(){this.ptgrip=svgedit.path.getPointGrip(this,true);this.ctrlpts=svgedit.path.getControlPoints(this,true);this.segsel=svgedit.path.getSegSelector(this,true)};svgedit.path.Segment.prototype.update=function(c){if(this.ptgrip){var i=svgedit.path.getGripPt(this);
svgedit.utilities.assignAttributes(this.ptgrip,{cx:i.x,cy:i.y});svgedit.path.getSegSelector(this,true);if(this.ctrlpts){if(c){this.item=svgedit.path.path.elem.pathSegList.getItem(this.index);this.type=this.item.pathSegType}svgedit.path.getControlPoints(this)}}};svgedit.path.Segment.prototype.move=function(c,i){var t=this.item;t=this.ctrlpts?[t.x+=c,t.y+=i,t.x1,t.y1,t.x2+=c,t.y2+=i]:[t.x+=c,t.y+=i];svgedit.path.replacePathSeg(this.type,this.index,t);if(this.next&&this.next.ctrlpts){t=this.next.item;
t=[t.x,t.y,t.x1+=c,t.y1+=i,t.x2,t.y2];svgedit.path.replacePathSeg(this.next.type,this.next.index,t)}if(this.mate){t=this.mate.item;t=[t.x+=c,t.y+=i];svgedit.path.replacePathSeg(this.mate.type,this.mate.index,t)}this.update(true);this.next&&this.next.update(true)};svgedit.path.Segment.prototype.setLinked=function(c){var i,t,n;if(c==2){t=1;i=this.next;if(!i)return;n=this.item}else{t=2;i=this.prev;if(!i)return;n=i.item}var p=i.item;p["x"+t]=n.x+(n.x-this.item["x"+c]);p["y"+t]=n.y+(n.y-this.item["y"+
c]);svgedit.path.replacePathSeg(i.type,i.index,[p.x,p.y,p.x1,p.y1,p.x2,p.y2]);i.update(true)};svgedit.path.Segment.prototype.moveCtrl=function(c,i,t){var n=this.item;n["x"+c]+=i;n["y"+c]+=t;svgedit.path.replacePathSeg(this.type,this.index,[n.x,n.y,n.x1,n.y1,n.x2,n.y2]);this.update(true)};svgedit.path.Segment.prototype.setType=function(c,i){svgedit.path.replacePathSeg(c,this.index,i);this.type=c;this.item=svgedit.path.path.elem.pathSegList.getItem(this.index);this.showCtrlPts(c===6);this.ctrlpts=svgedit.path.getControlPoints(this);
this.update(true)};svgedit.path.Path=function(c){if(!c||c.tagName!=="path")throw"svgedit.path.Path constructed without a <path> element";this.elem=c;this.segs=[];this.selected_pts=[];svgedit.path.path=this;this.init()};svgedit.path.Path.prototype.init=function(){$(svgedit.path.getGripContainer()).find("*").attr("display","none");var c=this.elem.pathSegList,i=c.numberOfItems;this.segs=[];this.selected_pts=[];this.first_seg=null;for(var t=0;t<i;t++){var n=c.getItem(t);n=new svgedit.path.Segment(t,n);
n.path=this;this.segs.push(n)}c=this.segs;n=null;for(t=0;t<i;t++){var p=c[t],D=t+1>=i?null:c[t+1],P=t-1<0?null:c[t-1];if(p.type===2){if(P&&P.type!==1){D=c[n];D.next=c[n+1];D.next.prev=D;D.addGrip()}n=t}else if(D&&D.type===1){p.next=c[n+1];p.next.prev=p;p.mate=c[n];p.addGrip();if(this.first_seg==null)this.first_seg=p}else if(D){if(p.type!==1){p.addGrip();if(D&&D.type!==2){p.next=D;p.next.prev=p}}}else if(p.type!==1){D=c[n];D.next=c[n+1];D.next.prev=D;D.addGrip();p.addGrip();if(!this.first_seg)this.first_seg=
c[n]}}return this};svgedit.path.Path.prototype.eachSeg=function(c){for(var i=this.segs.length,t=0;t<i;t++)if(c.call(this.segs[t],t)===false)break};svgedit.path.Path.prototype.addSeg=function(c){var i=this.segs[c];if(i.prev){var t=i.prev,n;switch(i.item.pathSegType){case 4:var p=(i.item.x+t.item.x)/2,D=(i.item.y+t.item.y)/2;n=this.elem.createSVGPathSegLinetoAbs(p,D);break;case 6:n=(t.item.x+i.item.x1)/2;var P=(i.item.x1+i.item.x2)/2,L=(i.item.x2+i.item.x)/2,A=(n+P)/2;P=(P+L)/2;p=(A+P)/2;var ga=(t.item.y+
i.item.y1)/2,la=(i.item.y1+i.item.y2)/2;t=(i.item.y2+i.item.y)/2;var Ba=(ga+la)/2;la=(la+t)/2;D=(Ba+la)/2;n=this.elem.createSVGPathSegCurvetoCubicAbs(p,D,n,ga,A,Ba);svgedit.path.replacePathSeg(i.type,c,[i.item.x,i.item.y,P,la,L,t])}svgedit.path.insertItemBefore(this.elem,n,c)}};svgedit.path.Path.prototype.deleteSeg=function(c){var i=this.segs[c],t=this.elem.pathSegList;i.show(false);var n=i.next;if(i.mate){var p=[n.item.x,n.item.y];svgedit.path.replacePathSeg(2,n.index,p);svgedit.path.replacePathSeg(4,
i.index,p);t.removeItem(i.mate.index)}else{if(!i.prev){p=[n.item.x,n.item.y];svgedit.path.replacePathSeg(2,i.next.index,p)}t.removeItem(c)}};svgedit.path.Path.prototype.subpathIsClosed=function(c){var i=false;svgedit.path.path.eachSeg(function(t){if(t<=c)return true;if(this.type===2)return false;if(this.type===1){i=true;return false}});return i};svgedit.path.Path.prototype.removePtFromSelection=function(c){var i=this.selected_pts.indexOf(c);if(i!=-1){this.segs[c].select(false);this.selected_pts.splice(i,
1)}};svgedit.path.Path.prototype.clearSelection=function(){this.eachSeg(function(){this.select(false)});this.selected_pts=[]};svgedit.path.Path.prototype.storeD=function(){this.last_d=this.elem.getAttribute("d")};svgedit.path.Path.prototype.show=function(c){this.eachSeg(function(){this.show(c)});c&&this.selectPt(this.first_seg.index);return this};svgedit.path.Path.prototype.movePts=function(c,i){for(var t=this.selected_pts.length;t--;)this.segs[this.selected_pts[t]].move(c,i)};svgedit.path.Path.prototype.moveCtrl=
function(c,i){var t=this.segs[this.selected_pts[0]];t.moveCtrl(this.dragctrl,c,i);l&&t.setLinked(this.dragctrl)};svgedit.path.Path.prototype.setSegType=function(c){this.storeD();for(var i=this.selected_pts.length,t;i--;){var n=this.segs[this.selected_pts[i]],p=n.prev;if(p){if(!c){t="Toggle Path Segment Type";c=n.type==6?4:6}c-=0;var D=n.item.x,P=n.item.y,L=p.item.x;p=p.item.y;var A;switch(c){case 6:if(n.olditem){L=n.olditem;A=[D,P,L.x1,L.y1,L.x2,L.y2]}else{A=D-L;var ga=P-p;A=[D,P,L+A/3,p+ga/3,D-A/
3,P-ga/3]}break;case 4:A=[D,P];n.olditem=n.item}n.setType(c,A)}}svgedit.path.path.endChanges(t)};svgedit.path.Path.prototype.selectPt=function(c,i){this.clearSelection();c==null&&this.eachSeg(function(t){if(this.prev)c=t});this.addPtsToSelection(c);if(i){this.dragctrl=i;l&&this.segs[c].setLinked(i)}};svgedit.path.Path.prototype.update=function(){var c=this.elem;if(svgedit.utilities.getRotationAngle(c)){this.matrix=svgedit.math.getMatrix(c);this.imatrix=this.matrix.inverse()}else this.imatrix=this.matrix=
null;this.eachSeg(function(i){this.item=c.pathSegList.getItem(i);this.update()});return this};svgedit.path.getPath_=function(c){var i=v[c.id];i||(i=v[c.id]=new svgedit.path.Path(c));return i};svgedit.path.removePath_=function(c){c in v&&delete v[c]};var h=function(c,i){dx=c-oldcx;dy=i-oldcy;r=Math.sqrt(dx*dx+dy*dy);theta=Math.atan2(dy,dx)+angle;dx=r*Math.cos(theta)+oldcx;dy=r*Math.sin(theta)+oldcy;dx-=newcx;dy-=newcy;r=Math.sqrt(dx*dx+dy*dy);theta=Math.atan2(dy,dx)-angle;return{x:(r*Math.cos(theta)+
newcx)/1,y:(r*Math.sin(theta)+newcy)/1}};svgedit.path.recalcRotatedPath=function(){var c=svgedit.path.path.elem,i=svgedit.utilities.getRotationAngle(c,true);if(i){var t=svgedit.utilities.getBBox(c),n=svgedit.path.path.oldbbox,p=n.x+n.width/2,D=n.y+n.height/2;n=t.x+t.width/2;t=t.y+t.height/2;n=n-p;var P=t-D;t=Math.sqrt(n*n+P*P);P=Math.atan2(P,n)+i;n=t*Math.cos(P)+p;t=t*Math.sin(P)+D;p=c.pathSegList;for(D=p.numberOfItems;D;){D-=1;P=p.getItem(D);var L=P.pathSegType;if(L!=1){var A=h(P.x,P.y);A=[A.x,A.y];
if(P.x1!=null&&P.x2!=null){c_vals1=h(P.x1,P.y1);c_vals2=h(P.x2,P.y2);A.splice(A.length,0,c_vals1.x,c_vals1.y,c_vals2.x,c_vals2.y)}svgedit.path.replacePathSeg(L,D,A)}}svgedit.utilities.getBBox(c);p=svgroot.createSVGTransform();c=svgedit.transformlist.getTransformList(c);p.setRotate(i*180/Math.PI,n,t);c.replaceItem(p,0)}};svgedit.path.clearData=function(){v={}}})();if(!window.console){window.console={};window.console.log=function(){};window.console.dir=function(){}}if(window.opera){window.console.log=function(a){opera.postError(a)};window.console.dir=function(){}}
$.SvgCanvas=function(a,G){function e(b,g){for(var d=svgedit.utilities.getBBox(b),u=0;u<2;u++){var o=u===0?"fill":"stroke",F=b.getAttribute(o);if(F&&F.indexOf("url(")===0){F=svgedit.utilities.getRefElem(F);if(F.tagName==="linearGradient"){var s=F.getAttribute("x1")||0,w=F.getAttribute("y1")||0,B=F.getAttribute("x2")||1,H=F.getAttribute("y2")||0;s=d.width*s+d.x;w=d.height*w+d.y;B=d.width*B+d.x;H=d.height*H+d.y;s=svgedit.math.transformPoint(s,w,g);H=svgedit.math.transformPoint(B,H,g);B={};B.x1=(s.x-
d.x)/d.width;B.y1=(s.y-d.y)/d.height;B.x2=(H.x-d.x)/d.width;B.y2=(H.y-d.y)/d.height;F=F.cloneNode(true);$(F).attr(B);F.id=La();svgedit.utilities.findDefs().appendChild(F);b.setAttribute(o,"url(#"+F.id+")")}}}}var m=svgedit.NS,l={show_outside_canvas:true,selectNew:true,dimensions:[640,480]};G&&$.extend(l,G);var v=l.dimensions,f=this,h=a.ownerDocument,c=h.importNode(svgedit.utilities.text2xml('<svg id="svgroot" xmlns="'+m.SVG+'" xlinkns="'+m.XLINK+'" width="'+v[0]+'" height="'+v[1]+'" x="'+v[0]+'" y="'+
v[1]+'" overflow="visible"><defs><filter id="canvashadow" filterUnits="objectBoundingBox"><feGaussianBlur in="SourceAlpha" stdDeviation="4" result="blur"/><feOffset in="blur" dx="5" dy="5" result="offsetBlur"/><feMerge><feMergeNode in="offsetBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs></svg>').documentElement,true);a.appendChild(c);var i=h.createElementNS(m.SVG,"svg");(f.clearSvgContentElement=function(){for(;i.firstChild;)i.removeChild(i.firstChild);$(i).attr({id:"svgcontent",
width:v[0],height:v[1],x:v[0],y:v[1],overflow:l.show_outside_canvas?"visible":"hidden",xmlns:m.SVG,"xmlns:se":m.SE,"xmlns:xlink":m.XLINK}).appendTo(c);var b=h.createComment(" Created with SVG-edit - http://svg-edit.googlecode.com/ ");i.appendChild(b)})();var t="svg_";f.setIdPrefix=function(b){t=b};f.current_drawing_=new svgedit.draw.Drawing(i,t);var n=f.getCurrentDrawing=function(){return f.current_drawing_},p=1,D=null,P={shape:{fill:(l.initFill.color=="none"?"":"#")+l.initFill.color,fill_paint:null,
fill_opacity:l.initFill.opacity,stroke:"#"+l.initStroke.color,stroke_paint:null,stroke_opacity:l.initStroke.opacity,stroke_width:l.initStroke.width,stroke_dasharray:"none",stroke_linejoin:"miter",stroke_linecap:"butt",opacity:l.initOpacity}};P.text=$.extend(true,{},P.shape);$.extend(P.text,{fill:"#000000",stroke_width:0,font_size:24,font_family:"serif"});var L=P.shape,A=Array(1),ga=this.addSvgElementFromJson=function(b){var g=svgedit.utilities.getElem(b.attr.id),d=n().getCurrentLayer();if(g&&b.element!=
g.tagName){d.removeChild(g);g=null}if(!g){g=h.createElementNS(m.SVG,b.element);if(d)(D||d).appendChild(g)}b.curStyles&&svgedit.utilities.assignAttributes(g,{fill:L.fill,stroke:L.stroke,"stroke-width":L.stroke_width,"stroke-dasharray":L.stroke_dasharray,"stroke-linejoin":L.stroke_linejoin,"stroke-linecap":L.stroke_linecap,"stroke-opacity":L.stroke_opacity,"fill-opacity":L.fill_opacity,opacity:L.opacity/2,style:"pointer-events:inherit"},100);svgedit.utilities.assignAttributes(g,b.attr,100);svgedit.utilities.cleanupElement(g);
return g};f.getTransformList=svgedit.transformlist.getTransformList;var la=svgedit.math.transformPoint,Ba=f.matrixMultiply=svgedit.math.matrixMultiply,Ga=f.hasMatrixTransform=svgedit.math.hasMatrixTransform,oa=f.transformListToTransform=svgedit.math.transformListToTransform;svgedit.units.init({getBaseUnit:function(){return l.baseUnit},getElement:svgedit.utilities.getElem,getHeight:function(){return i.getAttribute("height")/p},getWidth:function(){return i.getAttribute("width")/p},getRoundDigits:function(){return eb.round_digits}});
f.convertToNum=svgedit.units.convertToNum;svgedit.utilities.init({getDOMDocument:function(){return h},getDOMContainer:function(){return a},getSVGRoot:function(){return c},getSelectedElements:function(){return A},getSVGContent:function(){return i},getBaseUnit:function(){return l.baseUnit},getStepSize:function(){return l.stepSize}});var ia=f.findDefs=svgedit.utilities.findDefs,ka=f.getUrlFromAttr=svgedit.utilities.getUrlFromAttr,da=f.getHref=svgedit.utilities.getHref,za=f.setHref=svgedit.utilities.setHref,
ib=svgedit.utilities.getPathBBox;f.getBBox=svgedit.utilities.getBBox;f.getRotationAngle=svgedit.utilities.getRotationAngle;var jb=f.getElem=svgedit.utilities.getElem;f.getRefElem=svgedit.utilities.getRefElem;var kb=f.assignAttributes=svgedit.utilities.assignAttributes,db=this.cleanupElement=svgedit.utilities.cleanupElement;svgedit.coords.init({getDrawing:function(){return n()},getGridSnapping:function(){return l.gridSnapping}});var gb=this.remapElement=svgedit.coords.remapElement;svgedit.recalculate.init({getSVGRoot:function(){return c},
getStartTransform:function(){return Ta},setStartTransform:function(b){Ta=b}});var Qb=this.recalculateDimensions=svgedit.recalculate.recalculateDimensions,Fa=svgedit.getReverseNS(),qb=f.sanitizeSvg=svgedit.sanitize.sanitizeSvg,pa=svgedit.history.MoveElementCommand,Qa=svgedit.history.InsertElementCommand,Za=svgedit.history.RemoveElementCommand,rb=svgedit.history.ChangeElementCommand,Bb=svgedit.history.BatchCommand;f.undoMgr=new svgedit.history.UndoManager({handleHistoryEvent:function(b,g){var d=svgedit.history.HistoryEventTypes;
if(b==d.BEFORE_UNAPPLY||b==d.BEFORE_APPLY)f.clearSelection();else if(b==d.AFTER_APPLY||b==d.AFTER_UNAPPLY){var u=g.elements();f.pathActions.clear();ma("changed",u);u=g.type();d=b==d.AFTER_APPLY;if(u==pa.type())(d?g.newParent:g.oldParent)==i&&f.identifyLayers();else if(u==Qa.type()||u==Za.type()){g.parent==i&&f.identifyLayers();if(u==Qa.type())d&&sb(g.elem);else d||sb(g.elem);g.elem.tagName==="use"&&Rb(g.elem)}else if(u==rb.type()){g.elem.tagName=="title"&&g.elem.parentNode.parentNode==i&&f.identifyLayers();
d=d?g.newValues:g.oldValues;d.stdDeviation&&f.setBlurOffsets(g.elem.parentNode,d.stdDeviation)}}}});var qa=function(b){f.undoMgr.addCommandToHistory(b)};svgedit.select.init(l,{createSVGElement:function(b){return f.addSvgElementFromJson(b)},svgRoot:function(){return c},svgContent:function(){return i},currentZoom:function(){return p},getStrokedBBox:function(b){return f.getStrokedBBox([b])}});var va=this.selectorManager=svgedit.select.getSelectorManager();svgedit.path.init({getCurrentZoom:function(){return p},
getSVGRoot:function(){return c}});var lb={exportNoBlur:"Blurred elements will appear as un-blurred",exportNoforeignObject:"foreignObject elements will not appear",exportNoDashArray:"Strokes will appear filled",exportNoText:"Text may not appear as expected"},Lb=["clip-path","fill","filter","marker-end","marker-mid","marker-start","mask","stroke"],Cb=$.data,Db=document.createElementNS(m.SVG,"animate");$(Db).attr({attributeName:"opacity",begin:"indefinite",dur:1,fill:"freeze"}).appendTo(c);var sb=function(b){var g=
$(b).attr(Lb),d;for(d in g){var u=g[d];if(u&&u.indexOf("url(")===0){u=svgedit.utilities.getUrlFromAttr(u).substr(1);if(!jb(u)){svgedit.utilities.findDefs().appendChild(Eb[u]);delete Eb[u]}}}b=b.getElementsByTagName("*");if(b.length){g=0;for(d=b.length;g<d;g++)sb(b[g])}},Fb={},tb=l.imgPath+"logo.png",Mb=[],eb={round_digits:5},Ha=false,Ta=null,ra="select",$a="none",mb={},Ua=P.text,Oa=L,ub=null,Ca=null,Ia=[],vb={},Gb=null,Eb={};f.clipBoard=[];var wb=this.runExtensions=function(b,g,d){var u=d?[]:false;
$.each(vb,function(o,F){if(b in F)if(d)u.push(F[b](g));else u=F[b](g)});return u};this.addExtension=function(b,g){if(b in vb)console.log('Cannot add extension "'+b+'", an extension by that name already exists"');else{var d=$.isFunction(g)?g($.extend(f.getPrivateMethods(),{svgroot:c,svgcontent:i,nonce:n().getNonce(),selectorManager:va})):g;vb[b]=d;ma("extension_added",d)}};var Hb=this.round=function(b){return parseInt(b*p,10)/p},Sb=this.getIntersectionList=function(b){if(Ca==null)return null;var g=
D||n().getCurrentLayer();Ia.length||(Ia=hc(g));var d=null;try{d=g.getIntersectionList(b,null)}catch(u){}if(d==null||typeof d.item!="function"){d=[];if(b)b=b;else{b=Ca.getBBox();g={};for(var o in b)g[o]=b[o]/p;b=g}for(o=Ia.length;o--;)b.width&&b.width&&svgedit.math.rectsIntersect(b,Ia[o].bbox)&&d.push(Ia[o].elem)}return d};getStrokedBBox=this.getStrokedBBox=function(b){b||(b=Nb());if(!b.length)return false;var g=function(H){try{var z=svgedit.utilities.getBBox(H),C=svgedit.utilities.getRotationAngle(H);
if(C&&C%90||svgedit.math.hasMatrixTransform(svgedit.transformlist.getTransformList(H))){C=false;if(["ellipse","path","line","polyline","polygon"].indexOf(H.tagName)>=0)z=C=f.convertToPath(H,true);else if(H.tagName=="rect"){var M=H.getAttribute("rx"),T=H.getAttribute("ry");if(M||T)z=C=f.convertToPath(H,true)}if(!C){var S=H.cloneNode(true),Z=document.createElementNS(m.SVG,"g"),aa=H.parentNode;aa.appendChild(Z);Z.appendChild(S);z=svgedit.utilities.bboxToObj(Z.getBBox());aa.removeChild(Z)}}return z}catch(N){console.log(H,
N);return null}},d;$.each(b,function(){if(!d)if(this.parentNode)d=g(this)});if(d==null)return null;var u=d.x+d.width,o=d.y+d.height,F=d.x,s=d.y,w=function(H){var z=H.getAttribute("stroke-width"),C=0;if(H.getAttribute("stroke")!="none"&&!isNaN(z))C+=z/2;return C},B=[];$.each(b,function(H,z){var C=g(z);if(C){var M=w(z);F=Math.min(F,C.x-M);s=Math.min(s,C.y-M);B.push(C)}});d.x=F;d.y=s;$.each(b,function(H,z){var C=B[H];if(C&&z.nodeType==1){var M=w(z);u=Math.max(u,C.x+C.width+M);o=Math.max(o,C.y+C.height+
M)}});d.width=u-F;d.height=o-s;return d};var Nb=this.getVisibleElements=function(b){b||(b=$(i).children());var g=[];$(b).children().each(function(d,u){try{u.getBBox()&&g.push(u)}catch(o){}});return g.reverse()},hc=this.getVisibleElementsAndBBoxes=function(b){b||(b=$(i).children());var g=[];$(b).children().each(function(d,u){try{u.getBBox()&&g.push({elem:u,bbox:getStrokedBBox([u])})}catch(o){}});return g.reverse()},Yb=this.groupSvgElem=function(b){var g=document.createElementNS(m.SVG,"g");b.parentNode.replaceChild(g,
b);$(g).append(b).data("gsvg",b)[0].id=La()},xb=function(b){var g=document.createElementNS(b.namespaceURI,b.nodeName);$.each(b.attributes,function(u,o){o.localName!="-moz-math-font-style"&&g.setAttributeNS(o.namespaceURI,o.nodeName,o.nodeValue)});g.removeAttribute("id");g.id=La();if(svgedit.browser.isWebkit()&&b.nodeName=="path"){var d=sa.convertPath(b);g.setAttribute("d",d)}$.each(b.childNodes,function(u,o){switch(o.nodeType){case 1:g.appendChild(xb(o));break;case 3:g.textContent=o.nodeValue}});
if($(b).data("gsvg"))$(g).data("gsvg",g.firstChild);else if($(b).data("symbol")){b=$(b).data("symbol");$(g).data("ref",b).data("symbol",b)}else g.tagName=="image"&&nb(g);return g},Xa,La,ma;(function(b){var g={};Xa=b.getId=function(){return n().getId()};La=b.getNextId=function(){return n().getNextId()};ma=b.call=function(d,u){if(g[d])return g[d](this,u)};b.bind=function(d,u){var o=g[d];g[d]=u;return o}})(f);this.prepareSvg=function(b){this.sanitizeSvg(b.documentElement);b=b.getElementsByTagNameNS(m.SVG,
"path");for(var g=0,d=b.length;g<d;++g){var u=b[g];u.setAttribute("d",sa.convertPath(u));sa.fixEnd(u)}};var Tb=function(b){if(!svgedit.browser.isGecko())return b;var g=b.cloneNode(true);b.parentNode.insertBefore(g,b);b.parentNode.removeChild(b);va.releaseSelector(b);A[0]=g;va.requestSelector(g).showGrips(true);return g};this.setRotationAngle=function(b,g){b=parseFloat(b);var d=A[0],u=d.getAttribute("transform"),o=svgedit.utilities.getBBox(d),F=o.x+o.width/2,s=o.y+o.height/2;o=svgedit.transformlist.getTransformList(d);
o.numberOfItems>0&&o.getItem(0).type==4&&o.removeItem(0);if(b!=0){F=svgedit.math.transformPoint(F,s,svgedit.math.transformListToTransform(o).matrix);s=c.createSVGTransform();s.setRotate(b,F.x,F.y);o.numberOfItems?o.insertItemBefore(s,0):o.appendItem(s)}else o.numberOfItems==0&&d.removeAttribute("transform");if(!g){o=d.getAttribute("transform");d.setAttribute("transform",u);Ra("transform",o,A);ma("changed",A)}svgedit.utilities.getElem("pathpointgrip_container");d=va.requestSelector(A[0]);d.resize();
d.updateGripCursors(b)};var Ub=this.recalculateAllSelectedDimensions=function(){for(var b=new svgedit.history.BatchCommand($a=="none"?"position":"size"),g=A.length;g--;){var d=svgedit.recalculate.recalculateDimensions(A[g]);d&&b.addSubCommand(d)}if(!b.isEmpty()){qa(b);ma("changed",A)}},ic=[0,"z","M","m","L","l","C","c","Q","q","A","a","H","h","V","v","S","s","T","t"],Zb=function(b){console.log([b.a,b.b,b.c,b.d,b.e,b.f])},fb=null,Da=this.clearSelection=function(b){if(A[0]!=null)for(var g=A.length,
d=0;d<g;++d){var u=A[d];if(u==null)break;va.releaseSelector(u);A[d]=null}b||ma("selected",A)},Ya=this.addToSelection=function(b,g){if(b.length!=0){for(var d=0;d<A.length;){if(A[d]==null)break;++d}for(var u=b.length;u--;){var o=b[u];if(o&&svgedit.utilities.getBBox(o)){if(o.tagName==="a"&&o.childNodes.length===1)o=o.firstChild;if(A.indexOf(o)==-1){A[d]=o;d++;o=va.requestSelector(o);A.length>1&&o.showGrips(false)}}}ma("selected",A);g||A.length==1?va.requestSelector(A[0]).showGrips(true):va.requestSelector(A[0]).showGrips(false);
for(A.sort(function(F,s){if(F&&s&&F.compareDocumentPosition)return 3-(s.compareDocumentPosition(F)&6);if(F==null)return 1});A[0]==null;)A.shift(0)}},ab=this.selectOnly=function(b,g){Da(true);Ya(b,g)};this.removeFromSelection=function(b){if(A[0]!=null)if(b.length!=0){var g=Array(A.length);j=0;len=A.length;for(var d=0;d<len;++d){var u=A[d];if(u)if(b.indexOf(u)==-1){g[j]=u;j++}else va.releaseSelector(u)}A=g}};this.selectAllInCurrentLayer=function(){var b=n().getCurrentLayer();if(b){ra="select";ab($(D||
b).children())}};var Ib=this.getMouseTarget=function(b){if(b==null)return null;b=b.target;if(b.correspondingUseElement)b=b.correspondingUseElement;if([m.MATH,m.HTML].indexOf(b.namespaceURI)>=0&&b.id!="svgcanvas")for(;b.nodeName!="foreignObject";){b=b.parentNode;if(!b)return c}var g=n().getCurrentLayer();if([c,a,i,g].indexOf(b)>=0)return c;if($(b).closest("#selectorParentGroup").length)return va.selectorParentGroup;for(;b.parentNode!==(D||g);)b=b.parentNode;return b};(function(){var b=null,g=null,
d=null,u=null,o=null,F={},s={minx:null,miny:null,maxx:null,maxy:null},w=0,B={x:0,y:0},H={x:0,y:0},z={x:0,y:0},C={x:0,y:0},M,T,S={x:0,y:0},Z={x:0,y:0},aa=function(N){var Y={x:0,y:0},Q=B,R=H,K=z,O=C,ba=1/6,fa=N*N,W=fa*N,ha=[[-1,3,-3,1],[3,-6,3,0],[-3,0,3,0],[1,4,1,0]];Y.x=ba*((Q.x*ha[0][0]+R.x*ha[0][1]+K.x*ha[0][2]+O.x*ha[0][3])*W+(Q.x*ha[1][0]+R.x*ha[1][1]+K.x*ha[1][2]+O.x*ha[1][3])*fa+(Q.x*ha[2][0]+R.x*ha[2][1]+K.x*ha[2][2]+O.x*ha[2][3])*N+(Q.x*ha[3][0]+R.x*ha[3][1]+K.x*ha[3][2]+O.x*ha[3][3]));Y.y=
ba*((Q.y*ha[0][0]+R.y*ha[0][1]+K.y*ha[0][2]+O.y*ha[0][3])*W+(Q.y*ha[1][0]+R.y*ha[1][1]+K.y*ha[1][2]+O.y*ha[1][3])*fa+(Q.y*ha[2][0]+R.y*ha[2][1]+K.y*ha[2][2]+O.y*ha[2][3])*N+(Q.y*ha[3][0]+R.y*ha[3][1]+K.y*ha[3][2]+O.y*ha[3][3]));return{x:Y.x,y:Y.y}};$(a).mousedown(function(N){if(!(f.spaceKey||N.button===1)){var Y=N.button===2;N.altKey&&svgCanvas.cloneSelectedElements(0,0);fb=$("#svgcontent g")[0].getScreenCTM().inverse();var Q=svgedit.math.transformPoint(N.pageX,N.pageY,fb),R=Q.x*p,K=Q.y*p;N.preventDefault();
if(Y){ra="select";Gb=Q}Q=R/p;K=K/p;var O=Ib(N);if(O.tagName==="a"&&O.childNodes.length===1)O=O.firstChild;R=u=g=Q;var ba=o=d=K;if(l.gridSnapping){Q=svgedit.utilities.snapToGrid(Q);K=svgedit.utilities.snapToGrid(K);g=svgedit.utilities.snapToGrid(g);d=svgedit.utilities.snapToGrid(d)}if(O==va.selectorParentGroup&&A[0]!=null){O=N.target;var fa=Cb(O,"type");if(fa=="rotate")ra="rotate";else if(fa=="resize"){ra="resize";$a=Cb(O,"dir")}O=A[0]}Ta=O.getAttribute("transform");fa=svgedit.transformlist.getTransformList(O);
switch(ra){case "select":Ha=true;$a="none";if(Y)Ha=false;if(O!=c){if(A.indexOf(O)==-1){N.shiftKey||Da(true);Ya([O]);ub=O;sa.clear()}if(!Y)for(Y=0;Y<A.length;++Y)if(A[Y]!=null){var W=svgedit.transformlist.getTransformList(A[Y]);W.numberOfItems?W.insertItemBefore(c.createSVGTransform(),0):W.appendItem(c.createSVGTransform())}}else if(!Y){Da();ra="multiselect";if(Ca==null)Ca=va.getRubberBandBox();u*=p;o*=p;svgedit.utilities.assignAttributes(Ca,{x:u,y:o,width:0,height:0,display:"inline"},100)}break;case "zoom":Ha=
true;if(Ca==null)Ca=va.getRubberBandBox();svgedit.utilities.assignAttributes(Ca,{x:R*p,y:R*p,width:0,height:0,display:"inline"},100);break;case "resize":Ha=true;g=Q;d=K;F=svgedit.utilities.getBBox($("#selectedBox0")[0]);var ha={};$.each(F,function(ya,wa){ha[ya]=wa/p});F=ha;Y=svgedit.utilities.getRotationAngle(O)?1:0;if(svgedit.math.hasMatrixTransform(fa)){fa.insertItemBefore(c.createSVGTransform(),Y);fa.insertItemBefore(c.createSVGTransform(),Y);fa.insertItemBefore(c.createSVGTransform(),Y)}else{fa.appendItem(c.createSVGTransform());
fa.appendItem(c.createSVGTransform());fa.appendItem(c.createSVGTransform());if(svgedit.browser.supportsNonScalingStroke()){if(Q=svgedit.browser.isWebkit())W=function(ya){var wa=ya.getAttributeNS(null,"stroke");ya.removeAttributeNS(null,"stroke");setTimeout(function(){ya.setAttributeNS(null,"stroke",wa)},0)};O.style.vectorEffect="non-scaling-stroke";Q&&W(O);K=O.getElementsByTagName("*");R=K.length;for(Y=0;Y<R;Y++){K[Y].style.vectorEffect="non-scaling-stroke";Q&&W(K[Y])}}}break;case "fhellipse":case "fhrect":case "fhpath":z.x=
R;z.y=ba;Ha=true;b=R+","+ba+" ";W=L.stroke_width==0?1:L.stroke_width;ga({element:"polyline",curStyles:true,attr:{points:b,id:La(),fill:"none",opacity:L.opacity/2,"stroke-linecap":"round",style:"pointer-events:none"}});s.minx=R;s.maxx=R;s.miny=ba;s.maxy=ba;break;case "image":Ha=true;W=ga({element:"image",attr:{x:Q,y:K,width:0,height:0,id:La(),opacity:L.opacity/2,style:"pointer-events:inherit"}});za(W,tb);nb(W);break;case "square":case "rect":Ha=true;g=Q;d=K;ga({element:"rect",curStyles:true,attr:{x:Q,
y:K,width:0,height:0,id:La(),opacity:L.opacity/2}});break;case "line":Ha=true;W=L.stroke_width==0?1:L.stroke_width;ga({element:"line",curStyles:true,attr:{x1:Q,y1:K,x2:Q,y2:K,id:La(),stroke:L.stroke,"stroke-width":W,"stroke-dasharray":L.stroke_dasharray,"stroke-linejoin":L.stroke_linejoin,"stroke-linecap":L.stroke_linecap,"stroke-opacity":L.stroke_opacity,fill:"none",opacity:L.opacity/2,style:"pointer-events:none"}});break;case "circle":Ha=true;ga({element:"circle",curStyles:true,attr:{cx:Q,cy:K,
r:0,id:La(),opacity:L.opacity/2}});break;case "ellipse":Ha=true;ga({element:"ellipse",curStyles:true,attr:{cx:Q,cy:K,rx:0,ry:0,id:La(),opacity:L.opacity/2}});break;case "text":Ha=true;ga({element:"text",curStyles:true,attr:{x:Q,y:K,id:La(),fill:Ua.fill,"stroke-width":Ua.stroke_width,"font-size":Ua.font_size,"font-family":Ua.font_family,"text-anchor":"middle","xml:space":"preserve",opacity:L.opacity}});break;case "path":case "pathedit":g*=p;d*=p;sa.mouseDown(N,O,g,d);Ha=true;break;case "textedit":g*=
p;d*=p;Pa.mouseDown(N,O,g,d);Ha=true;break;case "rotate":Ha=true;f.undoMgr.beginUndoableChange("transform",A)}N=wb("mouseDown",{event:N,start_x:g,start_y:d,selectedElements:A},true);$.each(N,function(ya,wa){if(wa&&wa.started)Ha=true})}}).mousemove(function(N){if(Ha)if(!(N.button===1||f.spaceKey)){var Y=A[0],Q=svgedit.math.transformPoint(N.pageX,N.pageY,fb),R=Q.x*p;Q=Q.y*p;var K=svgedit.utilities.getElem(Xa()),O=x=R/p,ba=y=Q/p;if(l.gridSnapping){x=svgedit.utilities.snapToGrid(x);y=svgedit.utilities.snapToGrid(y)}N.preventDefault();
switch(ra){case "select":if(A[0]!==null){O=x-g;var fa=y-d;if(l.gridSnapping){O=svgedit.utilities.snapToGrid(O);fa=svgedit.utilities.snapToGrid(fa)}if(N.shiftKey){var W=svgedit.math.snapToAngle(g,d,x,y);x=W.x;y=W.y}if(O!=0||fa!=0){ba=A.length;for(W=0;W<ba;++W){Y=A[W];if(Y==null)break;var ha=c.createSVGTransform();K=svgedit.transformlist.getTransformList(Y);ha.setTranslate(O,fa);K.numberOfItems?K.replaceItem(ha,0):K.appendItem(ha);va.requestSelector(Y).resize()}ma("transition",A)}}break;case "multiselect":O*=
p;ba*=p;svgedit.utilities.assignAttributes(Ca,{x:Math.min(u,O),y:Math.min(o,ba),width:Math.abs(O-u),height:Math.abs(ba-o)},100);K=[];O=[];ha=Sb();ba=A.length;for(W=0;W<ba;++W){fa=ha.indexOf(A[W]);if(fa==-1)K.push(A[W]);else ha[fa]=null}ba=ha.length;for(W=0;W<ba;++W)ha[W]&&O.push(ha[W]);K.length>0&&f.removeFromSelection(K);O.length>0&&Ya(O);break;case "resize":K=svgedit.transformlist.getTransformList(Y);fa=(W=svgedit.math.hasMatrixTransform(K))?F:svgedit.utilities.getBBox(Y);ba=fa.x;ha=fa.y;var ya=
fa.width,wa=fa.height;O=x-g;fa=y-d;if(l.gridSnapping){O=svgedit.utilities.snapToGrid(O);fa=svgedit.utilities.snapToGrid(fa);wa=svgedit.utilities.snapToGrid(wa);ya=svgedit.utilities.snapToGrid(ya)}var Sa=svgedit.utilities.getRotationAngle(Y);if(Sa){var bb=Math.sqrt(O*O+fa*fa);fa=Math.atan2(fa,O)-Sa*Math.PI/180;O=bb*Math.cos(fa);fa=bb*Math.sin(fa)}if($a.indexOf("n")==-1&&$a.indexOf("s")==-1)fa=0;if($a.indexOf("e")==-1&&$a.indexOf("w")==-1)O=0;var yb=bb=0,Jb=wa?(wa+fa)/wa:1,hb=ya?(ya+O)/ya:1;if($a.indexOf("n")>=
0){Jb=wa?(wa-fa)/wa:1;yb=wa}if($a.indexOf("w")>=0){hb=ya?(ya-O)/ya:1;bb=ya}O=c.createSVGTransform();fa=c.createSVGTransform();ya=c.createSVGTransform();if(l.gridSnapping){ba=svgedit.utilities.snapToGrid(ba);bb=svgedit.utilities.snapToGrid(bb);ha=svgedit.utilities.snapToGrid(ha);yb=svgedit.utilities.snapToGrid(yb)}O.setTranslate(-(ba+bb),-(ha+yb));if(N.shiftKey)if(hb==1)hb=Jb;else Jb=hb;fa.setScale(hb,Jb);ya.setTranslate(ba+bb,ha+yb);if(W){W=Sa?1:0;K.replaceItem(O,2+W);K.replaceItem(fa,1+W);K.replaceItem(ya,
0+W)}else{W=K.numberOfItems;K.replaceItem(ya,W-3);K.replaceItem(fa,W-2);K.replaceItem(O,W-1)}va.requestSelector(Y).resize();ma("transition",A);break;case "zoom":O*=p;ba*=p;svgedit.utilities.assignAttributes(Ca,{x:Math.min(u*p,O),y:Math.min(o*p,ba),width:Math.abs(O-u*p),height:Math.abs(ba-o*p)},100);break;case "text":svgedit.utilities.assignAttributes(K,{x:x,y:y},1E3);break;case "line":ba=null;window.opera||c.suspendRedraw(1E3);if(l.gridSnapping){x=svgedit.utilities.snapToGrid(x);y=svgedit.utilities.snapToGrid(y)}O=
x;W=y;if(N.shiftKey){W=svgedit.math.snapToAngle(g,d,O,W);O=W.x;W=W.y}K.setAttributeNS(null,"x2",O);K.setAttributeNS(null,"y2",W);window.opera||c.unsuspendRedraw(ba);break;case "foreignObject":case "square":case "rect":case "image":O=Math.abs(x-g);W=Math.abs(y-d);if(ra=="square"||N.shiftKey){O=W=Math.max(O,W);ba=g<x?g:g-O;ha=d<y?d:d-W}else{ba=Math.min(g,x);ha=Math.min(d,y)}if(l.gridSnapping){O=svgedit.utilities.snapToGrid(O);W=svgedit.utilities.snapToGrid(W);ba=svgedit.utilities.snapToGrid(ba);ha=
svgedit.utilities.snapToGrid(ha)}svgedit.utilities.assignAttributes(K,{width:O,height:W,x:ba,y:ha},1E3);break;case "circle":W=$(K).attr(["cx","cy"]);O=W.cx;W=W.cy;O=Math.sqrt((x-O)*(x-O)+(y-W)*(y-W));if(l.gridSnapping)O=svgedit.utilities.snapToGrid(O);K.setAttributeNS(null,"r",O);break;case "ellipse":W=$(K).attr(["cx","cy"]);O=W.cx;W=W.cy;ba=null;window.opera||c.suspendRedraw(1E3);if(l.gridSnapping){x=svgedit.utilities.snapToGrid(x);O=svgedit.utilities.snapToGrid(O);y=svgedit.utilities.snapToGrid(y);
W=svgedit.utilities.snapToGrid(W)}K.setAttributeNS(null,"rx",Math.abs(x-O));K.setAttributeNS(null,"ry",Math.abs(N.shiftKey?x-O:y-W));window.opera||c.unsuspendRedraw(ba);break;case "fhellipse":case "fhrect":s.minx=Math.min(O,s.minx);s.maxx=Math.max(O,s.maxx);s.miny=Math.min(ba,s.miny);s.maxy=Math.max(ba,s.maxy);case "fhpath":C.x=O;C.y=ba;if(B.x&&B.y)for(W=0;W<9;W++){M=W/10;T=(W+1)/10;Z=S=aa(T);S=aa(M);w+=Math.sqrt((Z.x-S.x)*(Z.x-S.x)+(Z.y-S.y)*(Z.y-S.y));if(w>0.8){b+=+S.x+","+S.y+" ";K.setAttributeNS(null,
"points",b);w-=0.8}}B={x:H.x,y:H.y};H={x:z.x,y:z.y};z={x:C.x,y:C.y};break;case "path":case "pathedit":x*=p;y*=p;if(l.gridSnapping){x=svgedit.utilities.snapToGrid(x);y=svgedit.utilities.snapToGrid(y);g=svgedit.utilities.snapToGrid(g);d=svgedit.utilities.snapToGrid(d)}if(N.shiftKey){if(W=svgedit.path.path){K=W.dragging?W.dragging[0]:g;W=W.dragging?W.dragging[1]:d}else{K=g;W=d}W=svgedit.math.snapToAngle(K,W,x,y);x=W.x;y=W.y}if(Ca&&Ca.getAttribute("display")!=="none"){O*=p;ba*=p;svgedit.utilities.assignAttributes(Ca,
{x:Math.min(u*p,O),y:Math.min(o*p,ba),width:Math.abs(O-u*p),height:Math.abs(ba-o*p)},100)}sa.mouseMove(x,y);break;case "textedit":x*=p;y*=p;Pa.mouseMove(R,Q);break;case "rotate":fa=svgedit.utilities.getBBox(Y);O=fa.x+fa.width/2;W=fa.y+fa.height/2;K=svgedit.math.getMatrix(Y);K=svgedit.math.transformPoint(O,W,K);O=K.x;W=K.y;Sa=(Math.atan2(W-y,O-x)*(180/Math.PI)-90)%360;if(l.gridSnapping)Sa=svgedit.utilities.snapToGrid(Sa);if(N.shiftKey)Sa=Math.round(Sa/45)*45;f.setRotationAngle(Sa<-180?360+Sa:Sa,true);
ma("transition",A)}wb("mouseMove",{event:N,mouse_x:R,mouse_y:Q,selected:Y})}}).click(function(N){N.preventDefault();return false}).dblclick(function(N){var Y=N.target.parentNode;if(Y!==D){var Q=Ib(N),R=Q.tagName;if(R==="text"&&ra!=="textedit"){N=svgedit.math.transformPoint(N.pageX,N.pageY,fb);Pa.select(Q,N.x,N.y)}if((R==="g"||R==="a")&&svgedit.utilities.getRotationAngle(Q)){Vb(Q);Q=A[0];Da(true)}D&&Ob();Y.tagName!=="g"&&Y.tagName!=="a"||Y===n().getCurrentLayer()||Q===va.selectorParentGroup||$b(Q)}}).mouseup(function(N){if(N.button!==
2){var Y=ub;ub=null;if(Ha){var Q=svgedit.math.transformPoint(N.pageX,N.pageY,fb),R=Q.x*p;Q=Q.y*p;var K=R/p,O=Q/p,ba=svgedit.utilities.getElem(Xa()),fa=false;Ha=false;switch(ra){case "resize":case "multiselect":if(Ca!=null){Ca.setAttribute("display","none");Ia=[]}ra="select";case "select":if(A[0]!=null){if(A[1]==null){R=A[0];switch(R.tagName){case "g":case "use":case "image":case "foreignObject":break;default:Oa.fill=R.getAttribute("fill");Oa.fill_opacity=R.getAttribute("fill-opacity");Oa.stroke=R.getAttribute("stroke");
Oa.stroke_opacity=R.getAttribute("stroke-opacity");Oa.stroke_width=R.getAttribute("stroke-width");Oa.stroke_dasharray=R.getAttribute("stroke-dasharray");Oa.stroke_linejoin=R.getAttribute("stroke-linejoin");Oa.stroke_linecap=R.getAttribute("stroke-linecap")}if(R.tagName=="text"){Ua.font_size=R.getAttribute("font-size");Ua.font_family=R.getAttribute("font-family")}va.requestSelector(R).showGrips(true)}Ub();if(K!=u||O!=o){N=A.length;for(R=0;R<N;++R){if(A[R]==null)break;A[R].firstChild||va.requestSelector(A[R]).resize()}}else{R=
N.target;if(A[0].nodeName==="path"&&A[1]==null)sa.select(A[0]);else N.shiftKey&&Y!=R&&f.removeFromSelection([R])}if(svgedit.browser.supportsNonScalingStroke())if(N=A[0]){N.removeAttribute("style");svgedit.utilities.walkTree(N,function(ya){ya.removeAttribute("style")})}}return;case "zoom":Ca!=null&&Ca.setAttribute("display","none");ma("zoomed",{x:Math.min(u,K),y:Math.min(o,O),width:Math.abs(K-u),height:Math.abs(O-o),factor:N.shiftKey?0.5:2});return;case "fhpath":w=0;B={x:0,y:0};H={x:0,y:0};z={x:0,
y:0};C={x:0,y:0};Y=ba.getAttribute("points");K=Y.indexOf(",");if(fa=K>=0?Y.indexOf(",",K+1)>=0:Y.indexOf(" ",Y.indexOf(" ")+1)>=0)ba=sa.smoothPolylineIntoPath(ba);break;case "line":Y=$(ba).attr(["x1","x2","y1","y2"]);fa=Y.x1!=Y.x2||Y.y1!=Y.y2;break;case "foreignObject":case "square":case "rect":case "image":Y=$(ba).attr(["width","height"]);fa=Y.width!=0||Y.height!=0||ra==="image";break;case "circle":fa=ba.getAttribute("r")!=0;break;case "ellipse":Y=$(ba).attr(["rx","ry"]);fa=Y.rx!=null||Y.ry!=null;
break;case "fhellipse":if(s.maxx-s.minx>0&&s.maxy-s.miny>0){ba=ga({element:"ellipse",curStyles:true,attr:{cx:(s.minx+s.maxx)/2,cy:(s.miny+s.maxy)/2,rx:(s.maxx-s.minx)/2,ry:(s.maxy-s.miny)/2,id:Xa()}});ma("changed",[ba]);fa=true}break;case "fhrect":if(s.maxx-s.minx>0&&s.maxy-s.miny>0){ba=ga({element:"rect",curStyles:true,attr:{x:s.minx,y:s.miny,width:s.maxx-s.minx,height:s.maxy-s.miny,id:Xa()}});ma("changed",[ba]);fa=true}break;case "text":fa=true;ab([ba]);Pa.start(ba);break;case "path":ba=null;Ha=
true;Y=sa.mouseUp(N,ba,R,Q);ba=Y.element;fa=Y.keep;break;case "pathedit":fa=true;ba=null;sa.mouseUp(N);break;case "textedit":fa=false;ba=null;Pa.mouseUp(N,R,Q);break;case "rotate":fa=true;ba=null;ra="select";Y=f.undoMgr.finishUndoableChange();Y.isEmpty()||qa(Y);Ub();ma("changed",A)}R=wb("mouseUp",{event:N,mouse_x:R,mouse_y:Q},true);$.each(R,function(ya,wa){if(wa){fa=wa.keep||fa;ba=wa.element;Ha=wa.started||Ha}});if(!fa&&ba!=null){n().releaseId(Xa());ba.parentNode.removeChild(ba);ba=null;for(R=N.target;R.parentNode.parentNode.tagName==
"g";)R=R.parentNode;if((ra!="path"||!drawn_path)&&R.parentNode.id!="selectorParentGroup"&&R.id!="svgcanvas"&&R.id!="svgroot"){f.setMode("select");ab([R],true)}}else if(ba!=null){f.addedNew=true;N=0.2;var W;if(Db.beginElement&&ba.getAttribute("opacity")!=L.opacity){W=$(Db).clone().attr({to:L.opacity,dur:N}).appendTo(ba);try{W[0].beginElement()}catch(ha){}}else N=0;setTimeout(function(){W&&W.remove();ba.setAttribute("opacity",L.opacity);ba.setAttribute("style","pointer-events:inherit");db(ba);if(ra===
"path")sa.toEditMode(ba);else l.selectNew&&ab([ba],true);qa(new svgedit.history.InsertElementCommand(ba));ma("changed",[ba])},N*1E3)}Ta=null}}});$(a).bind("mousewheel DOMMouseScroll",function(N){N.preventDefault();N=N.originalEvent;fb=$("#svgcontent g")[0].getScreenCTM().inverse();var Y=svgedit.math.transformPoint(N.pageX,N.pageY,fb);Y={x:Y.x,y:Y.y,width:0,height:0};if(N=N.wheelDelta?N.wheelDelta:N.detail?-N.detail:0){Y.factor=Math.max(0.75,Math.min(4/3,N));ma("zoomed",Y)}})})();var nb=function(b){$(b).click(function(g){g.preventDefault()})},
Pa=f.textActions=function(){function b(Q){var R=H.value==="";$(H).focus();if(!arguments.length)if(R)Q=0;else{if(H.selectionEnd!==H.selectionStart)return;Q=H.selectionEnd}var K;K=T[Q];R||H.setSelectionRange(Q,Q);z=svgedit.utilities.getElem("text_cursor");if(!z){z=document.createElementNS(m.SVG,"line");svgedit.utilities.assignAttributes(z,{id:"text_cursor",stroke:"#333","stroke-width":1});z=svgedit.utilities.getElem("selectorParentGroup").appendChild(z)}M||(M=setInterval(function(){var O=z.getAttribute("display")===
"none";z.setAttribute("display",O?"inline":"none")},600));R=F(K.x,S.y);K=F(K.x,S.y+S.height);svgedit.utilities.assignAttributes(z,{x1:R.x,y1:R.y,x2:K.x,y2:K.y,visibility:"visible",display:"inline"});C&&C.setAttribute("d","")}function g(Q,R,K){if(Q===R)b(R);else{K||H.setSelectionRange(Q,R);C=svgedit.utilities.getElem("text_selectblock");if(!C){C=document.createElementNS(m.SVG,"path");svgedit.utilities.assignAttributes(C,{id:"text_selectblock",fill:"green",opacity:0.5,style:"pointer-events:none"});
svgedit.utilities.getElem("selectorParentGroup").appendChild(C)}Q=T[Q];var O=T[R];z.setAttribute("visibility","hidden");R=F(Q.x,S.y);K=F(Q.x+(O.x-Q.x),S.y);var ba=F(Q.x,S.y+S.height);Q=F(Q.x+(O.x-Q.x),S.y+S.height);svgedit.utilities.assignAttributes(C,{d:"M"+R.x+","+R.y+" L"+K.x+","+K.y+" "+Q.x+","+Q.y+" "+ba.x+","+ba.y+"z",display:"inline"})}}function d(Q,R){var K=c.createSVGPoint();K.x=Q;K.y=R;if(T.length==1)return 0;K=B.getCharNumAtPosition(K);if(K<0){K=T.length-2;if(Q<=T[0].x)K=0}else if(K>=T.length-
2)K=T.length-2;var O=T[K];Q>O.x+O.width/2&&K++;return K}function u(Q,R,K){var O=H.selectionStart;Q=d(Q,R);g(Math.min(O,Q),Math.max(O,Q),!K)}function o(Q,R){var K={x:Q,y:R};K.x/=p;K.y/=p;if(Z){var O=svgedit.math.transformPoint(K.x,K.y,Z.inverse());K.x=O.x;K.y=O.y}return K}function F(Q,R){var K={x:Q,y:R};if(Z){var O=svgedit.math.transformPoint(K.x,K.y,Z);K.x=O.x;K.y=O.y}K.x*=p;K.y*=p;return K}function s(Q){g(0,B.textContent.length);$(this).unbind(Q)}function w(Q){if(Y&&B){var R=svgedit.math.transformPoint(Q.pageX,
Q.pageY,fb);R=o(R.x*p,R.y*p);R=d(R.x,R.y);var K=B.textContent,O=K.substr(0,R).replace(/[a-z0-9]+$/i,"").length;K=K.substr(R).match(/^[a-z0-9]+/i);g(O,(K?K[0].length:0)+R);$(Q.target).click(s);setTimeout(function(){$(Q.target).unbind("click",s)},300)}}var B,H,z,C,M,T=[],S,Z,aa,N,Y;return{select:function(Q,R,K){B=Q;Pa.toEditMode(R,K)},start:function(Q){B=Q;Pa.toEditMode()},mouseDown:function(Q,R,K,O){Q=o(K,O);H.focus();b(d(Q.x,Q.y));aa=K;N=O},mouseMove:function(Q,R){var K=o(Q,R);u(K.x,K.y)},mouseUp:function(Q,
R,K){var O=o(R,K);u(O.x,O.y,true);Q.target!==B&&R<aa+2&&R>aa-2&&K<N+2&&K>N-2&&Pa.toSelectMode(true)},setCursor:b,toEditMode:function(Q,R){Y=false;ra="textedit";va.requestSelector(B).showGrips(false);va.requestSelector(B);Pa.init();$(B).css("cursor","text");if(arguments.length){var K=o(Q,R);b(d(K.x,K.y))}else b();setTimeout(function(){Y=true},300)},toSelectMode:function(Q){ra="select";clearInterval(M);M=null;C&&$(C).attr("display","none");z&&$(z).attr("visibility","hidden");$(B).css("cursor","move");
if(Q){Da();$(B).css("cursor","move");ma("selected",[B]);Ya([B],true)}B&&!B.textContent.length&&f.deleteSelectedElements();$(H).blur();B=false},setInputElem:function(Q){H=Q},clear:function(){ra=="textedit"&&Pa.toSelectMode()},init:function(){if(B){if(!B.parentNode){B=A[0];va.requestSelector(B).showGrips(false)}var Q=B.textContent.length,R=B.getAttribute("transform");S=svgedit.utilities.getBBox(B);Z=R?svgedit.math.getMatrix(B):null;T=Array(Q);H.focus();$(B).unbind("dblclick",w).dblclick(w);if(!Q)var K=
{x:S.x+S.width/2,width:0};for(R=0;R<Q;R++){var O=B.getStartPositionOfChar(R);K=B.getEndPositionOfChar(R);if(!svgedit.browser.supportsGoodTextCharPos()){var ba=f.contentW*p;O.x-=ba;K.x-=ba;O.x/=p;K.x/=p}T[R]={x:O.x,y:S.y,width:K.x-O.x,height:S.height}}T.push({x:K.x,width:0});g(H.selectionStart,H.selectionEnd,true)}}}}(),sa=f.pathActions=function(){var b=false,g,d,u;svgedit.path.Path.prototype.endChanges=function(s){if(svgedit.browser.isWebkit()){var w=this.elem;w.setAttribute("d",sa.convertPath(w))}s=
new svgedit.history.ChangeElementCommand(this.elem,{d:this.last_d},s);qa(s);ma("changed",[this.elem])};svgedit.path.Path.prototype.addPtsToSelection=function(s){$.isArray(s)||(s=[s]);for(var w=0;w<s.length;w++){var B=s[w],H=this.segs[B];H.ptgrip&&this.selected_pts.indexOf(B)==-1&&B>=0&&this.selected_pts.push(B)}this.selected_pts.sort();w=this.selected_pts.length;for(s=Array(w);w--;){H=this.segs[this.selected_pts[w]];H.select(true);s[w]=H.ptgrip}sa.canDeleteNodes=true;sa.closed_subpath=this.subpathIsClosed(this.selected_pts[0]);
ma("selected",s)};var o=g=null,F=false;return{mouseDown:function(s,w,B,H){if(ra==="path"){mouse_x=B;mouse_y=H;H=mouse_x/p;w=mouse_y/p;B=svgedit.utilities.getElem("path_stretch_line");d=[H,w];if(l.gridSnapping){H=svgedit.utilities.snapToGrid(H);w=svgedit.utilities.snapToGrid(w);mouse_x=svgedit.utilities.snapToGrid(mouse_x);mouse_y=svgedit.utilities.snapToGrid(mouse_y)}if(!B){B=document.createElementNS(m.SVG,"path");svgedit.utilities.assignAttributes(B,{id:"path_stretch_line",stroke:"#22C","stroke-width":"0.5",
fill:"none"});B=svgedit.utilities.getElem("selectorParentGroup").appendChild(B)}B.setAttribute("display","inline");var z=null;if(o){z=o.pathSegList;for(var C=z.numberOfItems,M=6/p,T=false;C;){C--;var S=z.getItem(C),Z=S.x;S=S.y;if(H>=Z-M&&H<=Z+M&&w>=S-M&&w<=S+M){T=true;break}}M=Xa();svgedit.path.removePath_(M);M=svgedit.utilities.getElem(M);Z=z.numberOfItems;if(T){if(C<=1&&Z>=2){H=z.getItem(0).x;w=z.getItem(0).y;s=B.pathSegList.getItem(1);s=s.pathSegType===4?o.createSVGPathSegLinetoAbs(H,w):o.createSVGPathSegCurvetoCubicAbs(H,
w,s.x1/p,s.y1/p,H,w);H=o.createSVGPathSegClosePath();z.appendItem(s);z.appendItem(H)}else if(Z<3)return z=false;$(B).remove();element=M;o=null;Ha=false;if(b){svgedit.path.path.matrix&&svgedit.coords.remapElement(M,{},svgedit.path.path.matrix.inverse());B=M.getAttribute("d");s=$(svgedit.path.path.elem).attr("d");$(svgedit.path.path.elem).attr("d",s+B);$(M).remove();svgedit.path.path.matrix&&svgedit.path.recalcRotatedPath();svgedit.path.path.init();sa.toEditMode(svgedit.path.path.elem);svgedit.path.path.selectPt();
return false}}else{if(!$.contains(a,Ib(s))){console.log("Clicked outside canvas");return false}z=o.pathSegList.numberOfItems;C=o.pathSegList.getItem(z-1);M=C.x;C=C.y;if(s.shiftKey){s=svgedit.math.snapToAngle(M,C,H,w);H=s.x;w=s.y}s=B.pathSegList.getItem(1);s=s.pathSegType===4?o.createSVGPathSegLinetoAbs(Hb(H),Hb(w)):o.createSVGPathSegCurvetoCubicAbs(Hb(H),Hb(w),s.x1/p,s.y1/p,s.x2/p,s.y2/p);o.pathSegList.appendItem(s);H*=p;w*=p;B.setAttribute("d",["M",H,w,H,w].join(" "));B=z;if(b)B+=svgedit.path.path.segs.length;
svgedit.path.addPointGrip(B,H,w)}}else{d_attr="M"+H+","+w+" ";o=ga({element:"path",curStyles:true,attr:{d:d_attr,id:La(),opacity:L.opacity/2}});B.setAttribute("d",["M",mouse_x,mouse_y,mouse_x,mouse_y].join(" "));B=b?svgedit.path.path.segs.length:0;svgedit.path.addPointGrip(B,mouse_x,mouse_y)}}else if(svgedit.path.path){svgedit.path.path.storeD();M=s.target.id;if(M.substr(0,14)=="pathpointgrip_"){w=svgedit.path.path.cur_pt=parseInt(M.substr(14));svgedit.path.path.dragging=[B,H];z=svgedit.path.path.segs[w];
if(s.shiftKey)z.selected?svgedit.path.path.removePtFromSelection(w):svgedit.path.path.addPtsToSelection(w);else{if(svgedit.path.path.selected_pts.length<=1||!z.selected)svgedit.path.path.clearSelection();svgedit.path.path.addPtsToSelection(w)}}else if(M.indexOf("ctrlpointgrip_")==0){svgedit.path.path.dragging=[B,H];s=M.split("_")[1].split("c");w=s[0]-0;svgedit.path.path.selectPt(w,s[1]-0)}if(!svgedit.path.path.dragging){if(Ca==null)Ca=va.getRubberBandBox();svgedit.utilities.assignAttributes(Ca,{x:B*
p,y:H*p,width:0,height:0,display:"inline"},100)}}},mouseMove:function(s,w){F=true;if(ra==="path"){if(o){var B=o.pathSegList,H=B.numberOfItems-1;if(d){var z=svgedit.path.addCtrlGrip("1c1"),C=svgedit.path.addCtrlGrip("0c2");z.setAttribute("cx",s);z.setAttribute("cy",w);z.setAttribute("display","inline");z=d[0];var M=d[1];B.getItem(H);var T=z+(z-s/p),S=M+(M-w/p);C.setAttribute("cx",T*p);C.setAttribute("cy",S*p);C.setAttribute("display","inline");C=svgedit.path.getCtrlLine(1);svgedit.utilities.assignAttributes(C,
{x1:s,y1:w,x2:T*p,y2:S*p,display:"inline"});if(H===0)u=[s,w];else{var Z=B.getItem(H-1);B=Z.x;C=Z.y;if(Z.pathSegType===6){B+=B-Z.x2;C+=C-Z.y2}else if(u){B=u[0]/p;C=u[1]/p}svgedit.path.replacePathSeg(6,H,[z,M,B,C,T,S],o)}}else if(z=svgedit.utilities.getElem("path_stretch_line")){H=B.getItem(H);if(H.pathSegType===6)svgedit.path.replacePathSeg(6,1,[s,w,(H.x+(H.x-H.x2))*p,(H.y+(H.y-H.y2))*p,s,w],z);else u?svgedit.path.replacePathSeg(6,1,[s,w,u[0],u[1],s,w],z):svgedit.path.replacePathSeg(4,1,[s,w],z)}}}else if(svgedit.path.path.dragging){z=
svgedit.path.getPointFromGrip({x:svgedit.path.path.dragging[0],y:svgedit.path.path.dragging[1]},svgedit.path.path);M=svgedit.path.getPointFromGrip({x:s,y:w},svgedit.path.path);H=M.x-z.x;z=M.y-z.y;svgedit.path.path.dragging=[s,w];svgedit.path.path.dragctrl?svgedit.path.path.moveCtrl(H,z):svgedit.path.path.movePts(H,z)}else{svgedit.path.path.selected_pts=[];svgedit.path.path.eachSeg(function(){if(this.next||this.prev){var aa=Ca.getBBox(),N=svgedit.path.getGripPt(this);aa=svgedit.math.rectsIntersect(aa,
{x:N.x,y:N.y,width:0,height:0});this.select(aa);aa&&svgedit.path.path.selected_pts.push(this.index)}})}},mouseUp:function(s,w){if(ra==="path"){d=null;if(!o){w=svgedit.utilities.getElem(Xa());Ha=false;u=null}return{keep:true,element:w}}if(svgedit.path.path.dragging){var B=svgedit.path.path.cur_pt;svgedit.path.path.dragging=false;svgedit.path.path.dragctrl=false;svgedit.path.path.update();F&&svgedit.path.path.endChanges("Move path point(s)");!s.shiftKey&&!F&&svgedit.path.path.selectPt(B)}else if(Ca&&
Ca.getAttribute("display")!="none"){Ca.setAttribute("display","none");Ca.getAttribute("width")<=2&&Ca.getAttribute("height")<=2&&sa.toSelectMode(s.target)}else sa.toSelectMode(s.target);F=false},toEditMode:function(s){svgedit.path.path=svgedit.path.getPath_(s);ra="pathedit";Da();svgedit.path.path.show(true).update();svgedit.path.path.oldbbox=svgedit.utilities.getBBox(svgedit.path.path.elem);b=false},toSelectMode:function(s){var w=s==svgedit.path.path.elem;ra="select";svgedit.path.path.show(false);
g=false;Da();svgedit.path.path.matrix&&svgedit.path.recalcRotatedPath();if(w){ma("selected",[s]);Ya([s],true)}},addSubPath:function(s){if(s){ra="path";b=true}else{sa.clear(true);sa.toEditMode(svgedit.path.path.elem)}},select:function(s){if(g===s){sa.toEditMode(s);ra="pathedit"}else g=s},reorient:function(){var s=A[0];if(s)if(svgedit.utilities.getRotationAngle(s)!=0){var w=new svgedit.history.BatchCommand("Reorient path"),B={d:s.getAttribute("d"),transform:s.getAttribute("transform")};w.addSubCommand(new svgedit.history.ChangeElementCommand(s,
B));Da();this.resetOrientation(s);qa(w);svgedit.path.getPath_(s).show(false).matrix=null;this.clear();Ya([s],true);ma("changed",A)}},clear:function(){g=null;if(o){var s=svgedit.utilities.getElem(Xa());$(svgedit.utilities.getElem("path_stretch_line")).remove();$(s).remove();$(svgedit.utilities.getElem("pathpointgrip_container")).find("*").attr("display","none");o=u=null;Ha=false}else ra=="pathedit"&&this.toSelectMode();svgedit.path.path&&svgedit.path.path.init().show(false)},resetOrientation:function(s){if(s==
null||s.nodeName!="path")return false;var w=svgedit.transformlist.getTransformList(s),B=svgedit.math.transformListToTransform(w).matrix;w.clear();s.removeAttribute("transform");w=s.pathSegList;for(var H=w.numberOfItems,z=0;z<H;++z){var C=w.getItem(z),M=C.pathSegType;if(M!=1){var T=[];$.each(["",1,2],function(S,Z){var aa=C["x"+Z],N=C["y"+Z];if(aa!==undefined&&N!==undefined){aa=svgedit.math.transformPoint(aa,N,B);T.splice(T.length,0,aa.x,aa.y)}});svgedit.path.replacePathSeg(M,z,T,s)}}e(s,B)},zoomChange:function(){ra==
"pathedit"&&svgedit.path.path.update()},getNodePoint:function(){var s=svgedit.path.path.segs[svgedit.path.path.selected_pts.length?svgedit.path.path.selected_pts[0]:1];return{x:s.item.x,y:s.item.y,type:s.type}},linkControlPoints:function(s){svgedit.path.setLinkControlPoints(s)},clonePathNode:function(){svgedit.path.path.storeD();for(var s=svgedit.path.path.selected_pts,w=s.length,B=[];w--;){var H=s[w];svgedit.path.path.addSeg(H);B.push(H+w);B.push(H+w+1)}svgedit.path.path.init().addPtsToSelection(B);
svgedit.path.path.endChanges("Clone path node(s)")},opencloseSubPath:function(){var s=svgedit.path.path.selected_pts;if(s.length===1){var w=svgedit.path.path.elem,B=w.pathSegList,H=s[0],z=null,C=null;svgedit.path.path.eachSeg(function(Z){if(this.type===2&&Z<=H)C=this.item;if(Z<=H)return true;if(this.type===2){z=Z;return false}else if(this.type===1)return z=false});if(z==null)z=svgedit.path.path.segs.length-1;if(z!==false){var M=w.createSVGPathSegLinetoAbs(C.x,C.y),T=w.createSVGPathSegClosePath();
if(z==svgedit.path.path.segs.length-1){B.appendItem(M);B.appendItem(T)}else{svgedit.path.insertItemBefore(w,T,z);svgedit.path.insertItemBefore(w,M,z)}svgedit.path.path.init().selectPt(z+1)}else if(svgedit.path.path.segs[H].mate){B.removeItem(H);B.removeItem(H);svgedit.path.path.init().selectPt(H-1)}else{for(s=0;s<B.numberOfItems;s++){var S=B.getItem(s);if(S.pathSegType===2)M=s;else if(s===H)B.removeItem(M);else if(S.pathSegType===1&&H<s){T=s-1;B.removeItem(s);break}}for(s=H-M-1;s--;)svgedit.path.insertItemBefore(w,
B.getItem(M),T);w=B.getItem(M);svgedit.path.replacePathSeg(2,M,[w.x,w.y]);s=H;svgedit.path.path.init().selectPt(0)}}},deletePathNode:function(){if(sa.canDeleteNodes){svgedit.path.path.storeD();for(var s=svgedit.path.path.selected_pts,w=s.length;w--;)svgedit.path.path.deleteSeg(s[w]);var B=function(){var H=svgedit.path.path.elem.pathSegList,z=H.numberOfItems,C=function(S,Z){for(;Z--;)H.removeItem(S)};if(z<=1)return true;for(;z--;){var M=H.getItem(z);if(M.pathSegType===1){M=H.getItem(z-1);var T=H.getItem(z-
2);if(M.pathSegType===2){C(z-1,2);B();break}else if(T.pathSegType===2){C(z-2,3);B();break}}else if(M.pathSegType===2)if(z>0){M=H.getItem(z-1).pathSegType;if(M===2){C(z-1,1);B();break}else if(M===1&&H.numberOfItems-1===z){C(z,1);B();break}}}return false};B();if(svgedit.path.path.elem.pathSegList.numberOfItems<=1){sa.toSelectMode(svgedit.path.path.elem);f.deleteSelectedElements()}else{svgedit.path.path.init();svgedit.path.path.clearSelection();if(window.opera){s=$(svgedit.path.path.elem);s.attr("d",
s.attr("d"))}svgedit.path.path.endChanges("Delete path node(s)")}}},smoothPolylineIntoPath:function(s){var w=s.points,B=w.numberOfItems;if(B>=4){var H=w.getItem(0),z=null;s=[];s.push(["M",H.x,",",H.y," C"].join(""));for(var C=1;C<=B-4;C+=3){var M=w.getItem(C),T=w.getItem(C+1),S=w.getItem(C+2);if(z)if((H=svgedit.path.smoothControlPoints(z,M,H))&&H.length==2){M=s[s.length-1].split(",");M[2]=H[0].x;M[3]=H[0].y;s[s.length-1]=M.join(",");M=H[1]}s.push([M.x,M.y,T.x,T.y,S.x,S.y].join(","));H=S;z=T}for(s.push("L");C<
B;++C){T=w.getItem(C);s.push([T.x,T.y].join(","))}s=s.join(" ");s=ga({element:"path",curStyles:true,attr:{id:Xa(),d:s,fill:"none"}})}return s},setSegType:function(s){svgedit.path.path.setSegType(s)},moveNode:function(s,w){var B=svgedit.path.path.selected_pts;if(B.length){svgedit.path.path.storeD();B=svgedit.path.path.segs[B[0]];var H={x:0,y:0};H[s]=w-B.item[s];B.move(H.x,H.y);svgedit.path.path.endChanges("Move path point")}},fixEnd:function(s){for(var w=s.pathSegList,B=w.numberOfItems,H,z=0;z<B;++z){var C=
w.getItem(z);if(C.pathSegType===2)H=C;if(C.pathSegType===1){C=w.getItem(z-1);if(C.x!=H.x||C.y!=H.y){w=s.createSVGPathSegLinetoAbs(H.x,H.y);svgedit.path.insertItemBefore(s,w,z);sa.fixEnd(s);break}}}svgedit.browser.isWebkit()&&s.setAttribute("d",sa.convertPath(s))},convertPath:function(s,w){for(var B=s.pathSegList,H=B.numberOfItems,z=0,C=0,M="",T=null,S=0;S<H;++S){var Z=B.getItem(S),aa=Z.x||0,N=Z.y||0,Y=Z.x1||0,Q=Z.y1||0,R=Z.x2||0,K=Z.y2||0,O=Z.pathSegType,ba=ic[O]["to"+(w?"Lower":"Upper")+"Case"](),
fa=function(W,ha,ya){ha=ha?" "+ha.join(" "):"";ya=ya?" "+svgedit.units.shortFloat(ya):"";$.each(W,function(wa,Sa){W[wa]=svgedit.units.shortFloat(Sa)});M+=ba+W.join(" ")+ha+ya};switch(O){case 1:M+="z";break;case 12:aa-=z;case 13:if(w){z+=aa;ba="l"}else{aa+=z;z=aa;ba="L"}fa([[aa,C]]);break;case 14:N-=C;case 15:if(w){C+=N;ba="l"}else{N+=C;C=N;ba="L"}fa([[z,N]]);break;case 2:case 4:case 18:aa-=z;N-=C;case 5:case 3:if(T&&B.getItem(S-1).pathSegType===1&&!w){z=T[0];C=T[1]}case 19:if(w){z+=aa;C+=N}else{aa+=
z;N+=C;z=aa;C=N}if(O===3)T=[z,C];fa([[aa,N]]);break;case 6:aa-=z;Y-=z;R-=z;N-=C;Q-=C;K-=C;case 7:if(w){z+=aa;C+=N}else{aa+=z;Y+=z;R+=z;N+=C;Q+=C;K+=C;z=aa;C=N}fa([[Y,Q],[R,K],[aa,N]]);break;case 8:aa-=z;Y-=z;N-=C;Q-=C;case 9:if(w){z+=aa;C+=N}else{aa+=z;Y+=z;N+=C;Q+=C;z=aa;C=N}fa([[Y,Q],[aa,N]]);break;case 10:aa-=z;N-=C;case 11:if(w){z+=aa;C+=N}else{aa+=z;N+=C;z=aa;C=N}fa([[Z.r1,Z.r2]],[Z.angle,Z.largeArcFlag?1:0,Z.sweepFlag?1:0],[aa,N]);break;case 16:aa-=z;R-=z;N-=C;K-=C;case 17:if(w){z+=aa;C+=N}else{aa+=
z;R+=z;N+=C;K+=C;z=aa;C=N}fa([[R,K],[aa,N]])}}return M}}}(),ac=this.removeUnusedDefElems=function(){var b=i.getElementsByTagNameNS(m.SVG,"defs");if(!b||!b.length)return 0;for(var g=[],d=0,u=["fill","stroke","filter","marker-start","marker-mid","marker-end"],o=u.length,F=i.getElementsByTagNameNS(m.SVG,"*"),s=F.length,w=0;w<s;w++){for(var B=F[w],H=0;H<o;H++){var z=svgedit.utilities.getUrlFromAttr(B.getAttribute(u[H]));z&&g.push(z.substr(1))}(B=da(B))&&B.indexOf("#")===0&&g.push(B.substr(1))}b=$(b).find("linearGradient, radialGradient, filter, marker, svg, symbol");
defelem_ids=[];for(w=b.length;w--;){u=b[w];o=u.id;if(g.indexOf(o)<0){Eb[o]=u;u.parentNode.removeChild(u);d++}}return d};this.svgCanvasToString=function(){for(;ac()>0;);sa.clear(true);$.each(i.childNodes,function(d,u){d&&u.nodeType===8&&u.data.indexOf("Created with")>=0&&i.insertBefore(u,i.firstChild)});if(D){Ob();ab([D])}var b=[];$(i).find("g:data(gsvg)").each(function(){for(var d=this.attributes,u=d.length,o=0;o<u;o++)if(d[o].nodeName=="id"||d[o].nodeName=="style")u--;if(u<=0){d=this.firstChild;
b.push(d);$(this).replaceWith(d)}});var g=this.svgToString(i,0);b.length&&$(b).each(function(){Yb(this)});return g};this.svgToString=function(b,g){var d=[],u=svgedit.utilities.toXml,o=l.baseUnit,F=RegExp("^-?[\\d\\.]+"+o+"$");if(b){db(b);var s=b.attributes,w,B,H=b.childNodes;for(B=0;B<g;B++)d.push(" ");d.push("<");d.push(b.nodeName);if(b.id==="svgcontent"){B=ob();if(o!=="px"){B.w=svgedit.units.convertUnit(B.w,o)+o;B.h=svgedit.units.convertUnit(B.h,o)+o}d.push(' width="'+B.w+'" height="'+B.h+'" xmlns="'+
m.SVG+'"');var z={};$(b).find("*").andSelf().each(function(){var S=this.namespaceURI;if(S&&!z[S]&&Fa[S]&&Fa[S]!=="xmlns"&&Fa[S]!=="xml"){z[S]=true;d.push(" xmlns:"+Fa[S]+'="'+S+'"')}$.each(this.attributes,function(Z,aa){var N=aa.namespaceURI;if(N&&!z[N]&&Fa[N]!=="xmlns"&&Fa[N]!=="xml"){z[N]=true;d.push(" xmlns:"+Fa[N]+'="'+N+'"')}})});B=s.length;for(o=["width","height","xmlns","x","y","viewBox","id","overflow"];B--;){w=s.item(B);var C=u(w.nodeValue);if(w.nodeName.indexOf("xmlns:")!==0)if(C!=""&&o.indexOf(w.localName)==
-1)if(!w.namespaceURI||Fa[w.namespaceURI]){d.push(" ");d.push(w.nodeName);d.push('="');d.push(C);d.push('"')}}}else{if(b.nodeName==="defs"&&!b.firstChild)return;var M=["-moz-math-font-style","_moz-math-font-style"];for(B=s.length-1;B>=0;B--){w=s.item(B);C=u(w.nodeValue);if(!(M.indexOf(w.localName)>=0))if(C!="")if(C.indexOf("pointer-events")!==0)if(!(w.localName==="class"&&C.indexOf("se_")===0)){d.push(" ");if(w.localName==="d")C=sa.convertPath(b,true);if(isNaN(C)){if(F.test(C))C=svgedit.units.shortFloat(C)+
o}else C=svgedit.units.shortFloat(C);if(eb.apply&&b.nodeName==="image"&&w.localName==="href"&&eb.images&&eb.images==="embed"){var T=Fb[C];if(T)C=T}if(!w.namespaceURI||w.namespaceURI==m.SVG||Fa[w.namespaceURI]){d.push(w.nodeName);d.push('="');d.push(C);d.push('"')}}}}if(b.hasChildNodes()){d.push(">");g++;s=false;for(B=0;B<H.length;B++){o=H.item(B);switch(o.nodeType){case 1:d.push("\n");d.push(this.svgToString(H.item(B),g));break;case 3:o=o.nodeValue.replace(/^\s+|\s+$/g,"");if(o!=""){s=true;d.push(u(o)+
"")}break;case 4:d.push("\n");d.push(Array(g+1).join(" "));d.push("<![CDATA[");d.push(o.nodeValue);d.push("]]\>");break;case 8:d.push("\n");d.push(Array(g+1).join(" "));d.push("<!--");d.push(o.data);d.push("--\>")}}g--;if(!s){d.push("\n");for(B=0;B<g;B++)d.push(" ")}d.push("</");d.push(b.nodeName);d.push(">")}else d.push("/>")}return d.join("")};this.embedImage=function(b,g){$(new Image).load(function(){var d=document.createElement("canvas");d.width=this.width;d.height=this.height;d.getContext("2d").drawImage(this,
0,0);try{var u=";svgedit_url="+encodeURIComponent(b);u=d.toDataURL().replace(";base64",u+";base64");Fb[b]=u}catch(o){Fb[b]=false}tb=b;g&&g(Fb[b])}).attr("src",b)};this.setGoodImage=function(b){tb=b};this.open=function(){};this.save=function(b){Da();b&&$.extend(eb,b);eb.apply=true;b=this.svgCanvasToString();ma("saved",b)};this.rasterExport=function(){Da();var b=[],g={feGaussianBlur:lb.exportNoBlur,foreignObject:lb.exportNoforeignObject,"[stroke-dasharray]":lb.exportNoDashArray},d=$(i);if(!("font"in
$("<canvas>")[0].getContext("2d")))g.text=lb.exportNoText;$.each(g,function(u,o){d.find(u).length&&b.push(o)});g=this.svgCanvasToString();ma("exported",{svg:g,issues:b})};this.getSvgString=function(){eb.apply=false;return this.svgCanvasToString()};this.randomizeIds=function(){arguments.length>0&&arguments[0]==false?svgedit.draw.randomizeIds(false,n()):svgedit.draw.randomizeIds(true,n())};var cb=this.uniquifyElems=function(b){var g={},d=["filter","linearGradient","pattern","radialGradient","symbol",
"textPath","use"];svgedit.utilities.walkTree(b,function(w){if(w.nodeType==1){if(w.id){w.id in g||(g[w.id]={elem:null,attrs:[],hrefs:[]});g[w.id].elem=w}$.each(Lb,function(H,z){var C=w.getAttributeNode(z);if(C){var M=svgedit.utilities.getUrlFromAttr(C.value);if(M=M?M.substr(1):null){M in g||(g[M]={elem:null,attrs:[],hrefs:[]});g[M].attrs.push(C)}}});var B=svgedit.utilities.getHref(w);if(B&&d.indexOf(w.nodeName)>=0)if(B=B.substr(1)){B in g||(g[B]={elem:null,attrs:[],hrefs:[]});g[B].hrefs.push(w)}}});
for(var u in g)if(u){var o=g[u].elem;if(o){b=La();o.id=b;o=g[u].attrs;for(var F=o.length;F--;){var s=o[F];s.ownerElement.setAttribute(s.name,"url(#"+b+")")}o=g[u].hrefs;for(F=o.length;F--;)svgedit.utilities.setHref(o[F],"#"+b)}}},Rb=this.setUseData=function(b){var g=$(b);if(b.tagName!=="use")g=g.find("use");g.each(function(){var d=da(this).substr(1);if(d=svgedit.utilities.getElem(d)){$(this).data("ref",d);if(d.tagName=="symbol"||d.tagName=="svg")$(this).data("symbol",d).data("ref",d)}})},Wb=this.convertGradients=
function(b){var g=$(b).find("linearGradient, radialGradient");if(!g.length&&svgedit.browser.isWebkit())g=$(b).find("*").filter(function(){return this.tagName.indexOf("Gradient")>=0});g.each(function(){if($(this).attr("gradientUnits")==="userSpaceOnUse"){var d=$(i).find('[fill="url(#'+this.id+')"],[stroke="url(#'+this.id+')"]');if(d.length)if(d=svgedit.utilities.getBBox(d[0]))if(this.tagName==="linearGradient"){var u=$(this).attr(["x1","y1","x2","y2"]),o=this.gradientTransform.baseVal;if(o&&o.numberOfItems>
0){var F=svgedit.math.transformListToTransform(o).matrix;o=svgedit.math.transformPoint(u.x1,u.y1,F);F=svgedit.math.transformPoint(u.x2,u.y2,F);u.x1=o.x;u.y1=o.y;u.x2=F.x;u.y2=F.y;this.removeAttribute("gradientTransform")}$(this).attr({x1:(u.x1-d.x)/d.width,y1:(u.y1-d.y)/d.height,x2:(u.x2-d.x)/d.width,y2:(u.y2-d.y)/d.height});this.removeAttribute("gradientUnits")}}})},bc=this.convertToGroup=function(b){b||(b=A[0]);var g=$(b),d=new svgedit.history.BatchCommand,u;if(g.data("gsvg")){d=$(b.firstChild).attr(["x",
"y"]);$(b.firstChild.firstChild).unwrap();$(b).removeData("gsvg");u=svgedit.transformlist.getTransformList(b);var o=c.createSVGTransform();o.setTranslate(d.x,d.y);u.appendItem(o);svgedit.recalculate.recalculateDimensions(b);ma("selected",[b])}else if(g.data("symbol")){b=g.data("symbol");u=g.attr("transform");o=g.attr(["x","y"]);var F=b.getAttribute("viewBox");if(F){F=F.split(" ");o.x-=+F[0];o.y-=+F[1]}u+=" translate("+(o.x||0)+","+(o.y||0)+")";o=g.prev();d.addSubCommand(new svgedit.history.RemoveElementCommand(g[0],
g[0].nextSibling,g[0].parentNode));g.remove();F=$(i).find("use:data(symbol)").length;g=h.createElementNS(m.SVG,"g");for(var s=b.childNodes,w=0;w<s.length;w++)g.appendChild(s[w].cloneNode(true));if(svgedit.browser.isGecko()){s=$(svgedit.utilities.findDefs()).children("linearGradient,radialGradient,pattern").clone();$(g).append(s)}u&&g.setAttribute("transform",u);u=b.parentNode;cb(g);svgedit.browser.isGecko()&&$(ia()).append($(g).find("linearGradient,radialGradient,pattern"));g.id=La();o.after(g);if(u){if(!F){o=
b.nextSibling;u.removeChild(b);d.addSubCommand(new svgedit.history.RemoveElementCommand(b,o,u))}d.addSubCommand(new svgedit.history.InsertElementCommand(g))}Rb(g);svgedit.browser.isGecko()?Wb(svgedit.utilities.findDefs()):Wb(g);svgedit.utilities.walkTreePost(g,function(B){try{svgedit.recalculate.recalculateDimensions(B)}catch(H){console.log(H)}});$(g).find("a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use").each(function(){if(!this.id)this.id=La()});ab([g]);
(b=Vb(g,true))&&d.addSubCommand(b);qa(d)}else console.log("Unexpected element to ungroup:",b)};this.setSvgString=function(b){try{var g=svgedit.utilities.text2xml(b);this.prepareSvg(g);var d=new svgedit.history.BatchCommand("Change Source"),u=i.nextSibling,o=c.removeChild(i);d.addSubCommand(new svgedit.history.RemoveElementCommand(o,u,c));i=h.adoptNode?h.adoptNode(g.documentElement):h.importNode(g.documentElement,true);c.appendChild(i);var F=$(i);f.current_drawing_=new svgedit.draw.Drawing(i,t);var s=
n().getNonce();s?ma("setnonce",s):ma("unsetnonce");F.find("image").each(function(){var T=this;nb(T);var S=da(this);if(S){if(S.indexOf("data:")===0){var Z=S.match(/svgedit_url=(.*?);/);if(Z){var aa=decodeURIComponent(Z[1]);$(new Image).load(function(){T.setAttributeNS(m.XLINK,"xlink:href",aa)}).attr("src",aa)}}f.embedImage(S)}});F.find("svg").each(function(){if(!$(this).closest("defs").length){cb(this);var T=this.parentNode;if(T.childNodes.length===1&&T.nodeName==="g"){$(T).data("gsvg",this);T.id=
T.id||La()}else Yb(this)}});svgedit.browser.isGecko()&&F.find("linearGradient, radialGradient, pattern").appendTo(svgedit.utilities.findDefs());Rb(F);Wb(F[0]);svgedit.utilities.walkTreePost(i,function(T){try{svgedit.recalculate.recalculateDimensions(T)}catch(S){console.log(S)}});var w={id:"svgcontent",overflow:l.show_outside_canvas?"visible":"hidden"},B=false;if(F.attr("viewBox")){var H=F.attr("viewBox").split(" ");w.width=H[2];w.height=H[3]}else $.each(["width","height"],function(T,S){var Z=F.attr(S);
Z||(Z="100%");if((Z+"").substr(-1)==="%")B=true;else w[S]=svgedit.units.convertToNum(S,Z)});zb();F.children().find("a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use").each(function(){if(!this.id)this.id=La()});if(B){var z=getStrokedBBox();w.width=z.width+z.x;w.height=z.height+z.y}if(w.width<=0)w.width=100;if(w.height<=0)w.height=100;F.attr(w);this.contentW=w.width;this.contentH=w.height;d.addSubCommand(new svgedit.history.InsertElementCommand(i));var C=F.attr(["width",
"height"]);d.addSubCommand(new svgedit.history.ChangeElementCommand(c,C));p=1;svgedit.transformlist.resetListMap();Da();svgedit.path.clearData();c.appendChild(va.selectorParentGroup);qa(d);ma("changed",[i])}catch(M){console.log(M);return false}return true};this.importSvgString=function(b){try{var g=svgedit.utilities.encode64(b.length+b).substr(0,32),d=false;if(mb[g])if($(mb[g].symbol).parents("#svgroot").length)d=true;var u=new svgedit.history.BatchCommand("Import SVG");if(d)var o=mb[g].symbol,F=
mb[g].xform;else{var s=svgedit.utilities.text2xml(b);this.prepareSvg(s);var w;w=h.adoptNode?h.adoptNode(s.documentElement):h.importNode(s.documentElement,true);cb(w);var B=svgedit.units.convertToNum("width",w.getAttribute("width")),H=svgedit.units.convertToNum("height",w.getAttribute("height")),z=w.getAttribute("viewBox"),C=z?z.split(" "):[0,0,B,H];for(b=0;b<4;++b)C[b]=+C[b];i.getAttribute("width");var M=+i.getAttribute("height");F=H>B?"scale("+M/3/C[3]+")":"scale("+M/3/C[2]+")";F="translate(0) "+
F+" translate(0)";o=h.createElementNS(m.SVG,"symbol");var T=svgedit.utilities.findDefs();for(svgedit.browser.isGecko()&&$(w).find("linearGradient, radialGradient, pattern").appendTo(T);w.firstChild;)o.appendChild(w.firstChild);var S=w.attributes;for(w=0;w<S.length;w++){var Z=S[w];o.setAttribute(Z.nodeName,Z.nodeValue)}o.id=La();mb[g]={symbol:o,xform:F};svgedit.utilities.findDefs().appendChild(o);u.addSubCommand(new svgedit.history.InsertElementCommand(o))}var aa=h.createElementNS(m.SVG,"use");aa.id=
La();za(aa,"#"+o.id);(D||n().getCurrentLayer()).appendChild(aa);u.addSubCommand(new svgedit.history.InsertElementCommand(aa));Da();aa.setAttribute("transform",F);svgedit.recalculate.recalculateDimensions(aa);$(aa).data("symbol",o).data("ref",o);Ya([aa]);qa(u);ma("changed",[i])}catch(N){console.log(N);return false}return true};var zb=f.identifyLayers=function(){Ob();n().identifyLayers()};this.createLayer=function(b){var g=new svgedit.history.BatchCommand("Create Layer");b=n().createLayer(b);g.addSubCommand(new svgedit.history.InsertElementCommand(b));
qa(g);Da();ma("changed",[b])};this.cloneLayer=function(b){var g=new svgedit.history.BatchCommand("Duplicate Layer"),d=h.createElementNS(m.SVG,"g"),u=h.createElementNS(m.SVG,"title");u.textContent=b;d.appendChild(u);u=n().getCurrentLayer();$(u).after(d);u=u.childNodes;for(var o=0;o<u.length;o++){var F=u[o];F.localName!="title"&&d.appendChild(xb(F))}Da();zb();g.addSubCommand(new svgedit.history.InsertElementCommand(d));qa(g);f.setCurrentLayer(b);ma("changed",[d])};this.deleteCurrentLayer=function(){var b=
n().getCurrentLayer(),g=b.nextSibling,d=b.parentNode;if(b=n().deleteCurrentLayer()){var u=new svgedit.history.BatchCommand("Delete Layer");u.addSubCommand(new svgedit.history.RemoveElementCommand(b,g,d));qa(u);Da();ma("changed",[d]);return true}return false};this.setCurrentLayer=function(b){(b=n().setCurrentLayer(svgedit.utilities.toXml(b)))&&Da();return b};this.renameCurrentLayer=function(b){var g=n();if(g.current_layer){var d=g.current_layer;if(!f.setCurrentLayer(b)){for(var u=new svgedit.history.BatchCommand("Rename Layer"),
o=0;o<g.getNumLayers();++o)if(g.all_layers[o][1]==d)break;var F=g.getLayerName(o);g.all_layers[o][0]=svgedit.utilities.toXml(b);var s=d.childNodes.length;for(o=0;o<s;++o){var w=d.childNodes.item(o);if(w&&w.tagName=="title"){for(;w.firstChild;)w.removeChild(w.firstChild);w.textContent=b;u.addSubCommand(new svgedit.history.ChangeElementCommand(w,{"#text":F}));qa(u);ma("changed",[d]);return true}}}g.current_layer=d}return false};this.setCurrentLayerPosition=function(b){var g=n();if(g.current_layer&&
b>=0&&b<g.getNumLayers()){for(var d=0;d<g.getNumLayers();++d)if(g.all_layers[d][1]==g.current_layer)break;if(d==g.getNumLayers())return false;if(d!=b){var u=null,o=g.current_layer.nextSibling;if(b>d){if(b<g.getNumLayers()-1)u=g.all_layers[b+1][1]}else u=g.all_layers[b][1];i.insertBefore(g.current_layer,u);qa(new svgedit.history.MoveElementCommand(g.current_layer,o,i));zb();f.setCurrentLayer(g.getLayerName(b));return true}}return false};this.setLayerVisibility=function(b,g){var d=n(),u=d.getLayerVisibility(b),
o=d.setLayerVisibility(b,g);if(o)qa(new svgedit.history.ChangeElementCommand(o,{display:u?"inline":"none"},"Layer Visibility"));else return false;if(o==d.getCurrentLayer()){Da();sa.clear()}return true};this.moveSelectedToLayer=function(b){for(var g=null,d=n(),u=0;u<d.getNumLayers();++u)if(d.getLayerName(u)==b){g=d.all_layers[u][1];break}if(!g)return false;b=new svgedit.history.BatchCommand("Move Elements to Layer");d=A;for(u=d.length;u--;){var o=d[u];if(o){var F=o.nextSibling,s=o.parentNode;g.appendChild(o);
b.addSubCommand(new svgedit.history.MoveElementCommand(o,F,s))}}qa(b);return true};this.mergeLayer=function(b){var g=new svgedit.history.BatchCommand("Merge Layer"),d=n(),u=$(d.current_layer).prev()[0];if(u){for(g.addSubCommand(new svgedit.history.RemoveElementCommand(d.current_layer,d.current_layer.nextSibling,i));d.current_layer.firstChild;){var o=d.current_layer.firstChild;if(o.localName=="title"){g.addSubCommand(new svgedit.history.RemoveElementCommand(o,o.nextSibling,d.current_layer));d.current_layer.removeChild(o)}else{var F=
o.nextSibling;u.appendChild(o);g.addSubCommand(new svgedit.history.MoveElementCommand(o,F,d.current_layer))}}i.removeChild(d.current_layer);if(!b){Da();zb();ma("changed",[i]);qa(g)}d.current_layer=u;return g}};this.mergeAllLayers=function(){var b=new svgedit.history.BatchCommand("Merge all Layers"),g=n();for(g.current_layer=g.all_layers[g.getNumLayers()-1][1];$(i).children("g").length>1;)b.addSubCommand(f.mergeLayer(true));Da();zb();ma("changed",[i]);qa(b)};var Ob=this.leaveContext=function(){var b=
Mb.length;if(b){for(var g=0;g<b;g++){var d=Mb[g],u=Cb(d,"orig_opac");u!==1?d.setAttribute("opacity",u):d.removeAttribute("opacity");d.setAttribute("style","pointer-events: inherit")}Mb=[];Da(true);ma("contextset",null)}D=null},$b=this.setContext=function(b){Ob();if(typeof b==="string")b=svgedit.utilities.getElem(b);D=b;$(b).parentsUntil("#svgcontent").andSelf().siblings().each(function(){var g=this.getAttribute("opacity")||1;Cb(this,"orig_opac",g);this.setAttribute("opacity",g*0.33);this.setAttribute("style",
"pointer-events: none");Mb.push(this)});Da();ma("contextset",D)};this.clear=function(){sa.clear();Da();f.clearSvgContentElement();f.current_drawing_=new svgedit.draw.Drawing(i);f.createLayer("Layer 1");f.undoMgr.resetUndoStack();va.initGroup();Ca=va.getRubberBandBox();ma("cleared")};this.linkControlPoints=sa.linkControlPoints;this.getContentElem=function(){return i};this.getRootElem=function(){return c};this.getSelectedElems=function(){return A};var ob=this.getResolution=function(){var b=i.getAttribute("width")/
p,g=i.getAttribute("height")/p;return{w:b,h:g,zoom:p}};this.getZoom=function(){return p};this.getVersion=function(){return"svgcanvas.js ($Rev: 2533 $)"};this.setUiStrings=function(b){$.extend(lb,b.notification)};this.setConfig=function(b){$.extend(l,b)};this.getTitle=function(b){if(b=b||A[0]){b=$(b).data("gsvg")||$(b).data("symbol")||b;b=b.childNodes;for(var g=0;g<b.length;g++)if(b[g].nodeName=="title")return b[g].textContent;return""}};this.setGroupTitle=function(b){var g=A[0];g=$(g).data("gsvg")||
g;var d=$(g).children("title"),u=new svgedit.history.BatchCommand("Set Label");if(b.length)if(d.length){d=d[0];u.addSubCommand(new svgedit.history.ChangeElementCommand(d,{"#text":d.textContent}));d.textContent=b}else{d=h.createElementNS(m.SVG,"title");d.textContent=b;$(g).prepend(d);u.addSubCommand(new svgedit.history.InsertElementCommand(d))}else{u.addSubCommand(new svgedit.history.RemoveElementCommand(d[0],d.nextSibling,g));d.remove()}qa(u)};this.getDocumentTitle=function(){return f.getTitle(i)};
this.setDocumentTitle=function(b){for(var g=i.childNodes,d=false,u="",o=new svgedit.history.BatchCommand("Change Image Title"),F=0;F<g.length;F++)if(g[F].nodeName=="title"){d=g[F];u=d.textContent;break}if(!d){d=h.createElementNS(m.SVG,"title");i.insertBefore(d,i.firstChild)}if(b.length)d.textContent=b;else d.parentNode.removeChild(d);o.addSubCommand(new svgedit.history.ChangeElementCommand(d,{"#text":u}));qa(o)};this.getEditorNS=function(b){b&&i.setAttribute("xmlns:se",m.SE);return m.SE};this.setResolution=
function(b,g){var d=ob(),u=d.w;d=d.h;var o;if(b=="fit"){var F=getStrokedBBox();if(F){o=new svgedit.history.BatchCommand("Fit Canvas to Content");var s=Nb();Ya(s);var w=[],B=[];$.each(s,function(){w.push(F.x*-1);B.push(F.y*-1)});s=f.moveSelectedElements(w,B,true);o.addSubCommand(s);Da();b=Math.round(F.width);g=Math.round(F.height)}else return false}if(b!=u||g!=d){s=c.suspendRedraw(1E3);o||(o=new svgedit.history.BatchCommand("Change Image Dimensions"));b=svgedit.units.convertToNum("width",b);g=svgedit.units.convertToNum("height",
g);i.setAttribute("width",b);i.setAttribute("height",g);this.contentW=b;this.contentH=g;o.addSubCommand(new svgedit.history.ChangeElementCommand(i,{width:u,height:d}));i.setAttribute("viewBox",[0,0,b/p,g/p].join(" "));o.addSubCommand(new svgedit.history.ChangeElementCommand(i,{viewBox:["0 0",u,d].join(" ")}));qa(o);c.unsuspendRedraw(s);ma("changed",[i])}return true};this.getOffset=function(){return $(i).attr(["x","y"])};this.setBBoxZoom=function(b,g,d){var u=0.85,o=function(F){if(!F)return false;
var s=Math.min(Math.round(g/F.width*100*u)/100,Math.round(d/F.height*100*u)/100);f.setZoom(s);return{zoom:s,bbox:F}};if(typeof b=="object"){b=b;if(b.width==0||b.height==0){f.setZoom(b.zoom?b.zoom:p*b.factor);return{zoom:p,bbox:b}}return o(b)}switch(b){case "selection":if(!A[0])return;b=$.map(A,function(F){if(F)return F});b=getStrokedBBox(b);break;case "canvas":b=ob();u=0.95;b={width:b.w,height:b.h,x:0,y:0};break;case "content":b=getStrokedBBox();break;case "layer":b=getStrokedBBox(Nb(n().getCurrentLayer()));
break;default:return}return o(b)};this.setZoom=function(b){var g=ob();i.setAttribute("viewBox","0 0 "+g.w/b+" "+g.h/b);p=b;$.each(A,function(d,u){u&&va.requestSelector(u).resize()});sa.zoomChange();wb("zoomChanged",b)};this.getMode=function(){return ra};this.setMode=function(b){sa.clear(true);Pa.clear();Oa=A[0]&&A[0].nodeName=="text"?Ua:L;ra=b};this.getColor=function(b){return Oa[b]};this.setColor=function(b,g,d){L[b]=g;Oa[b+"_paint"]={type:"solidColor"};for(var u=[],o=A.length;o--;){var F=A[o];if(F)if(F.tagName==
"g")svgedit.utilities.walkTree(F,function(s){s.nodeName!="g"&&u.push(s)});else if(b=="fill")F.tagName!="polyline"&&F.tagName!="line"&&u.push(F);else u.push(F)}if(u.length>0)if(d)Ab(b,g,u);else{Ra(b,g,u);ma("changed",u)}};var Kb=this.setGradient=function(b){if(!(!Oa[b+"_paint"]||Oa[b+"_paint"].type=="solidColor")){var g=f[b+"Grad"],d=cc(g),u=svgedit.utilities.findDefs();if(d)g=d;else{g=u.appendChild(h.importNode(g,true));g.id=La()}f.setColor(b,"url(#"+g.id+")")}},cc=function(b){var g=svgedit.utilities.findDefs();
g=$(g).find("linearGradient, radialGradient");for(var d=g.length,u=["r","cx","cy","fx","fy"];d--;){var o=g[d];if(b.tagName=="linearGradient"){if(b.getAttribute("x1")!=o.getAttribute("x1")||b.getAttribute("y1")!=o.getAttribute("y1")||b.getAttribute("x2")!=o.getAttribute("x2")||b.getAttribute("y2")!=o.getAttribute("y2"))continue}else{var F=$(b).attr(u),s=$(o).attr(u),w=false;$.each(u,function(T,S){if(F[S]!=s[S])w=true});if(w)continue}var B=b.getElementsByTagNameNS(m.SVG,"stop"),H=o.getElementsByTagNameNS(m.SVG,
"stop");if(B.length==H.length){for(var z=B.length;z--;){var C=B[z],M=H[z];if(C.getAttribute("offset")!=M.getAttribute("offset")||C.getAttribute("stop-opacity")!=M.getAttribute("stop-opacity")||C.getAttribute("stop-color")!=M.getAttribute("stop-color"))break}if(z==-1)return o}}return null};this.setPaint=function(b,g){var d=new $.jGraduate.Paint(g);this.setPaintOpacity(b,d.alpha/100,true);Oa[b+"_paint"]=d;switch(d.type){case "solidColor":this.setColor(b,d.solidColor!="none"?"#"+d.solidColor:"none");
break;case "linearGradient":case "radialGradient":f[b+"Grad"]=d[d.type];Kb(b)}};this.setStrokePaint=function(b){this.setPaint("stroke",b)};this.setFillPaint=function(b){this.setPaint("fill",b)};this.getStrokeWidth=function(){return Oa.stroke_width};this.setStrokeWidth=function(b){if(b==0&&["line","path"].indexOf(ra)>=0)f.setStrokeWidth(1);else{Oa.stroke_width=b;for(var g=[],d=A.length;d--;){var u=A[d];if(u)u.tagName=="g"?svgedit.utilities.walkTree(u,function(o){o.nodeName!="g"&&g.push(o)}):g.push(u)}if(g.length>
0){Ra("stroke-width",b,g);ma("changed",A)}}};this.setStrokeAttr=function(b,g){L[b.replace("-","_")]=g;for(var d=[],u=A.length;u--;){var o=A[u];if(o)o.tagName=="g"?svgedit.utilities.walkTree(o,function(F){F.nodeName!="g"&&d.push(F)}):d.push(o)}if(d.length>0){Ra(b,g,d);ma("changed",A)}};this.getStyle=function(){return L};this.getOpacity=function(){return L.opacity};this.setOpacity=function(b){L.opacity=b;Ra("opacity",b)};this.getFillOpacity=function(){return L.fill_opacity};this.getStrokeOpacity=function(){return L.stroke_opacity};
this.setPaintOpacity=function(b,g,d){L[b+"_opacity"]=g;d?Ab(b+"-opacity",g):Ra(b+"-opacity",g)};this.getPaintOpacity=function(b){return b==="fill"?this.getFillOpacity():this.getStrokeOpacity()};this.getBlur=function(b){var g=0;if(b)if(b.getAttribute("filter"))if(b=svgedit.utilities.getElem(b.id+"_blur"))g=b.firstChild.getAttribute("stdDeviation");return g};(function(){function b(){var o=f.undoMgr.finishUndoableChange();g.addSubCommand(o);qa(g);d=g=null}var g=null,d=null,u=false;f.setBlurNoUndo=function(o){if(d)if(o===
0){Ab("filter","");u=true}else{var F=A[0];u&&Ab("filter","url(#"+F.id+"_blur)");if(svgedit.browser.isWebkit()){console.log("e",F);F.removeAttribute("filter");F.setAttribute("filter","url(#"+F.id+"_blur)")}Ab("stdDeviation",o,[d.firstChild]);f.setBlurOffsets(d,o)}else f.setBlur(o)};f.setBlurOffsets=function(o,F){if(F>3)svgedit.utilities.assignAttributes(o,{x:"-50%",y:"-50%",width:"200%",height:"200%"},100);else if(!svgedit.browser.isWebkit()){o.removeAttribute("x");o.removeAttribute("y");o.removeAttribute("width");
o.removeAttribute("height")}};f.setBlur=function(o,F){if(g)b();else{var s=A[0],w=s.id;d=svgedit.utilities.getElem(w+"_blur");o-=0;var B=new svgedit.history.BatchCommand;if(d){if(o===0)d=null}else{var H=ga({element:"feGaussianBlur",attr:{"in":"SourceGraphic",stdDeviation:o}});d=ga({element:"filter",attr:{id:w+"_blur"}});d.appendChild(H);svgedit.utilities.findDefs().appendChild(d);B.addSubCommand(new svgedit.history.InsertElementCommand(d))}H={filter:s.getAttribute("filter")};if(o===0){s.removeAttribute("filter");
B.addSubCommand(new svgedit.history.ChangeElementCommand(s,H))}else{Ra("filter","url(#"+w+"_blur)");B.addSubCommand(new svgedit.history.ChangeElementCommand(s,H));f.setBlurOffsets(d,o);g=B;f.undoMgr.beginUndoableChange("stdDeviation",[d?d.firstChild:null]);if(F){f.setBlurNoUndo(o);b()}}}}})();this.getBold=function(){var b=A[0];if(b!=null&&b.tagName=="text"&&A[1]==null)return b.getAttribute("font-weight")=="bold";return false};this.setBold=function(b){var g=A[0];if(g!=null&&g.tagName=="text"&&A[1]==
null)Ra("font-weight",b?"bold":"normal");A[0].textContent||Pa.setCursor()};this.getItalic=function(){var b=A[0];if(b!=null&&b.tagName=="text"&&A[1]==null)return b.getAttribute("font-style")=="italic";return false};this.setItalic=function(b){var g=A[0];if(g!=null&&g.tagName=="text"&&A[1]==null)Ra("font-style",b?"italic":"normal");A[0].textContent||Pa.setCursor()};this.getFontFamily=function(){return Ua.font_family};this.setFontFamily=function(b){Ua.font_family=b;Ra("font-family",b);A[0]&&!A[0].textContent&&
Pa.setCursor()};this.setFontColor=function(b){Ua.fill=b;Ra("fill",b)};this.getFontColor=function(){return Ua.fill};this.getFontSize=function(){return Ua.font_size};this.setFontSize=function(b){Ua.font_size=b;Ra("font-size",b);A[0].textContent||Pa.setCursor()};this.getText=function(){var b=A[0];if(b==null)return"";return b.textContent};this.setTextContent=function(b){Ra("#text",b);Pa.init(b);Pa.setCursor()};this.setImageURL=function(b){var g=A[0];if(g){var d=$(g).attr(["width","height"]);d=!d.width||
!d.height;var u=da(g);if(u!==b)d=true;else if(!d)return;var o=new svgedit.history.BatchCommand("Change Image URL");za(g,b);o.addSubCommand(new svgedit.history.ChangeElementCommand(g,{"#href":u}));d?$(new Image).load(function(){var F=$(g).attr(["width","height"]);$(g).attr({width:this.width,height:this.height});va.requestSelector(g).resize();o.addSubCommand(new svgedit.history.ChangeElementCommand(g,F));qa(o);ma("changed",[g])}).attr("src",b):qa(o)}};this.setLinkURL=function(b){var g=A[0];if(g){if(g.tagName!==
"a"){g=$(g).parents("a");if(g.length)g=g[0];else return}var d=da(g);if(d!==b){var u=new svgedit.history.BatchCommand("Change Link URL");za(g,b);u.addSubCommand(new svgedit.history.ChangeElementCommand(g,{"#href":d}));qa(u)}}};this.setRectRadius=function(b){var g=A[0];if(g!=null&&g.tagName=="rect"){var d=g.getAttribute("rx");if(d!=b){g.setAttribute("rx",b);g.setAttribute("ry",b);qa(new svgedit.history.ChangeElementCommand(g,{rx:d,ry:d},"Radius"));ma("changed",[g])}}};this.makeHyperlink=function(b){f.groupSelectedElements("a",
b)};this.removeHyperlink=function(){f.ungroupSelectedElement()};this.setSegType=function(b){sa.setSegType(b)};this.convertToPath=function(b,g){if(b==null)$.each(A,function(Y,Q){Q&&f.convertToPath(Q)});else{if(!g)var d=new svgedit.history.BatchCommand("Convert element to Path");var u=g?{}:{fill:L.fill,"fill-opacity":L.fill_opacity,stroke:L.stroke,"stroke-width":L.stroke_width,"stroke-dasharray":L.stroke_dasharray,"stroke-linejoin":L.stroke_linejoin,"stroke-linecap":L.stroke_linecap,"stroke-opacity":L.stroke_opacity,
opacity:L.opacity,visibility:"hidden"};$.each(["marker-start","marker-end","marker-mid","filter","clip-path"],function(){if(b.getAttribute(this))u[this]=b.getAttribute(this)});var o=ga({element:"path",attr:u}),F=b.getAttribute("transform");F&&o.setAttribute("transform",F);var s=b.id,w=b.parentNode;b.nextSibling?w.insertBefore(o,b):w.appendChild(o);var B="",H=function(Y){$.each(Y,function(Q,R){var K=R[1];B+=R[0];for(var O=0;O<K.length;O+=2)B+=K[O]+","+K[O+1]+" "})},z=1.81;switch(b.tagName){case "ellipse":case "circle":var C=
$(b).attr(["rx","ry","cx","cy"]),M=C.cx,T=C.cy,S=C.rx;C=C.ry;if(b.tagName=="circle")S=C=$(b).attr("r");H([["M",[M-S,T]],["C",[M-S,T-C/z,M-S/z,T-C,M,T-C]],["C",[M+S/z,T-C,M+S,T-C/z,M+S,T]],["C",[M+S,T+C/z,M+S/z,T+C,M,T+C]],["C",[M-S/z,T+C,M-S,T+C/z,M-S,T]],["Z",[]]]);break;case "path":B=b.getAttribute("d");break;case "line":C=$(b).attr(["x1","y1","x2","y2"]);B="M"+C.x1+","+C.y1+"L"+C.x2+","+C.y2;break;case "polyline":case "polygon":B="M"+b.getAttribute("points");break;case "rect":C=$(b).attr(["rx",
"ry"]);S=C.rx;C=C.ry;var Z=b.getBBox();M=Z.x;T=Z.y;var aa=Z.width;Z=Z.height;z=4-z;!S&&!C?H([["M",[M,T]],["L",[M+aa,T]],["L",[M+aa,T+Z]],["L",[M,T+Z]],["L",[M,T]],["Z",[]]]):H([["M",[M,T+C]],["C",[M,T+C/z,M+S/z,T,M+S,T]],["L",[M+aa-S,T]],["C",[M+aa-S/z,T,M+aa,T+C/z,M+aa,T+C]],["L",[M+aa,T+Z-C]],["C",[M+aa,T+Z-C/z,M+aa-S/z,T+Z,M+aa-S,T+Z]],["L",[M+S,T+Z]],["C",[M+S/z,T+Z,M,T+Z-C/z,M,T+Z-C]],["L",[M,T+C]],["Z",[]]]);break;default:o.parentNode.removeChild(o)}B&&o.setAttribute("d",B);if(g){sa.resetOrientation(o);
d=false;try{d=o.getBBox()}catch(N){}o.parentNode.removeChild(o);return d}else{if(F){F=svgedit.transformlist.getTransformList(o);svgedit.math.hasMatrixTransform(F)&&sa.resetOrientation(o)}d.addSubCommand(new svgedit.history.RemoveElementCommand(b,b.nextSibling,w));d.addSubCommand(new svgedit.history.InsertElementCommand(o));Da();b.parentNode.removeChild(b);o.setAttribute("id",s);o.removeAttribute("visibility");Ya([o],true);qa(d)}}};var Ab=function(b,g,d){var u=c.suspendRedraw(1E3);ra=="pathedit"&&
sa.moveNode(b,g);d=d||A;for(var o=d.length,F=["g","polyline","path"],s=["transform","opacity","filter"];o--;){var w=d[o];if(w!=null)if((b==="x"||b==="y")&&F.indexOf(w.tagName)>=0){var B=getStrokedBBox([w]);f.moveSelectedElements((b==="x"?g-B.x:0)*p,(b==="y"?g-B.y:0)*p,true)}else{w.tagName==="g"&&s.indexOf(b);B=b==="#text"?w.textContent:w.getAttribute(b);if(B==null)B="";if(B!==String(g)){if(b=="#text"){svgedit.utilities.getBBox(w);w.textContent=g;if(/rotate/.test(w.getAttribute("transform")))w=Tb(w)}else b==
"#href"?za(w,g):w.setAttribute(b,g);ra==="textedit"&&b!=="#text"&&w.textContent.length&&Pa.toSelectMode(w);if(svgedit.browser.isGecko()&&w.nodeName==="text"&&/rotate/.test(w.getAttribute("transform")))if((g+"").indexOf("url")===0||["font-size","font-family","x","y"].indexOf(b)>=0&&w.textContent)w=Tb(w);A.indexOf(w)>=0&&setTimeout(function(){w.parentNode&&va.requestSelector(w).resize()},0);B=svgedit.utilities.getRotationAngle(w);if(B!=0&&b!="transform")for(var H=svgedit.transformlist.getTransformList(w),
z=H.numberOfItems;z--;)if(H.getItem(z).type==4){H.removeItem(z);var C=svgedit.utilities.getBBox(w),M=svgedit.math.transformPoint(C.x+C.width/2,C.y+C.height/2,svgedit.math.transformListToTransform(H).matrix);C=M.x;M=M.y;var T=c.createSVGTransform();T.setRotate(B,C,M);H.insertItemBefore(T,z);break}}}}c.unsuspendRedraw(u)},Ra=this.changeSelectedAttribute=function(b,g,d){d=d||A;f.undoMgr.beginUndoableChange(b,d);Ab(b,g,d);b=f.undoMgr.finishUndoableChange();b.isEmpty()||qa(b)};this.deleteSelectedElements=
function(){for(var b=new svgedit.history.BatchCommand("Delete Elements"),g=A.length,d=[],u=0;u<g;++u){var o=A[u];if(o==null)break;var F=o.parentNode,s=o;va.releaseSelector(s);svgedit.path.removePath_(s.id);if(F.tagName==="a"&&F.childNodes.length===1){s=F;F=F.parentNode}var w=s.nextSibling;s=F.removeChild(s);d.push(o);A[u]=null;b.addSubCommand(new Za(s,w,F))}b.isEmpty()||qa(b);ma("changed",d);Da()};this.cutSelectedElements=function(){for(var b=new svgedit.history.BatchCommand("Cut Elements"),g=A.length,
d=[],u=0;u<g;++u){var o=A[u];if(o==null)break;var F=o.parentNode,s=o;va.releaseSelector(s);svgedit.path.removePath_(s.id);var w=s.nextSibling;s=F.removeChild(s);d.push(o);A[u]=null;b.addSubCommand(new Za(s,w,F))}b.isEmpty()||qa(b);ma("changed",d);Da();f.clipBoard=d};this.copySelectedElements=function(){f.clipBoard=$.merge([],A)};this.pasteElements=function(b,g,d){var u=f.clipBoard,o=u.length;if(o){for(var F=[],s=new svgedit.history.BatchCommand("Paste elements");o--;){var w=u[o];if(w){var B=xb(w);
if(!svgedit.utilities.getElem(w.id))B.id=w.id;F.push(B);(D||n().getCurrentLayer()).appendChild(B);s.addSubCommand(new svgedit.history.InsertElementCommand(B))}}ab(F);if(b!=="in_place"){var H,z;if(b){if(b==="point"){H=g;z=d}}else{H=Gb.x;z=Gb.y}b=getStrokedBBox(F);var C=H-(b.x+b.width/2),M=z-(b.y+b.height/2),T=[],S=[];$.each(F,function(){T.push(C);S.push(M)});H=f.moveSelectedElements(T,S,false);s.addSubCommand(H)}qa(s);ma("changed",F)}};this.groupSelectedElements=function(b){b||(b="g");var g="";switch(b){case "a":g=
"Make hyperlink";var d="";if(arguments.length>1)d=arguments[1];break;default:b="g";g="Group Elements"}g=new svgedit.history.BatchCommand(g);var u=ga({element:b,attr:{id:La()}});b==="a"&&za(u,d);g.addSubCommand(new svgedit.history.InsertElementCommand(u));for(d=A.length;d--;){var o=A[d];if(o!=null){if(o.parentNode.tagName==="a"&&o.parentNode.childNodes.length===1)o=o.parentNode;var F=o.nextSibling,s=o.parentNode;u.appendChild(o);g.addSubCommand(new svgedit.history.MoveElementCommand(o,F,s))}}g.isEmpty()||
qa(g);ab([u],true)};var Vb=this.pushGroupProperties=function(b,g){var d=b.childNodes,u=d.length,o=b.getAttribute("transform"),F=svgedit.transformlist.getTransformList(b),s=svgedit.math.transformListToTransform(F).matrix,w=new svgedit.history.BatchCommand("Push group properties"),B=0,H=svgedit.utilities.getRotationAngle(b),z=$(b).attr(["filter","opacity"]),C,M;for(B=0;B<u;B++){var T=d[B];if(T.nodeType===1){if(z.opacity!==null&&z.opacity!==1){T.getAttribute("opacity");var S=Math.round((T.getAttribute("opacity")||
1)*z.opacity*100)/100;Ra("opacity",S,[T])}if(z.filter){var Z=S=this.getBlur(T);M||(M=this.getBlur(b));if(S)S=M-0+(S-0);else if(S===0)S=M;if(Z)C=svgedit.utilities.getRefElem(T.getAttribute("filter"));else if(C){C=xb(C);svgedit.utilities.findDefs().appendChild(C)}else C=svgedit.utilities.getRefElem(z.filter);C.id=T.id+"_"+(C.firstChild.tagName==="feGaussianBlur"?"blur":"filter");Ra("filter","url(#"+C.id+")",[T]);if(S){Ra("stdDeviation",S,[C.firstChild]);f.setBlurOffsets(C,S)}}S=svgedit.transformlist.getTransformList(T);
if(~T.tagName.indexOf("Gradient"))S=null;if(S)if(T.tagName!=="defs")if(F.numberOfItems){if(H&&F.numberOfItems==1){var aa=F.getItem(0).matrix,N=c.createSVGMatrix();if(Z=svgedit.utilities.getRotationAngle(T))N=S.getItem(0).matrix;var Y=svgedit.utilities.getBBox(T),Q=svgedit.math.transformListToTransform(S).matrix,R=svgedit.math.transformPoint(Y.x+Y.width/2,Y.y+Y.height/2,Q);Y=H+Z;Q=c.createSVGTransform();Q.setRotate(Y,R.x,R.y);aa=svgedit.math.matrixMultiply(aa,N,Q.matrix.inverse());Z&&S.removeItem(0);
if(Y)S.numberOfItems?S.insertItemBefore(Q,0):S.appendItem(Q);if(aa.e||aa.f){Z=c.createSVGTransform();Z.setTranslate(aa.e,aa.f);S.numberOfItems?S.insertItemBefore(Z,0):S.appendItem(Z)}}else{Z=T.getAttribute("transform");aa={};aa.transform=Z?Z:"";Z=c.createSVGTransform();aa=svgedit.math.transformListToTransform(S).matrix;N=aa.inverse();aa=svgedit.math.matrixMultiply(N,s,aa);Z.setMatrix(aa);S.appendItem(Z)}(T=svgedit.recalculate.recalculateDimensions(T))&&w.addSubCommand(T)}}}if(o){aa={};aa.transform=
o;b.setAttribute("transform","");b.removeAttribute("transform");w.addSubCommand(new svgedit.history.ChangeElementCommand(b,aa))}if(g&&!w.isEmpty())return w};this.ungroupSelectedElement=function(){var b=A[0];if($(b).data("gsvg")||$(b).data("symbol"))bc(b);else if(b.tagName==="use"){var g=svgedit.utilities.getElem(da(b).substr(1));$(b).data("symbol",g).data("ref",g);bc(b)}else{g=$(b).parents("a");if(g.length)b=g[0];if(b.tagName==="g"||b.tagName==="a"){g=new svgedit.history.BatchCommand("Ungroup Elements");
var d=Vb(b,true);d&&g.addSubCommand(d);d=b.parentNode;for(var u=b.nextSibling,o=Array(b.childNodes.length),F=0;b.firstChild;){var s=b.firstChild,w=s.nextSibling,B=s.parentNode;if(s.tagName==="title"){g.addSubCommand(new svgedit.history.RemoveElementCommand(s,s.nextSibling,B));B.removeChild(s)}else{o[F++]=s=d.insertBefore(s,u);g.addSubCommand(new svgedit.history.MoveElementCommand(s,w,B))}}Da();u=b.nextSibling;b=d.removeChild(b);g.addSubCommand(new svgedit.history.RemoveElementCommand(b,u,d));g.isEmpty()||
qa(g);Ya(o)}}};this.moveToTopSelectedElement=function(){var b=A[0];if(b!=null){b=b;var g=b.parentNode,d=b.nextSibling;b=b.parentNode.appendChild(b);if(d!=b.nextSibling){qa(new svgedit.history.MoveElementCommand(b,d,g,"top"));ma("changed",[b])}}};this.moveToBottomSelectedElement=function(){var b=A[0];if(b!=null){b=b;var g=b.parentNode,d=b.nextSibling,u=b.parentNode.firstChild;if(u.tagName=="title")u=u.nextSibling;if(u.tagName=="defs")u=u.nextSibling;b=b.parentNode.insertBefore(b,u);if(d!=b.nextSibling){qa(new svgedit.history.MoveElementCommand(b,
d,g,"bottom"));ma("changed",[b])}}};this.moveUpDownSelected=function(b){var g=A[0];if(g){Ia=[];var d,u,o=$(Sb(getStrokedBBox([g]))).toArray();b=="Down"&&o.reverse();$.each(o,function(){if(u){d=this;return false}else if(this==g)u=true});if(d){o=g.parentNode;var F=g.nextSibling;$(d)[b=="Down"?"before":"after"](g);if(F!=g.nextSibling){qa(new svgedit.history.MoveElementCommand(g,F,o,"Move "+b));ma("changed",[g])}}}};this.moveSelectedElements=function(b,g,d){if(b.constructor!=Array){b/=p;g/=p}d=d||true;
for(var u=new svgedit.history.BatchCommand("position"),o=A.length;o--;){var F=A[o];if(F!=null){var s=c.createSVGTransform(),w=svgedit.transformlist.getTransformList(F);b.constructor==Array?s.setTranslate(b[o],g[o]):s.setTranslate(b,g);w.numberOfItems?w.insertItemBefore(s,0):w.appendItem(s);(s=svgedit.recalculate.recalculateDimensions(F))&&u.addSubCommand(s);va.requestSelector(F).resize()}}if(!u.isEmpty()){d&&qa(u);ma("changed",A);return u}};this.cloneSelectedElements=function(b,g){var d=new svgedit.history.BatchCommand("Clone Elements"),
u=A.length;A.sort(function(s,w){return $(w).index()-$(s).index()});for(var o=0;o<u;++o){var F=A[o];if(F==null)break}u=A.slice(0,o);this.clearSelection(true);for(o=u.length;o--;){F=u[o]=xb(u[o]);(D||n().getCurrentLayer()).appendChild(F);d.addSubCommand(new svgedit.history.InsertElementCommand(F))}if(!d.isEmpty()){Ya(u.reverse());this.moveSelectedElements(b,g,false);qa(d)}};this.alignSelectedElements=function(b,g){var d=[],u=Number.MAX_VALUE,o=Number.MIN_VALUE,F=Number.MAX_VALUE,s=Number.MIN_VALUE,
w=Number.MIN_VALUE,B=Number.MIN_VALUE,H=A.length;if(H){for(var z=0;z<H;++z){if(A[z]==null)break;d[z]=getStrokedBBox([A[z]]);switch(g){case "smallest":if((b=="l"||b=="c"||b=="r")&&(w==Number.MIN_VALUE||w>d[z].width)||(b=="t"||b=="m"||b=="b")&&(B==Number.MIN_VALUE||B>d[z].height)){u=d[z].x;F=d[z].y;o=d[z].x+d[z].width;s=d[z].y+d[z].height;w=d[z].width;B=d[z].height}break;case "largest":if((b=="l"||b=="c"||b=="r")&&(w==Number.MIN_VALUE||w<d[z].width)||(b=="t"||b=="m"||b=="b")&&(B==Number.MIN_VALUE||
B<d[z].height)){u=d[z].x;F=d[z].y;o=d[z].x+d[z].width;s=d[z].y+d[z].height;w=d[z].width;B=d[z].height}break;default:if(d[z].x<u)u=d[z].x;if(d[z].y<F)F=d[z].y;if(d[z].x+d[z].width>o)o=d[z].x+d[z].width;if(d[z].y+d[z].height>s)s=d[z].y+d[z].height}}if(g=="page"){F=u=0;o=f.contentW;s=f.contentH}w=Array(H);B=Array(H);for(z=0;z<H;++z){if(A[z]==null)break;var C=d[z];w[z]=0;B[z]=0;switch(b){case "l":w[z]=u-C.x;break;case "c":w[z]=(u+o)/2-(C.x+C.width/2);break;case "r":w[z]=o-(C.x+C.width);break;case "t":B[z]=
F-C.y;break;case "m":B[z]=(F+s)/2-(C.y+C.height/2);break;case "b":B[z]=s-(C.y+C.height)}}this.moveSelectedElements(w,B)}};this.contentW=ob().w;this.contentH=ob().h;this.updateCanvas=function(b,g){c.setAttribute("width",b);c.setAttribute("height",g);var d=$("#canvasBackground")[0],u=i.getAttribute("x"),o=i.getAttribute("y"),F=b/2-this.contentW*p/2,s=g/2-this.contentH*p/2;svgedit.utilities.assignAttributes(i,{width:this.contentW*p,height:this.contentH*p,x:F,y:s,viewBox:"0 0 "+this.contentW+" "+this.contentH});
svgedit.utilities.assignAttributes(d,{width:i.getAttribute("width"),height:i.getAttribute("height"),x:F,y:s});(d=svgedit.utilities.getElem("background_image"))&&svgedit.utilities.assignAttributes(d,{width:"100%",height:"100%"});va.selectorParentGroup.setAttribute("transform","translate("+F+","+s+")");wb("canvasUpdated",{new_x:F,new_y:s,old_x:u,old_y:o,d_x:F-u,d_y:s-o});return{x:F,y:s,old_x:u,old_y:o,d_x:F-u,d_y:s-o}};this.setBackground=function(b,g){var d=svgedit.utilities.getElem("canvasBackground"),
u=$(d).find("rect")[0],o=svgedit.utilities.getElem("background_image");u.setAttribute("fill",b);if(g){if(!o){o=h.createElementNS(m.SVG,"image");svgedit.utilities.assignAttributes(o,{id:"background_image",width:"100%",height:"100%",preserveAspectRatio:"xMinYMin",style:"pointer-events:none"})}za(o,g);d.appendChild(o)}else o&&o.parentNode.removeChild(o)};this.cycleElement=function(b){var g=A[0],d=false,u=Nb(D||n().getCurrentLayer());if(u.length){if(g==null){b=b?u.length-1:0;d=u[b]}else for(var o=u.length;o--;)if(u[o]==
g){b=b?o-1:o+1;if(b>=u.length)b=0;else if(b<0)b=u.length-1;d=u[b];break}ab([d],true);ma("selected",A)}};this.clear();this.getPrivateMethods=function(){return{addCommandToHistory:qa,setGradient:Kb,addSvgElementFromJson:ga,assignAttributes:kb,BatchCommand:Bb,call:ma,ChangeElementCommand:rb,copyElem:xb,ffClone:Tb,findDefs:ia,findDuplicateGradient:cc,getElem:jb,getId:Xa,getIntersectionList:Sb,getMouseTarget:Ib,getNextId:La,getPathBBox:ib,getUrlFromAttr:ka,hasMatrixTransform:Ga,identifyLayers:zb,InsertElementCommand:Qa,
isIdentity:svgedit.math.isIdentity,logMatrix:Zb,matrixMultiply:Ba,MoveElementCommand:pa,preventClickDefault:nb,recalculateAllSelectedDimensions:Ub,recalculateDimensions:Qb,remapElement:gb,RemoveElementCommand:Za,removeUnusedDefElems:ac,round:Hb,runExtensions:wb,sanitizeSvg:qb,SVGEditTransformList:svgedit.transformlist.SVGTransformList,toString:toString,transformBox:svgedit.math.transformBox,transformListToTransform:oa,transformPoint:la,walkTree:svgedit.utilities.walkTree}}};(function(){if(!window.svgEditor)window.svgEditor=function(a){function G(n,p){var D=e.setSvgString(n)!==false;p=p||a.noop;D?p(true):a.alert(c.notification.errorLoadingSVG,function(){p(false)})}var e,m={},l=false,v={lang:"en",iconsize:"m",bkgd_color:"#FFF",bkgd_url:"",img_save:"embed"},f={},h={canvasName:"default",canvas_expansion:3,dimensions:[640,480],initFill:{color:"FF0000",opacity:1},initStroke:{width:5,color:"000000",opacity:1},initOpacity:1,imgPath:"images/",langPath:"locale/",extPath:"extensions/",
jGraduatePath:"jgraduate/images/",extensions:["ext-markers.js","ext-connector.js","ext-eyedropper.js","ext-shapes.js","ext-imagelib.js","ext-grid.js","ext-polygon.js","ext-star.js"],initTool:"select",wireframe:false,colorPickerCSS:null,gridSnapping:false,gridColor:"#000",baseUnit:"px",snappingStep:10,showRulers:true},c=m.uiStrings={common:{ok:"OK",cancel:"Cancel",key_up:"Up",key_down:"Down",key_backspace:"Backspace",key_del:"Del"},layers:{layer:"Layer"},notification:{invalidAttrValGiven:"Invalid value given",
noContentToFitTo:"No content to fit to",dupeLayerName:"There is already a layer named that!",enterUniqueLayerName:"Please enter a unique layer name",enterNewLayerName:"Please enter the new layer name",layerHasThatName:"Layer already has that name",QmoveElemsToLayer:"Move selected elements to layer '%s'?",QwantToClear:"Do you want to clear the drawing?\nThis will also erase your undo history!",QwantToOpen:"Do you want to open a new file?\nThis will also erase your undo history!",QerrorsRevertToSource:"There were parsing errors in your SVG source.\nRevert back to original SVG source?",
QignoreSourceChanges:"Ignore changes made to SVG source?",featNotSupported:"Feature not supported",enterNewImgURL:"Enter the new image URL",defsFailOnSave:"NOTE: Due to a bug in your browser, this image may appear wrong (missing gradients or elements). It will however appear correct once actually saved.",loadingImage:"Loading image, please wait...",saveFromBrowser:"Select 'Save As...' in your browser to save this image as a %s file.",noteTheseIssues:"Also note the following issues: ",unsavedChanges:"There are unsaved changes.",
enterNewLinkURL:"Enter the new hyperlink URL",errorLoadingSVG:"Error: Unable to load SVG data",URLloadFail:"Unable to load from URL",retrieving:"Retrieving '%s' ..."}},i={};m.curConfig=h;m.tool_scale=1;a.pref=function(n,p){if(p)f[n]=p;n="svg-edit-"+n;var D=location.hostname,P=D&&D.indexOf(".")>=0,L=p!=undefined,A=false;try{if(window.localStorage)A=localStorage}catch(ga){}try{if(window.globalStorage&&P)A=globalStorage[D]}catch(la){}if(A)if(L)A.setItem(n,p);else{if(A.getItem(n))return A.getItem(n)+
""}else if(window.widget)if(L)widget.setPreferenceForKey(p,n);else return widget.preferenceForKey(n);else if(L){D=new Date;D.setTime(D.getTime()+31536E6);p=encodeURIComponent(p);document.cookie=n+"="+p+"; expires="+D.toUTCString()}else return(D=document.cookie.match(RegExp(n+"=([^;]+)")))?decodeURIComponent(D[1]):""};m.setConfig=function(n){a.each(n,function(p,D){p in v&&a.pref(p,D)});a.extend(true,h,n);if(n.extensions)h.extensions=n.extensions};m.setCustomHandlers=function(n){m.ready(function(){if(n.open){a('#tool_open > input[type="file"]').remove();
a("#tool_open").show();e.open=n.open}if(n.save){m.showSaveWarning=false;e.bind("saved",n.save)}n.pngsave&&e.bind("exported",n.pngsave);i=n})};m.randomizeIds=function(){e.randomizeIds(arguments)};m.init=function(){function n(k,q){var E=k.id,I=E.split("_"),J=I[0];I=I[1];q&&e.setStrokeAttr("stroke-"+J,I);ub();N("#cur_"+J,E,20);a(k).addClass("current").siblings().removeClass("current")}function p(k,q){a.pref("bkgd_color",k);a.pref("bkgd_url",q);e.setBackground(k,q)}function D(){var k=e.getHref(pa);k=
k.indexOf("data:")===0?"":k;a.prompt(c.notification.enterNewImgURL,k,function(q){q&&eb(q)})}function P(){if(e.deleteCurrentLayer()){Ta();Va();a("#layerlist tr.layer").removeClass("layersel");a("#layerlist tr.layer:first").addClass("layersel")}}function L(){var k=e.getCurrentDrawing().getCurrentLayerName()+" copy";a.prompt(c.notification.enterUniqueLayerName,k,function(q){if(q)if(e.getCurrentDrawing().hasLayer(q))a.alert(c.notification.dupeLayerName);else{e.cloneLayer(q);Ta();Va()}})}function A(k){var q=
a("#layerlist tr.layersel").index(),E=e.getCurrentDrawing().getNumLayers();if(q>0||q<E-1){q+=k;e.setCurrentLayerPosition(E-q-1);Va()}}function ga(k,q){q||(q=e.getZoom());k||(k=a("#svgcanvas"));for(var E=e.getContentElem(),I=svgedit.units.getTypeMap()[h.baseUnit],J=0;J<2;J++){var U=J===0,X=U?"x":"y",ea=U?"width":"height",na=E.getAttribute(X)-0;X=a("#ruler_"+X+" canvas:first");var ca=X.clone();X.replaceWith(ca);var ja=ca[0];var Aa=X=k[ea]();ja.parentNode.style[ea]=Aa+"px";var Ma=0,V,xa=ja.getContext("2d");
xa.fillStyle="rgb(200,0,0)";xa.fillRect(0,0,ja.width,ja.height);ca.siblings().remove();if(X>=3E4){var ta=parseInt(X/3E4,10)+1;V=Array(ta);V[0]=xa;for(ca=1;ca<ta;ca++){ja[ea]=3E4;var ua=ja.cloneNode(true);ja.parentNode.appendChild(ua);V[ca]=ua.getContext("2d")}ua[ea]=X%3E4;X=3E4}ja[ea]=X;ea=I*q;var Ja=50/ea;ja=1;for(ca=0;ca<Xb.length;ca++){ja=ta=Xb[ca];if(Ja<=ta)break}Ja=ja*ea;xa.font="9px sans-serif";for(var Ka=na/ea%ja*ea,Na=Ka-Ja;Ka<Aa;Ka+=Ja){Na+=Ja;ca=Math.round(Ka)+0.5;if(U){xa.moveTo(ca,15);
xa.lineTo(ca,0)}else{xa.moveTo(15,ca);xa.lineTo(0,ca)}ta=(Na-na)/ea;if(ja>=1)ca=Math.round(ta);else{ca=(ja+"").split(".")[1].length;ca=ta.toFixed(ca)-0}if(ca!==0&&ca!==1E3&&ca%1E3===0)ca=ca/1E3+"K";if(U)xa.fillText(ca,Ka+2,8);else{ta=(ca+"").split("");for(ca=0;ca<ta.length;ca++)xa.fillText(ta[ca],1,Ka+9+ca*9)}ta=Ja/10;for(ca=1;ca<10;ca++){var Ea=Math.round(Ka+ta*ca)+0.5;if(V&&Ea>X){Ma++;xa.stroke();if(Ma>=V.length){ca=10;Ka=Aa;continue}xa=V[Ma];Ka-=3E4;Ea=Math.round(Ka+ta*ca)+0.5}var Wa=ca%2?12:10;
if(U){xa.moveTo(Ea,15);xa.lineTo(Ea,Wa)}else{xa.moveTo(15,Ea);xa.lineTo(Wa,Ea)}}}xa.strokeStyle="#000";xa.stroke()}}(function(){var k=window.opener;if(k)try{var q=k.document.createEvent("Event");q.initEvent("svgEditorReady",true,true);k.document.documentElement.dispatchEvent(q)}catch(E){}})();(function(){var k=a.deparam.querystring(true);if(a.isEmptyObject(k))(k=window.localStorage.getItem("svgedit-"+m.curConfig.canvasName))&&m.loadFromString(k);else{if(k.dimensions)k.dimensions=k.dimensions.split(",");
if(k.extensions)k.extensions=k.extensions.split(",");if(k.bkgd_color)k.bkgd_color="#"+k.bkgd_color;svgEditor.setConfig(k);var q=k.source,E=a.param.querystring();if(!q)if(E.indexOf("source=data:")>=0)q=E.match(/source=(data:[^&]*)/)[1];if(q)if(q.indexOf("data:")===0){q=q.replace(/ /g,"+");m.loadFromDataURI(q)}else m.loadFromString(q);else if(E.indexOf("paramurl=")!==-1)svgEditor.loadFromURL(E.substr(9));else k.url&&svgEditor.loadFromURL(k.url)}})();var la=function(){a.each(h.extensions,function(){var q=
this;a.getScript(h.extPath+q,function(E){if(!E){E=document.createElement("script");E.src=h.extPath+q;document.querySelector("head").appendChild(E)}})});var k=[];a("#lang_select option").each(function(){k.push(this.value)});m.putLocale(null,k)};document.location.protocol==="file:"?setTimeout(la,100):la();a.svgIcons(h.imgPath+"svg_edit_icons.svg",{w:24,h:24,id_match:false,no_img:!svgedit.browser.isWebkit(),fallback_path:h.imgPath,fallback:{new_image:"clear.png",save:"save.png",open:"open.png",source:"source.png",
docprops:"document-properties.png",wireframe:"wireframe.png",undo:"undo.png",redo:"redo.png",select:"select.png",select_node:"select_node.png",pencil:"fhpath.png",pen:"line.png",square:"square.png",rect:"rect.png",fh_rect:"freehand-square.png",circle:"circle.png",ellipse:"ellipse.png",fh_ellipse:"freehand-circle.png",path:"path.png",text:"text.png",image:"image.png",zoom:"zoom.png",clone:"clone.png",node_clone:"node_clone.png","delete":"delete.png",node_delete:"node_delete.png",group:"shape_group.png",
ungroup:"shape_ungroup.png",move_top:"move_top.png",move_bottom:"move_bottom.png",to_path:"to_path.png",link_controls:"link_controls.png",reorient:"reorient.png",align_left:"align-left.png",align_center:"align-center.png",align_right:"align-right.png",align_top:"align-top.png",align_middle:"align-middle.png",align_bottom:"align-bottom.png",go_up:"go-up.png",go_down:"go-down.png",ok:"save.png",cancel:"cancel.png",arrow_right:"flyouth.png",arrow_down:"dropdown.gif"},placement:{"#logo":"logo","#tool_clear div,#layer_new":"new_image",
"#tool_save div":"save","#tool_export div":"export","#tool_open div div":"open","#tool_import div div":"import","#tool_source":"source","#tool_docprops > div":"docprops","#tool_wireframe":"wireframe","#tool_undo":"undo","#tool_redo":"redo","#tool_select":"select","#tool_fhpath":"pencil","#tool_line":"pen","#tool_rect,#tools_rect_show":"rect","#tool_square":"square","#tool_fhrect":"fh_rect","#tool_ellipse,#tools_ellipse_show":"ellipse","#tool_circle":"circle","#tool_fhellipse":"fh_ellipse","#tool_path":"path",
"#tool_text,#layer_rename":"text","#tool_image":"image","#tool_zoom":"zoom","#tool_clone,#tool_clone_multi":"clone","#tool_node_clone":"node_clone","#layer_delete,#tool_delete,#tool_delete_multi":"delete","#tool_node_delete":"node_delete","#tool_add_subpath":"add_subpath","#tool_openclose_path":"open_path","#tool_move_top":"move_top","#tool_move_bottom":"move_bottom","#tool_topath":"to_path","#tool_node_link":"link_controls","#tool_reorient":"reorient","#tool_group":"group","#tool_ungroup":"ungroup",
"#tool_unlink_use":"unlink_use","#tool_alignleft, #tool_posleft":"align_left","#tool_aligncenter, #tool_poscenter":"align_center","#tool_alignright, #tool_posright":"align_right","#tool_aligntop, #tool_postop":"align_top","#tool_alignmiddle, #tool_posmiddle":"align_middle","#tool_alignbottom, #tool_posbottom":"align_bottom","#cur_position":"align","#linecap_butt,#cur_linecap":"linecap_butt","#linecap_round":"linecap_round","#linecap_square":"linecap_square","#linejoin_miter,#cur_linejoin":"linejoin_miter",
"#linejoin_round":"linejoin_round","#linejoin_bevel":"linejoin_bevel","#url_notice":"warning","#layer_up":"go_up","#layer_down":"go_down","#layer_moreopts":"context_menu","#layerlist td.layervis":"eye","#tool_source_save,#tool_docprops_save,#tool_prefs_save":"ok","#tool_source_cancel,#tool_docprops_cancel,#tool_prefs_cancel":"cancel","#rwidthLabel, #iwidthLabel":"width","#rheightLabel, #iheightLabel":"height","#cornerRadiusLabel span":"c_radius","#angleLabel":"angle","#linkLabel,#tool_make_link,#tool_make_link_multi":"globe_link",
"#zoomLabel":"zoom","#tool_fill label":"fill","#tool_stroke .icon_label":"stroke","#group_opacityLabel":"opacity","#blurLabel":"blur","#font_sizeLabel":"fontsize",".flyout_arrow_horiz":"arrow_right",".dropdown button, #main_button .dropdown":"arrow_down","#palette .palette_item:first, #fill_bg, #stroke_bg":"no_color"},resize:{"#logo .svg_icon":28,".flyout_arrow_horiz .svg_icon":5,".layer_button .svg_icon, #layerlist td.layervis .svg_icon":14,".dropdown button .svg_icon":7,"#main_button .dropdown .svg_icon":9,
".palette_item:first .svg_icon":15,"#fill_bg .svg_icon, #stroke_bg .svg_icon":16,".toolbar_button button .svg_icon":16,".stroke_tool div div .svg_icon":20,"#tools_bottom label .svg_icon":18},callback:function(){a(".toolbar_button button > svg, .toolbar_button button > img").each(function(){a(this).parent().prepend(this)});var k=a("#tools_left");if(k.length!==0){k.offset();k.outerHeight()}a(".tools_flyout").each(function(){var q=a("#"+this.id+"_show"),E=q.attr("data-curopt");if(!q.children("svg, img").length){E=
a(E).children().clone();if(E.length){E[0].removeAttribute("style");q.append(E)}}});svgEditor.runCallbacks();setTimeout(function(){a(".flyout_arrow_horiz:empty").each(function(){a(this).append(a.getSvgIcon("arrow_right").width(5).height(5))})},1)}});m.canvas=e=new a.SvgCanvas(document.getElementById("svgcanvas"),h);m.showSaveWarning=false;var Ba=svgedit.browser.isMac()?"meta+":"ctrl+",Ga=e.pathActions,oa=e.undoMgr,ia=svgedit.utilities,ka=h.imgPath+"logo.png",da=a("#workarea"),za=a("#cmenu_canvas");
a("#cmenu_layers");var ib=null,jb=1,kb="crosshair",db="crosshair",gb="toolbars",Qb="",Fa={fill:null,stroke:null};(function(){a("#dialog_container").draggable({cancel:"#dialog_content, #dialog_buttons *",containment:"window"});var k=a("#dialog_box"),q=a("#dialog_buttons"),E=function(I,J,U,X){a("#dialog_content").html("<p>"+J.replace(/\n/g,"</p><p>")+"</p>").toggleClass("prompt",I=="prompt");q.empty();var ea=a('<input type="button" value="'+c.common.ok+'">').appendTo(q);I!="alert"&&a('<input type="button" value="'+
c.common.cancel+'">').appendTo(q).click(function(){k.hide();U(false)});if(I=="prompt"){var na=a('<input type="text">').prependTo(q);na.val(X||"");na.bind("keydown","return",function(){ea.click()})}I=="process"&&ea.hide();k.show();ea.click(function(){k.hide();var ca=I=="prompt"?na.val():true;U&&U(ca)}).focus();I=="prompt"&&na.focus()};a.alert=function(I,J){E("alert",I,J)};a.confirm=function(I,J){E("confirm",I,J)};a.process_cancel=function(I,J){E("process",I,J)};a.prompt=function(I,J,U){E("prompt",
I,U,J)}})();var qb=function(){var k=a(".tool_button_current");if(k.length&&k[0].id!=="tool_select"){k.removeClass("tool_button_current").addClass("tool_button");a("#tool_select").addClass("tool_button_current").removeClass("tool_button");a("#styleoverrides").text("#svgcanvas svg *{cursor:move;pointer-events:all} #svgcanvas svg{cursor:default}")}e.setMode("select");da.css("cursor","auto")},pa=null,Qa=false,Za=false,rb=false,Bb=false,qa="",va=a("title:first").text(),lb=e.zoomChanged=function(k,q,E){e.getResolution();
a("#svgcanvas").position();if(q=e.setBBoxZoom(q,da.width()-15,da.height()-15)){k=q.zoom;q=q.bbox;if(k<0.001)mb({value:0.1});else{a("#zoom").val((k*100).toFixed(1));E?pb():pb(false,{x:q.x*k+q.width*k/2,y:q.y*k+q.height*k/2});e.getMode()=="zoom"&&q.width&&qb();H()}}};a("#cur_context_panel").delegate("a","click",function(){var k=a(this);k.attr("data-root")?e.leaveContext():e.setContext(k.text());e.clearSelection();return false});var Lb={},Cb=function(k){a.each(k,function(q,E){var I=a(q).children(),J=
q+"_show",U=a(J),X=false;I.addClass("tool_button").unbind("click mousedown mouseup").each(function(ca){var ja=E[ca];Lb[ja.sel]=ja.fn;if(ja.isDefault)X=ca;ca=function(Aa){var Ma=ja;if(Aa.type==="keydown"){var V=a(Ma.parent+"_show").hasClass("tool_button_current"),xa=a(Ma.parent+"_show").attr("data-curopt");a.each(k[ja.parent],function(ua,Ja){if(Ja.sel==xa)Ma=!Aa.shiftKey||!V?Ja:k[ja.parent][ua+1]||k[ja.parent][0]})}if(a(this).hasClass("disabled"))return false;Ia(J)&&Ma.fn();var ta=Ma.icon?a.getSvgIcon(Ma.icon,
true):a(Ma.sel).children().eq(0).clone();ta[0].setAttribute("width",U.width());ta[0].setAttribute("height",U.height());U.children(":not(.flyout_arrow_horiz)").remove();U.append(ta).attr("data-curopt",Ma.sel)};a(this).mouseup(ca);ja.key&&a(document).bind("keydown",ja.key[0]+" shift+"+ja.key[0],ca)});if(X)U.attr("data-curopt",E[X].sel);else U.attr("data-curopt")||U.attr("data-curopt",E[0].sel);var ea,na=a(J).position();U.mousedown(function(ca){if(U.hasClass("disabled"))return false;var ja=a(q),Aa=na.left+
34,Ma=ja.width()*-1,V=ja.data("shown_popop")?200:0;ea=setTimeout(function(){U.data("isLibrary")?ja.css("left",Aa).show():ja.css("left",Ma).show().animate({left:Aa},150);ja.data("shown_popop",true)},V);ca.preventDefault()}).mouseup(function(){clearTimeout(ea);var ca=a(this).attr("data-curopt");if(U.data("isLibrary")&&a(J.replace("_show","")).is(":visible"))Ia(J,true);else Ia(J)&&ca in Lb&&Lb[ca]()})});Fb();sb()},Db=function(k,q){return a("<div>",{"class":"tools_flyout",id:k}).appendTo("#svg_editor").append(q)},
sb=function(){a(".tools_flyout").each(function(){var k=a("#"+this.id+"_show"),q=k.offset();k=k.outerWidth();a(this).css({left:(q.left+k)*jb,top:q.top})})},Fb=function(){a(".tools_flyout").each(function(){var k=a("#"+this.id+"_show");if(!k.data("isLibrary")){var q=[];a(this).children().each(function(){q.push(this.title)});k[0].title=q.join(" / ")}})},tb,Mb=function(k,q,E){q={alpha:q};if(k.indexOf("url(#")===0){k=(k=e.getRefElem(k))?k.cloneNode(true):a("#"+E+"_color defs *")[0];q[k.tagName]=k}else q.solidColor=
k.indexOf("#")===0?k.substr(1):"none";return new a.jGraduate.Paint(q)},eb=m.setImageURL=function(k){k||(k=ka);e.setImageURL(k);a("#image_url").val(k);if(k.indexOf("data:")===0){a("#image_url").hide();a("#change_image_url").show()}else{e.embedImage(k,function(q){a("#url_notice").toggle(!q);ka=k});a("#image_url").show();a("#change_image_url").hide()}},Ha=function(k){var q=Math.min(Math.max(12+k.value.length*6,50),300);a(k).width(q)},Ta=function(){var k=pa;if(k!=null&&!k.parentNode)k=null;var q=e.getCurrentDrawing().getCurrentLayerName(),
E=e.getMode(),I=h.baseUnit!=="px"?h.baseUnit:null,J=E=="pathedit",U=a("#cmenu_canvas li");a("#selected_panel, #multiselected_panel, #g_panel, #rect_panel, #circle_panel,\t\t\t\t\t#ellipse_panel, #line_panel, #text_panel, #image_panel, #container_panel, #use_panel, #a_panel").hide();if(k!=null){var X=k.nodeName,ea=e.getRotationAngle(k);a("#angle").val(ea);var na=e.getBlur(k);a("#blur").val(na);a("#blur_slider").slider("option","value",na);e.addedNew&&X==="image"&&e.getHref(k).indexOf("data:")!==0&&
D();if(!J&&E!="pathedit"){a("#selected_panel").show();if(["line","circle","ellipse"].indexOf(X)>=0)a("#xy_panel").hide();else{var ca,ja;if(["g","polyline","path"].indexOf(X)>=0){if(E=e.getStrokedBBox([k])){ca=E.x;ja=E.y}}else{ca=k.getAttribute("x");ja=k.getAttribute("y")}if(I){ca=svgedit.units.convertUnit(ca);ja=svgedit.units.convertUnit(ja)}a("#selected_x").val(ca||0);a("#selected_y").val(ja||0);a("#xy_panel").show()}I=["image","text","path","g","use"].indexOf(X)==-1;a("#tool_topath").toggle(I);
a("#tool_reorient").toggle(X==="path");a("#tool_reorient").toggleClass("disabled",ea===0)}else{q=Ga.getNodePoint();a("#tool_add_subpath").removeClass("push_button_pressed").addClass("tool_button");a("#tool_node_delete").toggleClass("disabled",!Ga.canDeleteNodes);N("#tool_openclose_path",Ga.closed_subpath?"open_path":"close_path");if(q){J=a("#seg_type");if(I){q.x=svgedit.units.convertUnit(q.x);q.y=svgedit.units.convertUnit(q.y)}a("#path_node_x").val(q.x);a("#path_node_y").val(q.y);q.type?J.val(q.type).removeAttr("disabled"):
J.val(4).attr("disabled","disabled")}return}I={g:[],a:[],rect:["rx","width","height"],image:["width","height"],circle:["cx","cy","r"],ellipse:["cx","cy","rx","ry"],line:["x1","y1","x2","y2"],text:[],use:[]};var Aa=k.tagName;X=null;if(Aa==="a"){X=e.getHref(k);a("#g_panel").show()}if(k.parentNode.tagName==="a")if(!a(k).siblings().length){a("#a_panel").show();X=e.getHref(k.parentNode)}a("#tool_make_link, #tool_make_link").toggle(!X);X&&a("#link_url").val(X);if(I[Aa]){I=I[Aa];a("#"+Aa+"_panel").show();
a.each(I,function(Ma,V){var xa=k.getAttribute(V);if(h.baseUnit!=="px"&&k[V])xa=svgedit.units.convertUnit(k[V].baseVal.value);a("#"+Aa+"_"+V).val(xa||0)});if(Aa=="text"){a("#text_panel").css("display","inline");e.getItalic()?a("#tool_italic").addClass("push_button_pressed").removeClass("tool_button"):a("#tool_italic").removeClass("push_button_pressed").addClass("tool_button");e.getBold()?a("#tool_bold").addClass("push_button_pressed").removeClass("tool_button"):a("#tool_bold").removeClass("push_button_pressed").addClass("tool_button");
a("#font_family").val(k.getAttribute("font-family"));a("#font_size").val(k.getAttribute("font-size"));a("#text").val(k.textContent);e.addedNew&&setTimeout(function(){a("#text").focus().select()},100)}else if(Aa=="image")eb(e.getHref(k));else if(Aa==="g"||Aa==="use"){a("#container_panel").show();I=e.getTitle();X=a("#g_title")[0];X.value=I;Ha(X);X.prop("disabled",Aa=="use")}}U[(Aa==="g"?"en":"dis")+"ableContextMenuItems"]("#ungroup");U[(Aa==="g"||!Qa?"dis":"en")+"ableContextMenuItems"]("#group")}else if(Qa){a("#multiselected_panel").show();
U.enableContextMenuItems("#group").disableContextMenuItems("#ungroup")}else U.disableContextMenuItems("#delete,#cut,#copy,#group,#ungroup,#move_front,#move_up,#move_down,#move_back");a("#tool_undo").toggleClass("disabled",oa.getUndoStackSize()===0);a("#tool_redo").toggleClass("disabled",oa.getRedoStackSize()===0);e.addedNew=false;if(k&&!J||Qa){a("#selLayerNames").removeAttr("disabled").val(q);za.enableContextMenuItems("#delete,#cut,#copy,#move_front,#move_up,#move_down,#move_back")}else a("#selLayerNames").attr("disabled",
"disabled")};a("#text").focus(function(){});a("#text").blur(function(){});e.bind("selected",function(k,q){var E=e.getMode();E==="select"&&qb();E=E=="pathedit";pa=q.length===1||q[1]==null?q[0]:null;Qa=q.length>=2&&q[1]!=null;if(pa!=null)if(!E){if(pa!=null)switch(pa.tagName){case "use":case "image":case "foreignObject":break;case "g":case "a":for(var I=null,J=pa.getElementsByTagName("*"),U=0,X=J.length;U<X;U++){var ea=J[U].getAttribute("stroke-width");if(U===0)I=ea;else if(I!==ea)I=null}a("#stroke_width").val(I===
null?"":I);Fa.fill.update(true);Fa.stroke.update(true);break;default:Fa.fill.update(true);Fa.stroke.update(true);a("#stroke_width").val(pa.getAttribute("stroke-width")||1);a("#stroke_style").val(pa.getAttribute("stroke-dasharray")||"none");I=pa.getAttribute("stroke-linejoin")||"miter";a("#linejoin_"+I).length!=0&&n(a("#linejoin_"+I)[0]);I=pa.getAttribute("stroke-linecap")||"butt";a("#linecap_"+I).length!=0&&n(a("#linecap_"+I)[0])}if(pa!=null){I=(pa.getAttribute("opacity")||1)*100;a("#group_opacity").val(I);
a("#opac_slider").slider("option","value",I);a("#elem_id").val(pa.id)}hb()}a("#path_node_panel").toggle(E);a("#tools_bottom_2,#tools_bottom_3").toggle(!E);if(E){a(".tool_button_current").removeClass("tool_button_current").addClass("tool_button");a("#tool_select").addClass("tool_button_current").removeClass("tool_button");N("#tool_select","select_node");Qa=false;if(q.length)pa=q[0]}else N("#tool_select","select");Ta();e.runExtensions("selectedChanged",{elems:q,selectedElement:pa,multiselected:Qa})});
e.bind("transition",function(k,q){var E=e.getMode(),I=q[0];if(I){Qa=q.length>=2&&q[1]!=null;if(!Qa)switch(E){case "rotate":E=e.getRotationAngle(I);a("#angle").val(E);a("#tool_reorient").toggleClass("disabled",E===0)}e.runExtensions("elementTransition",{elems:q})}});e.bind("changed",function(k,q){var E=e.getMode();E==="select"&&qb();for(var I=0;I<q.length;++I){var J=q[I];if(J&&J.tagName==="svg"){Va();pb()}else if(J&&pa&&pa.parentNode==null)pa=J}m.showSaveWarning=true;Ta();if(pa&&E==="select"){Fa.fill.update();
Fa.stroke.update()}e.runExtensions("elementChanged",{elems:q})});e.bind("saved",function(k,q){m.showSaveWarning=false;q='<?xml version="1.0"?>\n'+q;if(svgedit.browser.isIE())z(0,true);else{var E=k.open("data:image/svg+xml;base64,"+ia.encode64(q)),I=a.pref("save_notice_done");if(I!=="all"){var J=c.notification.saveFromBrowser.replace("%s","SVG");if(svgedit.browser.isGecko())if(q.indexOf("<defs")!==-1){J+="\n\n"+c.notification.defsFailOnSave;a.pref("save_notice_done","all");I="all"}else a.pref("save_notice_done",
"part");else a.pref("save_notice_done","all");I!=="part"&&E.alert(J)}}});e.bind("exported",function(k,q){var E=q.issues;a("#export_canvas").length||a("<canvas>",{id:"export_canvas"}).hide().appendTo("body");var I=a("#export_canvas")[0];I.width=e.contentW;I.height=e.contentH;canvg(I,q.svg,{renderCallback:function(){var J=I.toDataURL("image/png");ib.location.href=J;if(a.pref("export_notice_done")!=="all"){J=c.notification.saveFromBrowser.replace("%s","PNG");if(E.length)J+="\n\n"+c.notification.noteTheseIssues+
"\n \u2022 "+E.join("\n \u2022 ");a.pref("export_notice_done","all");ib.alert(J)}}})});e.bind("zoomed",lb);e.bind("contextset",function(k,q){var E="";if(q){var I="";E='<a href="#" data-root="y">'+e.getCurrentDrawing().getCurrentLayerName()+"</a>";a(q).parentsUntil("#svgcontent > g").andSelf().each(function(){if(this.id){I+=" > "+this.id;E+=this!==q?' > <a href="#">'+this.id+"</a>":" > "+this.id}});qa=I}else qa=null;a("#cur_context_panel").toggle(!!q).html(E);S()});e.bind("extension_added",function(k,
q){function E(){if(tb){clearTimeout(tb);tb=null}J||(tb=setTimeout(function(){J=true;R(f.iconsize)},50))}var I=false,J=false,U=true,X=function(){if(q.callback&&!I&&U){I=true;q.callback()}},ea=[];q.context_tools&&a.each(q.context_tools,function(Ma,V){var xa=V.container_id?' id="'+V.container_id+'"':"",ta=a("#"+V.panel);ta.length||(ta=a("<div>",{id:V.panel}).appendTo("#tools_top"));switch(V.type){case "tool_button":var ua='<div class="tool_button">'+V.id+"</div>",Ja=a(ua).appendTo(ta);V.events&&a.each(V.events,
function(Ea,Wa){a(Ja).bind(Ea,Wa)});break;case "select":ua="<label"+xa+'><select id="'+V.id+'">';a.each(V.options,function(Ea,Wa){ua+='<option value="'+Ea+'"'+(Ea==V.defval?" selected":"")+">"+Wa+"</option>"});ua+="</select></label>";var Ka=a(ua).appendTo(ta).find("select");a.each(V.events,function(Ea,Wa){a(Ka).bind(Ea,Wa)});break;case "button-select":ua='<div id="'+V.id+'" class="dropdown toolset" title="'+V.title+'"><div id="cur_'+V.id+'" class="icon_label"></div><button></button></div>';xa=a('<ul id="'+
V.id+'_opts"></ul>').appendTo("#option_lists");V.colnum&&xa.addClass("optcols"+V.colnum);a(ua).appendTo(ta).children();ea.push({elem:"#"+V.id,list:"#"+V.id+"_opts",title:V.title,callback:V.events.change,cur:"#cur_"+V.id});break;case "input":ua="<label"+xa+'><span id="'+V.id+'_label">'+V.label+':</span><input id="'+V.id+'" title="'+V.title+'" size="'+(V.size||"4")+'" value="'+(V.defval||"")+'" type="text"/></label>';var Na=a(ua).appendTo(ta).find("input");V.spindata&&Na.SpinButton(V.spindata);V.events&&
a.each(V.events,function(Ea,Wa){Na.bind(Ea,Wa)})}});if(q.buttons){var na={},ca={},ja=q.svgicons,Aa={};a.each(q.buttons,function(Ma,V){for(var xa,ta=V.id,ua=Ma;a("#"+ta).length;)ta=V.id+"_"+ ++ua;if(ja){na[ta]=V.icon;ua=V.svgicon?V.svgicon:V.id;if(V.type=="app_menu")ca["#"+ta+" > div"]=ua;else ca["#"+ta]=ua}else xa=a('<img src="'+V.icon+'">');var Ja,Ka;switch(V.type){case "mode_flyout":case "mode":Ja="tool_button";Ka="#tools_left";break;case "context":Ja="tool_button";Ka="#"+V.panel;a(Ka).length||
a("<div>",{id:V.panel}).appendTo("#tools_top");break;case "app_menu":Ja="";Ka="#main_menu ul"}var Na=a(V.list||V.type=="app_menu"?"<li/>":"<div/>").attr("id",ta).attr("title",V.title).addClass(Ja);if(!V.includeWith&&!V.list){"position"in V?a(Ka).children().eq(V.position).before(Na):Na.appendTo(Ka);if(V.type=="mode_flyout"){ua=a(Na);Ja=ua.parent();if(!ua.parent().hasClass("tools_flyout")){var Ea=ua[0].id.replace("tool_","tools_"),Wa=ua.clone().attr("id",Ea+"_show").append(a("<div>",{"class":"flyout_arrow_horiz"}));
ua.before(Wa);Ja=Db(Ea,ua);Ja.data("isLibrary",true);Wa.data("isLibrary",true)}ca["#"+Ea+"_show"]=V.id;ta=Aa["#"+Ja[0].id]=[{sel:"#"+ta,fn:V.events.click,icon:V.id,isDefault:true},dc]}else V.type=="app_menu"&&Na.append("<div>").append(V.title)}else if(V.list){Na.addClass("push_button");a("#"+V.list+"_opts").append(Na);if(V.isDefault){a("#cur_"+V.list).append(Na.children().clone());ua=V.svgicon?V.svgicon:V.id;ca["#cur_"+V.list]=ua}}else if(V.includeWith){Ka=V.includeWith;ua=a(Ka.button);Ja=ua.parent();
if(!ua.parent().hasClass("tools_flyout")){Ea=ua[0].id.replace("tool_","tools_");Wa=ua.clone().attr("id",Ea+"_show").append(a("<div>",{"class":"flyout_arrow_horiz"}));ua.before(Wa);Ja=Db(Ea,ua)}var dc=jc.getButtonData(Ka.button);if(Ka.isDefault)ca["#"+Ea+"_show"]=V.id;ta=Aa["#"+Ja[0].id]=[{sel:"#"+ta,fn:V.events.click,icon:V.id,key:V.key,isDefault:V.includeWith?V.includeWith.isDefault:0},dc];Ea="position"in Ka?Ka.position:"last";dc=Ja.children().length;if(!isNaN(Ea)&&Ea>=0&&Ea<dc)Ja.children().eq(Ea).before(Na);
else{Ja.append(Na);ta.reverse()}}ja||Na.append(xa);V.list||a.each(V.events,function(ec,fc){if(ec=="click"&&V.type=="mode"){V.includeWith?Na.bind(ec,fc):Na.bind(ec,function(){Ia(Na)&&fc()});if(V.key){a(document).bind("keydown",V.key,fc);V.title&&Na.attr("title",V.title+" ["+V.key+"]")}}else Na.bind(ec,fc)});Cb(Aa)});a.each(ea,function(){vb(this.elem,this.list,this.callback,{seticon:true})});if(ja)U=false;a.svgIcons(ja,{w:24,h:24,id_match:false,no_img:!svgedit.browser.isWebkit(),fallback:na,placement:ca,
callback:function(){f.iconsize&&f.iconsize!="m"&&E();U=true;X()}})}X()});e.textActions.setInputElem(a("#text")[0]);var ra='<div class="palette_item" data-rgb="none"></div>';a.each(["#000000","#3f3f3f","#7f7f7f","#bfbfbf","#ffffff","#ff0000","#ff7f00","#ffff00","#7fff00","#00ff00","#00ff7f","#00ffff","#007fff","#0000ff","#7f00ff","#ff00ff","#ff007f","#7f0000","#7f3f00","#7f7f00","#3f7f00","#007f00","#007f3f","#007f7f","#003f7f","#00007f","#3f007f","#7f007f","#7f003f","#ffaaaa","#ffd4aa","#ffffaa",
"#d4ffaa","#aaffaa","#aaffd4","#aaffff","#aad4ff","#aaaaff","#d4aaff","#ffaaff","#ffaad4"],function(k,q){ra+='<div class="palette_item" style="background-color: '+q+';" data-rgb="'+q+'"></div>'});a("#palette").append(ra);ra="";a.each(["#FFF","#888","#000"],function(){ra+='<div class="color_block" style="background-color:'+this+';"></div>'});a("#bg_blocks").append(ra);var $a=a("#bg_blocks div");$a.each(function(){a(this).click(function(){$a.removeClass("cur_background");a(this).addClass("cur_background")})});
if(a.pref("bkgd_color"))p(a.pref("bkgd_color"),a.pref("bkgd_url"));else a.pref("bkgd_url")&&p(v.bkgd_color,a.pref("bkgd_url"));if(a.pref("img_save")){f.img_save=a.pref("img_save");a("#image_save_opts input").val([f.img_save])}var mb=function(k){var q=k.value/100;if(q<0.001)k.value=0.1;else{k=e.getZoom();lb(window,{width:0,height:0,x:(da[0].scrollLeft+da.width()/2)/k,y:(da[0].scrollTop+da.height()/2)/k,zoom:q},true)}},Ua=function(k,q){if(q==null)q=k.value;a("#group_opacity").val(q);if(!k||!k.handle)a("#opac_slider").slider("option",
"value",q);e.setOpacity(q/100)},Oa=function(k,q,E){if(q==null)q=k.value;a("#blur").val(q);var I=false;if(!k||!k.handle){a("#blur_slider").slider("option","value",q);I=true}E?e.setBlurNoUndo(q):e.setBlur(q,I)},ub=function(){window.opera&&a("<p/>").hide().appendTo("body").remove()};a("#stroke_style").change(function(){e.setStrokeAttr("stroke-dasharray",a(this).val());ub()});a("#stroke_linejoin").change(function(){e.setStrokeAttr("stroke-linejoin",a(this).val());ub()});a("select").change(function(){a(this).blur()});
var Ca=false;a("#selLayerNames").change(function(){var k=this.options[this.selectedIndex].value,q=c.notification.QmoveElemsToLayer.replace("%s",k),E=function(I){if(I){Ca=true;e.moveSelectedToLayer(k);e.clearSelection();Va()}};if(k)Ca?E(true):a.confirm(q,E)});a("#font_family").change(function(){e.setFontFamily(this.value)});a("#seg_type").change(function(){e.setSegType(a(this).val())});a("#text").keyup(function(){e.setTextContent(this.value)});a("#image_url").change(function(){eb(this.value)});a("#link_url").change(function(){this.value.length?
e.setLinkURL(this.value):e.removeHyperlink()});a("#g_title").change(function(){e.setGroupTitle(this.value)});a(".attr_changer").change(function(){var k=this.getAttribute("data-attr"),q=this.value;if(!svgedit.units.isValidUnit(k,q,pa)){a.alert(c.notification.invalidAttrValGiven);this.value=pa.getAttribute(k);return false}if(k!=="id")if(isNaN(q))q=e.convertToNum(k,q);else if(h.baseUnit!=="px"){var E=svgedit.units.getTypeMap();if(pa[k]||e.getMode()==="pathedit"||k==="x"||k==="y")q*=E[h.baseUnit]}if(k===
"id"){k=pa;e.clearSelection();k.id=q;e.addToSelection([k],true)}else e.changeSelectedAttribute(k,q);this.blur()});a("#palette").mouseover(function(){var k=a('<input type="hidden">');a(this).append(k);k.focus().remove()});a(".palette_item").mousedown(function(k){k=k.shiftKey||k.button===2?"stroke":"fill";var q=a(this).data("rgb"),E;if(q==="none"||q==="transparent"||q==="initial"){q="none";E=new a.jGraduate.Paint}else E=new a.jGraduate.Paint({alpha:100,solidColor:q.substr(1)});Fa[k].setPaint(E);e.setColor(k,
q);q!=="none"&&e.getPaintOpacity(k)!==1&&e.setPaintOpacity(k,1);hb()}).bind("contextmenu",function(k){k.preventDefault()});a("#toggle_stroke_tools").on("click",function(){a("#tools_bottom").toggleClass("expanded")});var Ia=function(k,q){if(a(k).hasClass("disabled"))return false;if(a(k).parent().hasClass("tools_flyout"))return true;var E=E||"normal";q||a(".tools_flyout").fadeOut(E);a("#styleoverrides").text("");da.css("cursor","auto");a(".tool_button_current").removeClass("tool_button_current").addClass("tool_button");
a(k).addClass("tool_button_current").removeClass("tool_button");return true};(function(){var k=null,q=null,E=da[0],I=false,J=false;a("#svgcanvas").bind("mousemove mouseup",function(U){if(I!==false){E.scrollLeft-=U.clientX-k;E.scrollTop-=U.clientY-q;k=U.clientX;q=U.clientY;if(U.type==="mouseup")I=false;return false}}).mousedown(function(U){if(U.button===1||J===true){I=true;k=U.clientX;q=U.clientY;return false}});a(window).mouseup(function(){I=false});a(document).bind("keydown","space",function(U){e.spaceKey=
J=true;U.preventDefault()}).bind("keyup","space",function(U){U.preventDefault();e.spaceKey=J=false}).bind("keydown","shift",function(){e.getMode()==="zoom"&&da.css("cursor",db)}).bind("keyup","shift",function(){e.getMode()==="zoom"&&da.css("cursor",kb)});m.setPanning=function(U){e.spaceKey=J=U}})();(function(){var k=a("#main_icon"),q=a("#main_icon span"),E=a("#main_menu"),I=false,J=0,U=true,X=false;a(window).mouseup(function(na){if(!I){k.removeClass("buttondown");if(na.target.tagName!="INPUT")E.fadeOut(200);
else if(!X){X=true;a(na.target).click(function(){E.css("margin-left","-9999px").show()})}}I=false}).mousedown(function(na){a(na.target).closest("div.tools_flyout, .contextMenu").length||a(".tools_flyout:visible,.contextMenu").fadeOut(250)});q.bind("mousedown",function(){if(k.hasClass("buttondown"))E.fadeOut(200);else{E.css("margin-left",0).show();J||(J=E.height());E.css("height",0).animate({height:J},200);I=true}k.toggleClass("buttondown buttonup")}).hover(function(){I=true}).mouseout(function(){I=
false});var ea=a("#main_menu li");ea.mouseover(function(){U=a(this).css("background-color")=="rgba(0, 0, 0, 0)";ea.unbind("mouseover");U&&ea.mouseover(function(){this.style.backgroundColor="#FFC"}).mouseout(function(){this.style.backgroundColor="transparent";return true})})})();m.addDropDown=function(k,q,E){if(a(k).length!=0){var I=a(k).find("button"),J=a(k).find("ul").attr("id",a(k)[0].id+"-list"),U=false;E?a(k).addClass("dropup"):a("#option_lists").append(J);J.find("li").bind("mouseup",q);a(window).mouseup(function(){if(!U){I.removeClass("down");
J.hide()}U=false});I.bind("mousedown",function(){if(I.hasClass("down"))J.hide();else{if(!E){var X=a(k).position();J.css({top:X.top+24,left:X.left-10})}J.show();U=true}I.toggleClass("down")}).hover(function(){U=true}).mouseout(function(){U=false})}};var vb=function(k,q,E,I){var J=a(k);q=a(q);var U=false,X=I.dropUp;X&&a(k).addClass("dropup");q.find("li").bind("mouseup",function(){if(I.seticon){N("#cur_"+J[0].id,a(this).children());a(this).addClass("current").siblings().removeClass("current")}E.apply(this,
arguments)});a(window).mouseup(function(){if(!U){J.removeClass("down");q.hide();q.css({top:0,left:0})}U=false});q.height();J.bind("mousedown",function(){var ea=J.offset();if(X){ea.top-=q.height();ea.left+=8}else ea.top+=J.height();q.offset(ea);if(J.hasClass("down")){q.hide();q.css({top:0,left:0})}else{q.show();U=true}J.toggleClass("down")}).hover(function(){U=true}).mouseout(function(){U=false});I.multiclick&&q.mousedown(function(){U=true})};m.addDropDown("#font_family_dropdown",function(){a("#font_family").val(a(this).text()).change()});
m.addDropDown("#opacity_dropdown",function(){if(!a(this).find("div").length){var k=parseInt(a(this).text().split("%")[0]);Ua(false,k)}},true);a("#opac_slider").slider({start:function(){a("#opacity_dropdown li:not(.special)").hide()},stop:function(){a("#opacity_dropdown li").show();a(window).mouseup()},slide:function(k,q){Ua(q)}});m.addDropDown("#blur_dropdown",a.noop);var Gb=false;a("#blur_slider").slider({max:10,step:0.1,stop:function(k,q){Gb=false;Oa(q);a("#blur_dropdown li").show();a(window).mouseup()},
start:function(){Gb=true},slide:function(k,q){Oa(q,null,Gb)}});m.addDropDown("#zoom_dropdown",function(){var k=a(this),q=k.data("val");q?lb(window,q):mb({value:parseInt(k.text(),10)})},true);vb("#stroke_linecap","#linecap_opts",function(){n(this,true)},{dropUp:true});vb("#stroke_linejoin","#linejoin_opts",function(){n(this,true)},{dropUp:true});vb("#tool_position","#position_opts",function(){var k=this.id.replace("tool_pos","").charAt(0);e.alignSelectedElements(k,"page")},{multiclick:true});(function(){var k,
q=function(){a(k).blur()};a("#svg_editor").find("button, select, input:not(#text)").focus(function(){k=this;gb="toolbars";da.mousedown(q)}).blur(function(){gb="canvas";da.unbind("mousedown",q);e.getMode()=="textedit"&&a("#text").focus()})})();var Eb=function(){if(Ia("#tool_select")){e.setMode("select");a("#styleoverrides").text("#svgcanvas svg *{cursor:move;pointer-events:all}, #svgcanvas svg{cursor:default}")}},wb=function(){Ia("#tool_fhpath")&&e.setMode("fhpath")},Hb=function(){Ia("#tool_line")&&
e.setMode("line")},Sb=function(){Ia("#tool_square")&&e.setMode("square")},Nb=function(){Ia("#tool_rect")&&e.setMode("rect")},hc=function(){Ia("#tool_fhrect")&&e.setMode("fhrect")},Yb=function(){Ia("#tool_circle")&&e.setMode("circle")},xb=function(){Ia("#tool_ellipse")&&e.setMode("ellipse")},Xa=function(){Ia("#tool_fhellipse")&&e.setMode("fhellipse")},La=function(){Ia("#tool_image")&&e.setMode("image")},ma=function(){if(Ia("#tool_zoom")){e.setMode("zoom");da.css("cursor",kb)}},Tb=function(){if(Ia("#tool_zoom")){w();
qb()}},Ub=function(){Ia("#tool_text")&&e.setMode("text")},ic=function(){Ia("#tool_path")&&e.setMode("path")},Zb=function(){if(pa!=null||Qa)e.deleteSelectedElements()},fb=function(){if(pa!=null||Qa)e.cutSelectedElements()},Da=function(){if(pa!=null||Qa)e.copySelectedElements()},Ya=function(){var k=e.getZoom(),q=(da[0].scrollLeft+da.width()/2)/k-e.contentW;k=(da[0].scrollTop+da.height()/2)/k-e.contentH;e.pasteElements("point",q,k)},ab=function(){pa!=null&&e.moveToTopSelectedElement()},Ib=function(){pa!=
null&&e.moveToBottomSelectedElement()},nb=function(k){pa!=null&&e.moveUpDownSelected(k)},Pa=function(){pa!=null&&e.convertToPath()},sa=function(){pa!=null&&Ga.reorient()},ac=function(){if(pa!=null||Qa)a.prompt(c.notification.enterNewLinkURL,"http://",function(k){k&&e.makeHyperlink(k)})},cb=function(k,q){if(pa!=null||Qa){if(h.gridSnapping){var E=e.getZoom()*h.snappingStep;k*=E;q*=E}e.moveSelectedElements(k,q)}},Rb=function(){a("#tool_node_link").toggleClass("push_button_pressed tool_button");Ga.linkControlPoints(linked)},
Wb=function(){Ga.getNodePoint()&&Ga.clonePathNode()},bc=function(){Ga.getNodePoint()&&Ga.deletePathNode()},zb=function(){Sa.toggleClass("push_button_pressed tool_button");Ga.addSubPath(sp)},Ob=function(){Ga.opencloseSubPath()},$b=function(){e.cycleElement(1)},ob=function(){e.cycleElement(0)},Kb=function(k,q){if(!(pa==null||Qa)){k||(q*=-1);var E=parseFloat(a("#angle").val())+q;e.setRotationAngle(E);Ta()}},cc=function(){var k=h.dimensions;a.confirm(c.notification.QwantToClear,function(q){if(q){qb();
e.clear();e.setResolution(k[0],k[1]);pb(true);w();Va();Ta();Fa.fill.prep();Fa.stroke.prep();e.runExtensions("onNewDocument")}})},Ab=function(){e.setBold(!e.getBold());Ta();return false},Ra=function(){e.setItalic(!e.getItalic());Ta();return false},Vb=function(){if(!i.pngsave){var k=c.notification.loadingImage;ib=window.open("data:text/html;charset=utf-8,<title>"+k+"</title><h1>"+k+"</h1>")}window.canvg?e.rasterExport():a.getScript("canvg/rgbcolor.js",function(){a.getScript("canvg/canvg.js",function(){e.rasterExport()})})},
b=function(){e.open()},g=function(){},d=function(){if(oa.getUndoStackSize()>0){oa.undo();Va()}},u=function(){if(oa.getRedoStackSize()>0){oa.redo();Va()}},o=function(){if(Qa)e.groupSelectedElements();else pa&&e.ungroupSelectedElement()},F=function(){e.cloneSelectedElements(20,20)},s=function(){var k=this.id.replace("tool_align","").charAt(0);e.alignSelectedElements(k,a("#align_relative_to").val())},w=function(k){var q=e.getResolution();k=k?q.zoom*k:1;a("#zoom").val(k*100);e.setZoom(k);H();pb(true)},
B=function(){a("#tool_wireframe").toggleClass("push_button_pressed tool_button");da.toggleClass("wireframe");if(!mc){var k=a("#wireframe_rules");k.length?k.empty():a('<style id="wireframe_rules"></style>').appendTo("head");H()}},H=function(){if(!mc){var k="#workarea.wireframe #svgcontent * { stroke-width: "+1/e.getZoom()+"px; }";a("#wireframe_rules").text(da.hasClass("wireframe")?k:"")}},z=function(k,q){if(!Za){Za=true;Qb=e.getSvgString();a("#save_output_btns").toggle(!!q);a("#tool_source_back").toggle(!q);
a("#svg_source_textarea").val(Qb);a("#svg_source_editor").fadeIn();a("#svg_source_textarea").focus()}};a("#svg_docprops_container, #svg_prefs_container").draggable({cancel:"button,fieldset",containment:"window"});var C=function(){if(!rb){rb=true;a("#image_save_opts input").val([f.img_save]);var k=e.getResolution();if(h.baseUnit!=="px"){k.w=svgedit.units.convertUnit(k.w)+h.baseUnit;k.h=svgedit.units.convertUnit(k.h)+h.baseUnit}a("#canvas_width").val(k.w);a("#canvas_height").val(k.h);a("#canvas_title").val(e.getDocumentTitle());
a("#svg_docprops").show()}},M=function(){if(!Bb){Bb=true;a("#main_menu").hide();var k=a("#bg_blocks div"),q=a.pref("bkgd_color"),E=a.pref("bkgd_url");k.each(function(){var I=a(this),J=I.css("background-color")==q;I.toggleClass("cur_background",J);J&&a("#canvas_bg_url").removeClass("cur_background")});q||k.eq(0).addClass("cur_background");E&&a("#canvas_bg_url").val(E);a("#grid_snapping_on").prop("checked",h.gridSnapping);a("#grid_snapping_step").attr("value",h.snappingStep);a("#grid_color").attr("value",
h.gridColor);a("#svg_prefs").show()}},T=function(){if(Za){var k=function(){e.clearSelection();O();w();Va();S();Fa.fill.prep();Fa.stroke.prep()};e.setSvgString(a("#svg_source_textarea").val())?k():a.confirm(c.notification.QerrorsRevertToSource,function(q){if(!q)return false;k()});qb()}},S=function(k){k=k||e.getDocumentTitle();k=va+(k?": "+k:"");a("title:first").text(k)},Z=function(){var k=a("#canvas_title").val();S(k);e.setDocumentTitle(k);k=a("#canvas_width");var q=k.val(),E=a("#canvas_height"),I=
E.val();if(q!="fit"&&!svgedit.units.isValidUnit("width",q)){a.alert(c.notification.invalidAttrValGiven);k.parent().addClass("error");return false}k.parent().removeClass("error");if(I!="fit"&&!svgedit.units.isValidUnit("height",I)){a.alert(c.notification.invalidAttrValGiven);E.parent().addClass("error");return false}E.parent().removeClass("error");if(!e.setResolution(q,I)){a.alert(c.notification.noContentToFitTo);return false}f.img_save=a("#image_save_opts :checked").val();a.pref("img_save",f.img_save);
pb();ba()},aa=function(){var k=a("#bg_blocks div.cur_background").css("background-color")||"#FFF";p(k,a("#canvas_bg_url").val());k=a("#lang_select").val();k!=f.lang&&m.putLocale(k);R(a("#iconsize").val());h.gridSnapping=a("#grid_snapping_on")[0].checked;h.snappingStep=a("#grid_snapping_step").val();h.gridColor=a("#grid_color").val();h.showRulers=a("#show_rulers")[0].checked;a("#rulers").toggle(h.showRulers);h.showRulers&&ga();h.baseUnit=a("#base_unit").val();e.setConfig(h);pb();fa()},N=m.setIcon=
function(k,q){var E=typeof q==="string"?a.getSvgIcon(q,true):q.clone();E?a(k).empty().append(E):console.log("NOTE: Icon image missing: "+q)},Y=function(){var k=/^(Moz|Webkit|Khtml|O|ms|Icab)(?=[A-Z])/,q=document.getElementsByTagName("script")[0],E;for(E in q.style)if(k.test(E))return E.match(k)[0];if("WebkitOpacity"in q.style)return"Webkit";if("KhtmlOpacity"in q.style)return"Khtml";return""}(),Q=function(k,q){Y.toLowerCase();var E=["top","left","bottom","right"];k.each(function(){for(var I=a(this),
J=I.outerWidth()*(q-1),U=I.outerHeight()*(q-1),X=0;X<4;X++){var ea=E[X],na=I.data("orig_margin-"+ea);if(na==null){na=parseInt(I.css("margin-"+ea),10);I.data("orig_margin-"+ea,na)}na=na*q;if(ea==="right")na+=J;else if(ea==="bottom")na+=U;I.css("margin-"+ea,na)}})},R=m.setIconSize=function(k,q){if(!(k==f.size&&!q)){var E=a("#tools_top .toolset, #editor_panel > *, #history_panel > *,\t\t\t\t#main_button, #tools_left > *, #path_node_panel > *, #multiselected_panel > *,\t\t\t\t#g_panel > *, #tool_font_size > *, .tools_flyout"),
I=1;I=typeof k=="number"?k:{s:0.75,m:1,l:1.25,xl:1.5}[k];m.tool_scale=jb=I;sb();var J=E.parents(":hidden");J.css("visibility","hidden").show();Q(E,I);J.css("visibility","visible").hide();a.pref("iconsize",k);a("#iconsize").val(k);J={"#tools_top":{left:50,height:72},"#tools_left":{width:31,top:74},"div#workarea":{left:38,top:74}};E=a("#tool_size_rules");if(E.length)E.empty();else E=a('<style id="tool_size_rules"></style>').appendTo("head");if(k!="m"){var U="";a.each(J,function(X,ea){X="#svg_editor "+
X.replace(/,/g,", #svg_editor");U+=X+"{";a.each(ea,function(na,ca){if(typeof ca==="number")var ja=ca*I+"px";else if(ca[k]||ca.all)ja=ca[k]||ca.all;U+=na+":"+ja+";"});U+="}"});J="-"+Y.toLowerCase()+"-";U+="#tools_top .toolset, #editor_panel > *, #history_panel > *,\t\t\t\t#main_button, #tools_left > *, #path_node_panel > *, #multiselected_panel > *,\t\t\t\t#g_panel > *, #tool_font_size > *, .tools_flyout{"+J+"transform: scale("+I+");} #svg_editor div.toolset .toolset {"+J+"transform: scale(1); margin: 1px !important;} #svg_editor .ui-slider {"+
J+"transform: scale("+1/I+");}";E.text(U)}sb()}},K=function(){a("#dialog_box").hide();if(!Za&&!rb&&!Bb)qa&&e.leaveContext();else{if(Za)Qb!==a("#svg_source_textarea").val()?a.confirm(c.notification.QignoreSourceChanges,function(k){k&&O()}):O();else if(rb)ba();else Bb&&fa();ha()}},O=function(){a("#svg_source_editor").hide();Za=false;a("#svg_source_textarea").blur()},ba=function(){a("#svg_docprops").hide();a("#canvas_width,#canvas_height").removeAttr("disabled");a("#resolution")[0].selectedIndex=0;a("#image_save_opts input").val([f.img_save]);
rb=false},fa=function(){a("#svg_prefs").hide();Bb=false},W={width:a(window).width(),height:a(window).height()},ha=a.noop,ya;svgedit.browser.isIE()&&function(){ha=function(){if(da[0].scrollLeft===0&&da[0].scrollTop===0){da[0].scrollLeft=ya.left;da[0].scrollTop=ya.top}};ya={left:da[0].scrollLeft,top:da[0].scrollTop};a(window).resize(ha);svgEditor.ready(function(){setTimeout(function(){ha()},500)});da.scroll(function(){ya={left:da[0].scrollLeft,top:da[0].scrollTop}})}();a(window).resize(function(){a.each(W,
function(k,q){var E=a(window)[k]();da[0]["scroll"+(k==="width"?"Left":"Top")]-=(E-q)/2;W[k]=E});sb()});(function(){da.scroll(function(){if(a("#ruler_x").length!=0)a("#ruler_x")[0].scrollLeft=da[0].scrollLeft;if(a("#ruler_y").length!=0)a("#ruler_y")[0].scrollTop=da[0].scrollTop})})();a("#url_notice").click(function(){a.alert(this.title)});a("#change_image_url").click(D);(function(){var k=["clear","open","save","source","delete","delete_multi","paste","clone","clone_multi","move_top","move_bottom"],
q="";a.each(k,function(E,I){q+="#tool_"+I+(E==k.length-1?",":"")});a(q).mousedown(function(){a(this).addClass("tool_button_current")}).bind("mousedown mouseout",function(){a(this).removeClass("tool_button_current")});a("#tool_undo, #tool_redo").mousedown(function(){a(this).hasClass("disabled")||a(this).addClass("tool_button_current")}).bind("mousedown mouseout",function(){a(this).removeClass("tool_button_current")})})();if(svgedit.browser.isMac()&&!window.opera){la=["tool_clear","tool_save","tool_source",
"tool_undo","tool_redo","tool_clone"];for(var wa=la.length;wa--;){var Sa=document.getElementById(la[wa]);if(Sa){var bb=Sa.title,yb=bb.indexOf("Ctrl+");Sa.title=[bb.substr(0,yb),"Cmd+",bb.substr(yb+5)].join("")}}}var Jb=function(k){var q=k.attr("id")=="stroke_color"?"stroke":"fill",E=Fa[q].paint,I=q=="stroke"?"Pick a Stroke Paint and Opacity":"Pick a Fill Paint and Opacity";k=k.offset();a("#color_picker").draggable({cancel:".jGraduate_tabs, .jGraduate_colPick, .jGraduate_gradPick, .jPicker",containment:"window"}).css(h.colorPickerCSS||
{left:k.left-140,bottom:40}).jGraduate({paint:E,window:{pickerTitle:I},images:{clientPath:h.jGraduatePath},newstop:"inverse"},function(J){E=new a.jGraduate.Paint(J);Fa[q].setPaint(E);e.setPaint(q,E);a("#color_picker").hide()},function(){a("#color_picker").hide()})},hb=function(){var k=e.getColor("fill")=="none",q=e.getColor("stroke")=="none",E=["#tool_fhpath","#tool_line"],I=["#tools_rect .tool_button","#tools_ellipse .tool_button","#tool_text","#tool_path"];if(q)for(var J in E){var U=E[J];a(U).hasClass("tool_button_current")&&
Eb();a(U).addClass("disabled")}else for(J in E){U=E[J];a(U).removeClass("disabled")}if(q&&k)for(J in I){U=I[J];a(U).hasClass("tool_button_current")&&Eb();a(U).addClass("disabled")}else for(J in I){U=I[J];a(U).removeClass("disabled")}e.runExtensions("toolButtonStateUpdate",{nofill:k,nostroke:q});a(".tools_flyout").each(function(){var X=a("#"+this.id+"_show"),ea=false;a(this).children().each(function(){a(this).hasClass("disabled")||(ea=true)});X.toggleClass("disabled",!ea)});ub()};la=function(k,q){var E=
h[q==="fill"?"initFill":"initStroke"],I=(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg"><rect width="16.5" height="16.5"\t\t\t\t\tfill="#'+E.color+'" opacity="'+E.opacity+'"/>\t\t\t\t\t<defs><linearGradient id="gradbox_"/></defs></svg>',"text/xml").documentElement;I=a(k)[0].appendChild(document.importNode(I,true));I.setAttribute("width",16.5);this.rect=I.firstChild;this.defs=I.getElementsByTagName("defs")[0];this.grad=this.defs.firstChild;this.paint=new a.jGraduate.Paint({solidColor:E.color});
this.type=q;this.setPaint=function(J,U){this.paint=J;var X="none",ea=J.type,na=J.alpha/100;switch(ea){case "solidColor":X=J[ea]!="none"?"#"+J[ea]:J[ea];break;case "linearGradient":case "radialGradient":this.defs.removeChild(this.grad);this.grad=this.defs.appendChild(J[ea]);X="url(#"+(this.grad.id="gradbox_"+this.type)+")"}this.rect.setAttribute("fill",X);this.rect.setAttribute("opacity",na);if(U){e.setColor(this.type,paintColor,true);e.setPaintOpacity(this.type,paintOpacity,true)}};this.update=function(J){if(pa){var U=
this.type;switch(pa.tagName){case "use":case "image":case "foreignObject":return;case "g":case "a":for(var X=null,ea=pa.getElementsByTagName("*"),na=0,ca=ea.length;na<ca;na++){var ja=ea[na].getAttribute(U);if(na===0)X=ja;else if(X!==ja){X=null;break}}if(X===null){ea=null;return}ea=X;X=1;break;default:X=parseFloat(pa.getAttribute(U+"-opacity"));if(isNaN(X))X=1;ea=U==="fill"?"black":"none";ea=pa.getAttribute(U)||ea}if(J){e.setColor(U,ea,true);e.setPaintOpacity(U,X,true)}X*=100;this.setPaint(Mb(ea,X,
U))}};this.prep=function(){switch(this.paint.type){case "linearGradient":case "radialGradient":var J=new a.jGraduate.Paint({copy:this.paint});e.setPaint(q,J)}}};Fa.fill=new la("#fill_color","fill");Fa.stroke=new la("#stroke_color","stroke");a("#stroke_width").val(h.initStroke.width);a("#group_opacity").val(h.initOpacity*100);la=Fa.fill.rect.cloneNode(false);la.setAttribute("style","vector-effect:non-scaling-stroke");var mc=la.style.vectorEffect==="non-scaling-stroke";la.removeAttribute("style");la=
Fa.fill.rect.ownerDocument.createElementNS(svgedit.NS.SVG,"feGaussianBlur");typeof la.stdDeviationX==="undefined"&&a("#tool_blur").hide();a(la).remove();(function(){var k="-"+Y.toLowerCase()+"-zoom-",q=k+"in";da.css("cursor",q);if(da.css("cursor")===q){kb=q;db=k+"out"}da.css("cursor","auto")})();setTimeout(function(){e.embedImage("images/logo.png",function(k){if(!k){a("#image_save_opts [value=embed]").attr("disabled","disabled");a("#image_save_opts input").val(["ref"]);f.img_save="ref";a("#image_opt_embed").css("color",
"#666").attr("title",c.notification.featNotSupported)}})},1E3);a("#fill_color, #tool_fill .icon_label").click(function(){Jb(a("#fill_color"));hb()});a("#stroke_color, #tool_stroke .icon_label").click(function(){Jb(a("#stroke_color"));hb()});a("#group_opacityLabel").click(function(){a("#opacity_dropdown button").mousedown();a(window).mouseup()});a("#zoomLabel").click(function(){a("#zoom_dropdown button").mousedown();a(window).mouseup()});a("#tool_move_top").mousedown(function(k){a("#tools_stacking").show();
k.preventDefault()});a(".layer_button").mousedown(function(){a(this).addClass("layer_buttonpressed")}).mouseout(function(){a(this).removeClass("layer_buttonpressed")}).mouseup(function(){a(this).removeClass("layer_buttonpressed")});a(".push_button").mousedown(function(){a(this).hasClass("disabled")||a(this).addClass("push_button_pressed").removeClass("push_button")}).mouseout(function(){a(this).removeClass("push_button_pressed").addClass("push_button")}).mouseup(function(){a(this).removeClass("push_button_pressed").addClass("push_button")});
a("#layer_new").click(function(){var k=e.getCurrentDrawing().getNumLayers();do var q=c.layers.layer+" "+ ++k;while(e.getCurrentDrawing().hasLayer(q));a.prompt(c.notification.enterUniqueLayerName,q,function(E){if(E)if(e.getCurrentDrawing().hasLayer(E))a.alert(c.notification.dupeLayerName);else{e.createLayer(E);Ta();Va()}})});a("#layer_delete").click(P);a("#layer_up").click(function(){A(-1)});a("#layer_down").click(function(){A(1)});a("#layer_rename").click(function(){a("#layerlist tr.layersel").prevAll();
var k=a("#layerlist tr.layersel td.layername").text();a.prompt(c.notification.enterNewLayerName,"",function(q){if(q)if(k==q||e.getCurrentDrawing().hasLayer(q))a.alert(c.notification.layerHasThatName);else{e.renameCurrentLayer(q);Va()}})});var Pb=-1,gc=false,kc=false,nc=function(k){var q=a("#ruler_x");a("#sidepanels").width("+="+k);a("#layerpanel").width("+="+k);q.css("right",parseInt(q.css("right"),10)+k);da.css("right",parseInt(da.css("right"),10)+k);e.runExtensions("workareaResized")},oc=function(k){if(kc)if(Pb!=
-1){gc=true;k=Pb-k.pageX;var q=a("#sidepanels").width();if(q+k>300)k=300-q;else if(q+k<2)k=2-q;if(k!=0){Pb-=k;nc(k)}}};a("#sidepanel_handle").mousedown(function(k){Pb=k.pageX;a(window).mousemove(oc);kc=false;setTimeout(function(){kc=true},20)}).mouseup(function(){gc||lc();Pb=-1;gc=false});a(window).mouseup(function(){Pb=-1;gc=false;a("#svg_editor").unbind("mousemove",oc)});var lc=function(k){var q=a("#sidepanels").width();nc((q>2||k?2:150)-q)},pc=function(k){for(var q=Array(e.getCurrentDrawing().getNumLayers()),
E=0;E<q.length;++E)q[E]=e.getCurrentDrawing().getLayerName(E);if(k)for(E=0;E<q.length;++E)q[E]!=k&&e.getCurrentDrawing().setLayerOpacity(q[E],0.5);else for(E=0;E<q.length;++E)e.getCurrentDrawing().setLayerOpacity(q[E],1)},Va=function(){e.clearSelection();for(var k=a("#layerlist tbody").empty(),q=a("#selLayerNames").empty(),E=e.getCurrentDrawing(),I=E.getCurrentLayerName(),J=e.getCurrentDrawing().getNumLayers(),U=a.getSvgIcon("eye");J--;){var X=E.getLayerName(J),ea=a('<tr class="layer">').toggleClass("layersel",
X===I),na=a('<td class="layervis">').toggleClass("layerinvis",!E.getLayerVisibility(X)),ca=a('<td class="layername">'+X+"</td>");k.append(ea.append(na,ca));q.append('<option value="'+X+'">'+X+"</option>")}if(U!==undefined){U.clone();a("td.layervis",k).append(U.clone());a.resizeSvgIcons({"td.layervis .svg_icon":14})}a("#layerlist td.layername").mouseup(function(ja){a("#layerlist tr.layer").removeClass("layersel");a(this.parentNode).addClass("layersel");e.setCurrentLayer(this.textContent);ja.preventDefault()}).mouseover(function(){pc(this.textContent)}).mouseout(function(){pc()});
a("#layerlist td.layervis").click(function(){var ja=a(this.parentNode).prevAll().length;ja=a("#layerlist tr.layer:eq("+ja+") td.layername").text();var Aa=a(this).hasClass("layerinvis");e.setLayerVisibility(ja,Aa);a(this).toggleClass("layerinvis")});for(q=5-a("#layerlist tr.layer").size();q-- >0;)k.append('<tr><td style="color:white">_</td><td/></tr>')};Va();a(window).bind("load resize",function(){da.css("line-height",da.height()+"px")});a("#resolution").change(function(){var k=a("#canvas_width,#canvas_height");
if(this.selectedIndex)if(this.value=="content")k.val("fit").attr("disabled","disabled");else{var q=this.value.split("x");a("#canvas_width").val(q[0]);a("#canvas_height").val(q[1]);k.removeAttr("disabled")}else a("#canvas_width").val()=="fit"&&k.removeAttr("disabled").val(100)});a("input,select").attr("autocomplete","off");var jc=function(){var k=[{sel:"#tool_select",fn:Eb,evt:"click",key:["V",true]},{sel:"#tool_fhpath",fn:wb,evt:"click",key:["Q",true]},{sel:"#tool_line",fn:Hb,evt:"click",key:["L",
true]},{sel:"#tool_rect",fn:Nb,evt:"mouseup",key:["R",true],parent:"#tools_rect",icon:"rect"},{sel:"#tool_square",fn:Sb,evt:"mouseup",parent:"#tools_rect",icon:"square"},{sel:"#tool_fhrect",fn:hc,evt:"mouseup",parent:"#tools_rect",icon:"fh_rect"},{sel:"#tool_ellipse",fn:xb,evt:"mouseup",key:["E",true],parent:"#tools_ellipse",icon:"ellipse"},{sel:"#tool_circle",fn:Yb,evt:"mouseup",parent:"#tools_ellipse",icon:"circle"},{sel:"#tool_fhellipse",fn:Xa,evt:"mouseup",parent:"#tools_ellipse",icon:"fh_ellipse"},
{sel:"#tool_path",fn:ic,evt:"click",key:["P",true]},{sel:"#tool_text",fn:Ub,evt:"click",key:["T",true]},{sel:"#tool_image",fn:La,evt:"mouseup"},{sel:"#tool_zoom",fn:ma,evt:"mouseup",key:["Z",true]},{sel:"#tool_clear",fn:cc,evt:"mouseup",key:["N",true]},{sel:"#tool_save",fn:function(){Za?T():e.save({images:f.img_save,round_digits:6})},evt:"mouseup",key:["S",true]},{sel:"#tool_export",fn:Vb,evt:"mouseup"},{sel:"#tool_open",fn:b,evt:"mouseup",key:["O",true]},{sel:"#tool_import",fn:g,evt:"mouseup"},{sel:"#tool_source",
fn:z,evt:"click",key:["U",true]},{sel:"#tool_wireframe",fn:B,evt:"click",key:["F",true]},{sel:"#tool_source_cancel,.overlay,#tool_docprops_cancel,#tool_prefs_cancel",fn:K,evt:"click",key:["esc",false,false],hidekey:true},{sel:"#tool_source_save",fn:T,evt:"click"},{sel:"#tool_docprops_save",fn:Z,evt:"click"},{sel:"#tool_docprops",fn:C,evt:"mouseup"},{sel:"#tool_prefs_save",fn:aa,evt:"click"},{sel:"#tool_prefs_option",fn:function(){M();return false},evt:"mouseup"},{sel:"#tool_delete,#tool_delete_multi",
fn:Zb,evt:"click",key:["del/backspace",true]},{sel:"#tool_reorient",fn:sa,evt:"click"},{sel:"#tool_node_link",fn:Rb,evt:"click"},{sel:"#tool_node_clone",fn:Wb,evt:"click"},{sel:"#tool_node_delete",fn:bc,evt:"click"},{sel:"#tool_openclose_path",fn:Ob,evt:"click"},{sel:"#tool_add_subpath",fn:zb,evt:"click"},{sel:"#tool_move_top",fn:ab,evt:"click",key:"ctrl+shift+]"},{sel:"#tool_move_bottom",fn:Ib,evt:"click",key:"ctrl+shift+["},{sel:"#tool_topath",fn:Pa,evt:"click"},{sel:"#tool_make_link,#tool_make_link_multi",
fn:ac,evt:"click"},{sel:"#tool_undo",fn:d,evt:"click",key:["Z",true]},{sel:"#tool_redo",fn:u,evt:"click",key:["Y",true]},{sel:"#tool_clone,#tool_clone_multi",fn:F,evt:"click",key:["D",true]},{sel:"#tool_group",fn:o,evt:"click",key:["G",true]},{sel:"#tool_ungroup",fn:o,evt:"click"},{sel:"#tool_unlink_use",fn:o,evt:"click"},{sel:"[id^=tool_align]",fn:s,evt:"click"},{sel:"#tool_bold",fn:Ab,evt:"mousedown"},{sel:"#tool_italic",fn:Ra,evt:"mousedown"},{sel:"#sidepanel_handle",fn:lc,key:["X"]},{sel:"#copy_save_done",
fn:K,evt:"click"},{key:"ctrl+left",fn:function(){Kb(0,1)}},{key:"ctrl+right",fn:function(){Kb(1,1)}},{key:"ctrl+shift+left",fn:function(){Kb(0,5)}},{key:"ctrl+shift+right",fn:function(){Kb(1,5)}},{key:"shift+O",fn:ob},{key:"shift+P",fn:$b},{key:[Ba+"up",true],fn:function(){w(2)}},{key:[Ba+"down",true],fn:function(){w(0.5)}},{key:[Ba+"]",true],fn:function(){nb("Up")}},{key:[Ba+"[",true],fn:function(){nb("Down")}},{key:["up",true],fn:function(){cb(0,-1)}},{key:["down",true],fn:function(){cb(0,1)}},
{key:["left",true],fn:function(){cb(-1,0)}},{key:["right",true],fn:function(){cb(1,0)}},{key:"shift+up",fn:function(){cb(0,-10)}},{key:"shift+down",fn:function(){cb(0,10)}},{key:"shift+left",fn:function(){cb(-10,0)}},{key:"shift+right",fn:function(){cb(10,0)}},{key:["alt+up",true],fn:function(){e.cloneSelectedElements(0,-1)}},{key:["alt+down",true],fn:function(){e.cloneSelectedElements(0,1)}},{key:["alt+left",true],fn:function(){e.cloneSelectedElements(-1,0)}},{key:["alt+right",true],fn:function(){e.cloneSelectedElements(1,
0)}},{key:["alt+shift+up",true],fn:function(){e.cloneSelectedElements(0,-10)}},{key:["alt+shift+down",true],fn:function(){e.cloneSelectedElements(0,10)}},{key:["alt+shift+left",true],fn:function(){e.cloneSelectedElements(-10,0)}},{key:["alt+shift+right",true],fn:function(){e.cloneSelectedElements(10,0)}},{key:"A",fn:function(){e.selectAllInCurrentLayer()}},{key:Ba+"z",fn:d},{key:Ba+"shift+z",fn:u},{key:Ba+"y",fn:u},{key:Ba+"x",fn:fb},{key:Ba+"c",fn:Da},{key:Ba+"v",fn:Ya}],q={"4/Shift+4":"#tools_rect_show",
"5/Shift+5":"#tools_ellipse_show"};return{setAll:function(){var E={};a.each(k,function(I,J){if(J.sel){var U=a(J.sel);if(U.length==0)return true;if(J.evt){if(svgedit.browser.isTouch()&&J.evt==="click")J.evt="mousedown";U[J.evt](J.fn)}if(J.parent&&a(J.parent+"_show").length!=0){var X=a(J.parent);X.length||(X=Db(J.parent.substr(1)));X.append(U);a.isArray(E[J.parent])||(E[J.parent]=[]);E[J.parent].push(J)}}if(J.key){var ea=J.fn,na=false;if(a.isArray(J.key)){X=J.key[0];if(J.key.length>1)na=J.key[1]}else X=
J.key;X+="";a.each(X.split("/"),function(ja,Aa){a(document).bind("keydown",Aa,function(Ma){ea();na&&Ma.preventDefault();return false})});if(J.sel&&!J.hidekey&&U.attr("title")){var ca=U.attr("title").split("[")[0]+" ("+X+")";q[X]=J.sel;U.parents("#main_menu").length||U.attr("title",ca)}}});Cb(E);a(".attr_changer, #image_url").bind("keydown","return",function(I){a(this).change();I.preventDefault()});a(window).bind("keydown","tab",function(I){if(gb==="canvas"){I.preventDefault();$b()}}).bind("keydown",
"shift+tab",function(I){if(gb==="canvas"){I.preventDefault();ob()}});a("#tool_zoom").dblclick(Tb)},setTitles:function(){a.each(q,function(E,I){var J=a(I).parents("#main_menu").length;a(I).each(function(){var U=J?a(this).text().split(" [")[0]:this.title.split(" [")[0],X="";a.each(E.split("/"),function(ea,na){var ca=na.split("+"),ja="";if(ca.length>1){ja=ca[0]+"+";na=ca[1]}X+=(ea?"/":"")+ja+(c["key_"+na]||na)});if(J)this.lastChild.textContent=U+" ["+X+"]";else this.title=U+" ["+X+"]"})})},getButtonData:function(E){var I;
a.each(k,function(J,U){if(U.sel===E)I=U});return I}}}();jc.setAll();m.ready(function(){var k=h.initTool,q=a("#tools_left, #svg_editor .tools_flyout"),E=q.find("#tool_"+k);k=q.find("#"+k);(E.length?E:k.length?k:a("#tool_select")).click().mouseup();h.wireframe&&a("#tool_wireframe").click();h.showlayers&&lc();a("#rulers").toggle(!!h.showRulers);if(h.showRulers)a("#show_rulers")[0].checked=true;h.baseUnit&&a("#base_unit").val(h.baseUnit);if(h.gridSnapping)a("#grid_snapping_on")[0].checked=true;h.snappingStep&&
a("#grid_snapping_step").val(h.snappingStep);h.gridColor&&a("#grid_color").val(h.gridColor)});a("#rect_rx").SpinButton({min:0,max:1E3,callback:function(k){e.setRectRadius(k.value)}});a("#stroke_width").SpinButton({min:0,max:99,smallStep:0.1,callback:function(k){var q=k.value;if(q==0&&pa&&["line","polyline"].indexOf(pa.nodeName)>=0)q=k.value=1;e.setStrokeWidth(q)}});a("#angle").SpinButton({min:-180,max:180,step:5,callback:function(k){e.setRotationAngle(k.value);a("#tool_reorient").toggleClass("disabled",
parseInt(k.value,10)===0)}});a("#font_size").SpinButton({min:0.001,stepfunc:function(k,q){var E=k.value-0,I=E+q,J=I>=E;if(q===0)return E;if(E>=24){if(J)return Math.round(E*1.1);return Math.round(E/1.1)}else if(E<=1){if(J)return E*2;return E/2}return I},callback:function(k){e.setFontSize(k.value)}});a("#group_opacity").SpinButton({min:0,max:100,step:5,callback:Ua});a("#blur").SpinButton({min:0,max:10,step:0.1,callback:Oa});a("#zoom").SpinButton({min:0.001,max:1E4,step:50,stepfunc:function(k,q){var E=
k.value-0;if(E===0)return 100;var I=E+q;if(q===0)return E;if(E>=100)return I;if(I>=E)return E*2;return E/2},callback:mb}).val(e.getZoom()*100);a("#workarea").contextMenu({menu:"cmenu_canvas",inSpeed:0},function(k){switch(k){case "delete":Zb();break;case "cut":fb();break;case "copy":Da();break;case "paste":e.pasteElements();break;case "paste_in_place":e.pasteElements("in_place");break;case "group":e.groupSelectedElements();break;case "ungroup":e.ungroupSelectedElement();break;case "move_front":ab();
break;case "move_up":nb("Up");break;case "move_down":nb("Down");break;case "move_back":Ib();break;default:svgedit.contextmenu&&svgedit.contextmenu.hasCustomHandler(k)&&svgedit.contextmenu.getCustomHandler(k).call()}e.clipBoard.length&&za.enableContextMenuItems("#paste,#paste_in_place")});la=function(k){switch(k){case "dupe":L();break;case "delete":P();break;case "merge_down":if(a("#layerlist tr.layersel").index()!=e.getCurrentDrawing().getNumLayers()-1){e.mergeLayer();Ta();Va()}break;case "merge_all":e.mergeAllLayers();
Ta();Va()}};a("#layerlist").contextMenu({menu:"cmenu_layers",inSpeed:0},la);a("#layer_moreopts").contextMenu({menu:"cmenu_layers",inSpeed:0,allowLeft:true},la);a(".contextMenu li").mousedown(function(k){k.preventDefault()});a("#cmenu_canvas li").disableContextMenu();za.enableContextMenuItems("#delete,#cut,#copy");window.onbeforeunload=function(){if("localStorage"in window){window.localStorage.setItem("svgedit-"+m.curConfig.canvasName,e.getSvgString());m.showSaveWarning=false}if(oa.getUndoStackSize()===
0)m.showSaveWarning=false;if(!h.no_save_warning&&m.showSaveWarning)return c.notification.unsavedChanges};m.openPrep=function(k){a("#main_menu").hide();oa.getUndoStackSize()===0?k(true):a.confirm(c.notification.QwantToOpen,k)};if(window.FileReader){la=function(k){a.process_cancel(c.notification.loadingImage);k.stopPropagation();k.preventDefault();a("#workarea").removeAttr("style");a("#main_menu").hide();if(k=k.type=="drop"?k.dataTransfer.files[0]:this.files[0])if(k.type.indexOf("image")!=-1)if(k.type.indexOf("svg")!=
-1){var q=new FileReader;q.onloadend=function(E){e.importSvgString(E.target.result,true);e.ungroupSelectedElement();e.ungroupSelectedElement();e.groupSelectedElements();e.alignSelectedElements("m","page");e.alignSelectedElements("c","page")};q.readAsText(k)}else{q=new FileReader;q.onloadend=function(E){insertNewImage=function(X,ea){var na=e.addSvgElementFromJson({element:"image",attr:{x:0,y:0,width:X,height:ea,id:e.getNextId(),style:"pointer-events:inherit"}});e.setHref(na,E.target.result);e.selectOnly([na]);
e.alignSelectedElements("m","page");e.alignSelectedElements("c","page");Ta()};var I=100,J=100,U=new Image;U.src=E.target.result;U.style.opacity=0;U.onload=function(){I=U.offsetWidth;J=U.offsetHeight;insertNewImage(I,J)}};q.readAsDataURL(k)}};da[0].addEventListener("dragenter",function(k){k.stopPropagation();k.preventDefault()},false);da[0].addEventListener("dragover",function(k){k.stopPropagation();k.preventDefault()},false);da[0].addEventListener("dragleave",function(k){k.stopPropagation();k.preventDefault()},
false);da[0].addEventListener("drop",la,false);wa=a('<input type="file">').change(function(){var k=this;m.openPrep(function(q){if(q){e.clear();if(k.files.length==1){a.process_cancel(c.notification.loadingImage);q=new FileReader;q.onloadend=function(E){G(E.target.result);pb()};q.readAsText(k.files[0])}}})});a("#tool_open").show().prepend(wa);la=a('<input type="file">').change(la);a("#tool_import").show().prepend(la)}var pb=m.updateCanvas=function(k,q){var E=da.width(),I=da.height(),J=E,U=I,X=e.getZoom(),
ea=a("#svgcanvas"),na={x:da[0].scrollLeft+J/2,y:da[0].scrollTop+U/2},ca=h.canvas_expansion;E=Math.max(J,e.contentW*X*ca);I=Math.max(U,e.contentH*X*ca);E==J&&I==U?da.css("overflow","hidden"):da.css("overflow","scroll");ca=ea.height()/2;var ja=ea.width()/2;ea.width(E).height(I);var Aa=I/2,Ma=E/2,V=e.updateCanvas(E,I),xa=Ma/ja;E=E/2-J/2;I=I/2-U/2;if(q){q.x+=V.x;q.y+=V.y}else q={x:Ma+(na.x-ja)*xa,y:Aa+(na.y-ca)*xa};if(k)if(e.contentW>da.width()){da[0].scrollLeft=V.x-10;da[0].scrollTop=V.y-10}else{da[0].scrollLeft=
E;da[0].scrollTop=I}else{da[0].scrollLeft=q.x-J/2;da[0].scrollTop=q.y-U/2}if(h.showRulers){ga(ea,X);da.scroll()}a("#dialog_box").hide()},Xb=[];for(wa=0.1;wa<1E5;wa*=10){Xb.push(1*wa);Xb.push(2*wa);Xb.push(5*wa)}pb(true);try{window.addEventListener("message",function(k){var q=parseInt(k.data.substr(0,k.data.indexOf(";")),10);try{k.source.postMessage("SVGe"+q+";"+JSON.stringify(eval(k.data)),"*")}catch(E){k.source.postMessage("SVGe"+q+";error:"+E.message,"*")}},false)}catch(qc){window.embed_error=qc}a(function(){window.svgCanvas=
e;e.ready=svgEditor.ready});m.setLang=function(k,q){a.pref("lang",k);a("#lang_select").val(k);if(q){var E=a("#layerlist tr.layersel td.layername").text()==c.common.layer+" 1";a.extend(c,q);e.setUiStrings(q);jc.setTitles();if(E){e.renameCurrentLayer(c.common.layer+" 1");Va()}e.runExtensions("langChanged",k);Fb();a.each({"#stroke_color":"#tool_stroke .icon_label, #tool_stroke .color_block","#fill_color":"#tool_fill label, #tool_fill .color_block","#linejoin_miter":"#cur_linejoin","#linecap_butt":"#cur_linecap"},
function(I,J){a(J).attr("title",a(I)[0].title)});a("#multiselected_panel div[id^=tool_align]").each(function(){a("#tool_pos"+this.id.substr(10))[0].title=this.title})}}};var t=[];m.ready=function(n){l?n():t.push(n)};m.runCallbacks=function(){a.each(t,function(){this()});l=true};m.loadFromString=function(n){m.ready(function(){G(n)})};m.disableUI=function(){};m.loadFromURL=function(n,p){p||(p={});var D=p.cache,P=p.callback;m.ready(function(){a.ajax({url:n,dataType:"text",cache:!!D,beforeSend:function(){a.process_cancel(c.notification.loadingImage)},
success:function(L){G(L,P)},error:function(L,A,ga){L.status!=404&&L.responseText?G(L.responseText,P):a.alert(c.notification.URLloadFail+": \n"+ga+"",P)},complete:function(){a("#dialog_box").hide()}})})};m.loadFromDataURI=function(n){m.ready(function(){var p=n.substring(26);G(svgedit.utilities.decode64(p))})};m.addExtension=function(){var n=arguments;a(function(){e&&e.addExtension.apply(this,n)})};return m}(jQuery);$(svgEditor.init)})();svgedit=svgedit||{};
(function(){var a=this;if(!svgedit.contextmenu)svgedit.contextmenu={};a.contextMenuExtensions={};svgEditor.ready(function(){for(var G in contextMenuExtensions){var e=contextMenuExtensions[G];Object.keys(a.contextMenuExtensions).length===0&&$("#cmenu_canvas").append("<li class='separator'>");var m=e.shortcut||"";$("#cmenu_canvas").append("<li class='disabled'><a href='#"+e.id+"'>"+e.label+"<span class='shortcut'>"+m+"</span></a></li>")}});svgedit.contextmenu.resetCustomMenus=function(){a.contextMenuExtensions={}};
svgedit.contextmenu.add=function(G){if(G&&G.id&&G.label&&G.action&&typeof G.action=="function")if(G.id in a.contextMenuExtensions)console.error('Cannot add extension "'+G.id+'", an extension by that name already exists"');else{console.log("Registed contextmenu item: {id:"+G.id+", label:"+G.label+"}");a.contextMenuExtensions[G.id]=G}else console.error("Menu items must be defined and have at least properties: id, label, action, where action must be a function")};svgedit.contextmenu.hasCustomHandler=
function(G){return a.contextMenuExtensions[G]&&true};svgedit.contextmenu.getCustomHandler=function(G){return a.contextMenuExtensions[G].action}})();var svgEditor=function(a,G){function e(l,v,f){var h=a("#svg_editor").parent(),c;for(c in v){var i=v[c];i||console.log(c);if(f)c="#"+c;if(h.find(c).length){var t=h.find(c)[0];switch(l){case "content":for(var n=0;n<t.childNodes.length;n++){var p=t.childNodes[n];if(p.nodeType===3&&p.textContent.replace(/\s/g,"")){p.textContent=i;break}}break;case "title":t.title=i}}else console.log("Missing: "+c)}}var m;G.readLang=function(l){var v=G.canvas.runExtensions("addlangData",m,true);a.each(v,function(P,L){if(L.data)l=
a.merge(l,L.data)});if(l.tools){var f=l.tools;v=l.properties;var h=l.config,c=l.layers,i=l.common,t=l.ui;e("content",{copyrightLabel:l.misc.powered_by,curve_segments:v.curve_segments,fitToContent:f.fitToContent,fit_to_all:f.fit_to_all,fit_to_canvas:f.fit_to_canvas,fit_to_layer_content:f.fit_to_layer_content,fit_to_sel:f.fit_to_sel,icon_large:h.icon_large,icon_medium:h.icon_medium,icon_small:h.icon_small,icon_xlarge:h.icon_xlarge,image_opt_embed:h.image_opt_embed,image_opt_ref:h.image_opt_ref,includedImages:h.included_images,
largest_object:f.largest_object,layersLabel:c.layers,page:f.page,relativeToLabel:f.relativeTo,selLayerLabel:c.move_elems_to,selectedPredefined:h.select_predefined,selected_objects:f.selected_objects,smallest_object:f.smallest_object,straight_segments:v.straight_segments,svginfo_bg_url:h.editor_img_url+":",svginfo_bg_note:h.editor_bg_note,svginfo_change_background:h.background,svginfo_dim:h.doc_dims,svginfo_editor_prefs:h.editor_prefs,svginfo_height:i.height,svginfo_icons:h.icon_size,svginfo_image_props:h.image_props,
svginfo_lang:h.language,svginfo_title:h.doc_title,svginfo_width:i.width,tool_docprops_cancel:i.cancel,tool_docprops_save:i.ok,tool_source_cancel:i.cancel,tool_source_save:i.ok,tool_prefs_cancel:i.cancel,tool_prefs_save:i.ok,sidepanel_handle:c.layers.split("").join(" "),tool_clear:f.new_doc,tool_docprops:f.docprops,tool_export:f.export_png,tool_import:f.import_doc,tool_imagelib:f.imagelib,tool_open:f.open_doc,tool_save:f.save_doc,svginfo_units_rulers:h.units_and_rulers,svginfo_rulers_onoff:h.show_rulers,
svginfo_unit:h.base_unit,svginfo_grid_settings:h.grid,svginfo_snap_onoff:h.snapping_onoff,svginfo_snap_step:h.snapping_stepsize,svginfo_grid_color:h.grid_color},true);var n={},p;for(p in l.shape_cats)n['#shape_cats [data-cat="'+p+'"]']=l.shape_cats[p];setTimeout(function(){e("content",n)},2E3);var D={};a.each(["cut","copy","paste","paste_in_place","delete","group","ungroup","move_front","move_up","move_down","move_back"],function(){D['#cmenu_canvas a[href="#'+this+'"]']=f[this]});a.each(["dupe","merge_down",
"merge_all"],function(){D['#cmenu_layers a[href="#'+this+'"]']=c[this]});D['#cmenu_layers a[href="#delete"]']=c.del;e("content",D);e("title",{align_relative_to:f.align_relative_to,circle_cx:v.circle_cx,circle_cy:v.circle_cy,circle_r:v.circle_r,cornerRadiusLabel:v.corner_radius,ellipse_cx:v.ellipse_cx,ellipse_cy:v.ellipse_cy,ellipse_rx:v.ellipse_rx,ellipse_ry:v.ellipse_ry,fill_color:v.fill_color,font_family:v.font_family,idLabel:v.id,image_height:v.image_height,image_url:v.image_url,image_width:v.image_width,
layer_delete:c.del,layer_down:c.move_down,layer_new:c["new"],layer_rename:c.rename,layer_moreopts:i.more_opts,layer_up:c.move_up,line_x1:v.line_x1,line_x2:v.line_x2,line_y1:v.line_y1,line_y2:v.line_y2,linecap_butt:v.linecap_butt,linecap_round:v.linecap_round,linecap_square:v.linecap_square,linejoin_bevel:v.linejoin_bevel,linejoin_miter:v.linejoin_miter,linejoin_round:v.linejoin_round,main_icon:f.main_menu,mode_connect:f.mode_connect,tools_shapelib_show:f.mode_shapelib,palette:t.palette_info,zoom_panel:t.zoom_level,
path_node_x:v.node_x,path_node_y:v.node_y,rect_height_tool:v.rect_height,rect_width_tool:v.rect_width,seg_type:v.seg_type,selLayerNames:c.move_selected,selected_x:v.pos_x,selected_y:v.pos_y,stroke_color:v.stroke_color,stroke_style:v.stroke_style,stroke_width:v.stroke_width,svginfo_title:h.doc_title,text:v.text_contents,toggle_stroke_tools:t.toggle_stroke_tools,tool_add_subpath:f.add_subpath,tool_alignbottom:f.align_bottom,tool_aligncenter:f.align_center,tool_alignleft:f.align_left,tool_alignmiddle:f.align_middle,
tool_alignright:f.align_right,tool_aligntop:f.align_top,tool_angle:v.angle,tool_blur:v.blur,tool_bold:v.bold,tool_circle:f.mode_circle,tool_clone:f.clone,tool_clone_multi:f.clone,tool_delete:f.del,tool_delete_multi:f.del,tool_ellipse:f.mode_ellipse,tool_eyedropper:f.mode_eyedropper,tool_fhellipse:f.mode_fhellipse,tool_fhpath:f.mode_fhpath,tool_fhrect:f.mode_fhrect,tool_font_size:v.font_size,tool_group:f.group,tool_make_link:f.make_link,tool_link_url:f.set_link_url,tool_image:f.mode_image,tool_italic:v.italic,
tool_line:f.mode_line,tool_move_bottom:f.move_bottom,tool_move_top:f.move_top,tool_node_clone:f.node_clone,tool_node_delete:f.node_delete,tool_node_link:f.node_link,tool_opacity:v.opacity,tool_openclose_path:f.openclose_path,tool_path:f.mode_path,tool_position:f.align_to_page,tool_rect:f.mode_rect,tool_redo:f.redo,tool_reorient:f.reorient_path,tool_select:f.mode_select,tool_source:f.source_save,tool_square:f.mode_square,tool_text:f.mode_text,tool_topath:f.to_path,tool_undo:f.undo,tool_ungroup:f.ungroup,
tool_wireframe:f.wireframe_mode,view_grid:f.toggle_grid,tool_zoom:f.mode_zoom,url_notice:f.no_embed},true);G.setLang(m,l)}};G.putLocale=function(l,v){if(l)m=l;else{m=a.pref("lang");if(!m){if(navigator.userLanguage)m=navigator.userLanguage;else if(navigator.language)m=navigator.language;if(m=="")return}console.log("Lang: "+m);if(a.inArray(m,v)==-1&&m!=="test")m="en";if(m.indexOf("en")==0)return}var f=G.curConfig.langPath+"lang."+m+".js";a.getScript(f,function(h){if(!h){h=document.createElement("script");
h.src=f;document.querySelector("head").appendChild(h)}})};return G}(jQuery,svgEditor);
